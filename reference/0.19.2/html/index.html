<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="Authors: The YAKS Community">
<title>YAKS</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<!--
  ~ Copyright the original author or authors.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<link rel='shortcut icon' type='image/x-icon' href='/yaks/favicon.ico' />

<style>

    h1, h2, h3, h4, h5, h6, #toctitle {
        color: #3b73af;
    }

    div#toctitle {
        content: url("images/yaks-logo-toc.png");
    }

    #content h1>a.link, h2>a.link, h3>a.link, #toctitle>a.link, .sidebarblock>.content>.title>a.link, h4>a.link, h5>a.link, h6>a.link {
      color: #3b73af;
      text-decoration: none;
    }

    #content h1>a.link:hover, h2>a.link:hover, h3>a.link:hover, #toctitle>a.link:hover, .sidebarblock>.content>.title>a.link:hover, h4>a.link:hover, h5>a.link:hover, h6>a.link:hover {
      color: #3b73af;
    }

</style>
</head>
<body id="yaks" class="book toc2 toc-left">
<div id="header">
<h1>YAKS</h1>
<div class="details">
<span id="author" class="author">Authors: The YAKS Community</span><br>
<span id="revnumber">version 0.19.2,</span>
<span id="revdate">2024-05-17</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">yaks</div>
<ul class="sectlevel1">
<li><a href="#preface">1. What is YAKS!?</a></li>
<li><a href="#quickstart">2. Getting started</a></li>
<li><a href="#installation">3. Installation</a>
<ul class="sectlevel2">
<li><a href="#installation-requirements">3.1. Requirements</a></li>
<li><a href="#installation-windows">3.2. Windows prerequisite</a></li>
<li><a href="#installation-operator">3.3. Operator install</a>
<ul class="sectlevel3">
<li><a href="#installation-global-mode">3.3.1. Global mode</a></li>
<li><a href="#installation-namespaced-mode">3.3.2. Namespaced mode</a></li>
</ul>
</li>
<li><a href="#installation-verify">3.4. Verify installation</a></li>
</ul>
</li>
<li><a href="#running">4. Running</a>
<ul class="sectlevel2">
<li><a href="#running-monitoring">4.1. Status monitoring</a></li>
</ul>
</li>
<li><a href="#cli">5. Command line interface (yaks)</a>
<ul class="sectlevel2">
<li><a href="#cli-commands">5.1. Available Commands</a></li>
<li><a href="#cli-help">5.2. help</a></li>
<li><a href="#cli-install">5.3. install</a></li>
<li><a href="#cli-role">5.4. role</a></li>
<li><a href="#cli-list">5.5. list</a></li>
<li><a href="#cli-run">5.6. run</a></li>
<li><a href="#cli-delete">5.7. delete</a></li>
<li><a href="#cli-logs">5.8. log</a></li>
<li><a href="#cli-report">5.9. report</a></li>
<li><a href="#cli-dump">5.10. dump</a></li>
<li><a href="#cli-upload">5.11. upload</a></li>
<li><a href="#cli-uninstall">5.12. uninstall</a></li>
<li><a href="#cli-version">5.13. version</a></li>
</ul>
</li>
<li><a href="#configuration">6. Configuration</a>
<ul class="sectlevel2">
<li><a href="#configuration-dependencies">6.1. Runtime dependencies</a>
<ul class="sectlevel3">
<li><a href="#configuration-tags">6.1.1. Cucumber tags</a></li>
<li><a href="#configuration-properties">6.1.2. System property or environment setting</a></li>
<li><a href="#configuration-properties-file">6.1.3. Property file</a></li>
<li><a href="#configuration-file">6.1.4. YAKS configuration file</a></li>
</ul>
</li>
<li><a href="#configuration-repositories">6.2. Maven repositories and pluginRepositories</a>
<ul class="sectlevel3">
<li><a href="#configuration-repository-properties">6.2.1. System property or environment setting</a></li>
<li><a href="#configuration-repository-file">6.2.2. Property file</a></li>
<li><a href="#configuration-repository-config">6.2.3. YAKS configuration file</a></li>
</ul>
</li>
<li><a href="#configuration-secrets">6.3. Using secrets</a></li>
</ul>
</li>
<li><a href="#steps">7. Steps</a>
<ul class="sectlevel2">
<li><a href="#steps-standard">7.1. Standard steps</a>
<ul class="sectlevel3">
<li><a href="#steps-variables">7.1.1. Create variables</a></li>
<li><a href="#steps-log">7.1.2. Log steps</a></li>
<li><a href="#steps-sleep">7.1.3. Sleep</a></li>
</ul>
</li>
<li><a href="#steps-camel">7.2. Apache Camel steps</a>
<ul class="sectlevel3">
<li><a href="#camel-context">7.2.1. Create Camel context</a></li>
<li><a href="#camel-routes-create">7.2.2. Create Camel routes</a></li>
<li><a href="#camel-routes-manage">7.2.3. Start/stop Camel routes</a></li>
<li><a href="#camel-send">7.2.4. Send messages via Camel</a></li>
<li><a href="#camel-receive">7.2.5. Receive messages via Camel</a></li>
<li><a href="#camel-exchange">7.2.6. Define Camel exchanges</a></li>
<li><a href="#camel-settings">7.2.7. Basic Camel settings</a></li>
<li><a href="#camel-resources">7.2.8. Manage Camel resources</a></li>
</ul>
</li>
<li><a href="#steps-camel-k">7.3. Apache Camel K steps</a>
<ul class="sectlevel3">
<li><a href="#camel-k-api-version">7.3.1. API version</a></li>
<li><a href="#camel-k-create">7.3.2. Create Camel K integrations</a></li>
<li><a href="#camel-k-load">7.3.3. Load Camel K integrations</a></li>
<li><a href="#camel-k-delete">7.3.4. Delete Camel K integrations</a></li>
<li><a href="#camel-k-integration-state">7.3.5. Verify integration state</a></li>
<li><a href="#camel-k-watch-logs">7.3.6. Watch Camel K integration logs</a></li>
<li><a href="#camel-k-resources">7.3.7. Manage Camel K resources</a></li>
</ul>
</li>
<li><a href="#steps-kamelet">7.4. Kamelet steps</a>
<ul class="sectlevel3">
<li><a href="#kamelet-api-version">7.4.1. API version</a></li>
<li><a href="#kamelet-create">7.4.2. Create Kamelets</a></li>
<li><a href="#kamelet-load">7.4.3. Load Kamelets</a></li>
<li><a href="#kamelet-delete">7.4.4. Delete Kamelets</a></li>
<li><a href="#kamelets-state">7.4.5. Verify Kamelet is available</a></li>
</ul>
</li>
<li><a href="#steps-pipe">7.5. Pipe steps</a>
<ul class="sectlevel3">
<li><a href="#pipe-create">7.5.1. Create Pipes</a></li>
<li><a href="#pipe-load">7.5.2. Load Pipes</a></li>
<li><a href="#pipe-delete">7.5.3. Delete Pipes</a></li>
<li><a href="#pipes-state">7.5.4. Verify Pipe is available</a></li>
<li><a href="#kamelets-resources">7.5.5. Manage Kamelet and Pipe resources</a></li>
</ul>
</li>
<li><a href="#steps-groovy">7.6. Groovy steps</a>
<ul class="sectlevel3">
<li><a href="#groovy-configuration-script">7.6.1. Framework configuration</a></li>
<li><a href="#groovy-endpoint-script">7.6.2. Endpoint configuration</a></li>
<li><a href="#groovy-action-script">7.6.3. Test actions</a></li>
<li><a href="#groovy-finally-actions">7.6.4. Finally actions</a></li>
</ul>
</li>
<li><a href="#steps-http">7.7. Http steps</a>
<ul class="sectlevel3">
<li><a href="#http-client">7.7.1. Http client steps</a></li>
<li><a href="#http-client-request">7.7.2. Send Http requests</a></li>
<li><a href="#http-client-request-raw">7.7.3. Send raw Http request data</a></li>
<li><a href="#http-client-response">7.7.4. Verify Http responses</a></li>
<li><a href="#http-client-response-raw">7.7.5. Verify raw Http response data</a></li>
<li><a href="#http-response-jsonpath">7.7.6. Verify response using JsonPath</a></li>
<li><a href="#http-server">7.7.7. Http server steps</a></li>
<li><a href="#http-server-config">7.7.8. Http server configuration</a></li>
<li><a href="#http-server-request">7.7.9. Receive Http requests</a></li>
<li><a href="#http-server-request-raw">7.7.10. Receive raw Http request data</a></li>
<li><a href="#http-request-jsonpath">7.7.11. Verify requests using JsonPath</a></li>
<li><a href="#http-server-response">7.7.12. Send Http responses</a></li>
<li><a href="#http-server-response-raw">7.7.13. Send raw Http response data</a></li>
<li><a href="#http-health-checks">7.7.14. Http health checks</a></li>
<li><a href="#http-secure">7.7.15. Https support</a></li>
</ul>
</li>
<li><a href="#steps-jdbc">7.8. JDBC steps</a>
<ul class="sectlevel3">
<li><a href="#jdbc-datasource">7.8.1. Connection configuration</a></li>
<li><a href="#jdbc-update">7.8.2. SQL update</a></li>
<li><a href="#jdbc-query">7.8.3. SQL query</a></li>
<li><a href="#result-set-verification-script">7.8.4. Result set verification script</a></li>
</ul>
</li>
<li><a href="#steps-jms">7.9. JMS steps</a>
<ul class="sectlevel3">
<li><a href="#jms-connection-factory">7.9.1. Connection factory</a></li>
<li><a href="#jms-endpoint">7.9.2. Destination and endpoint configuration</a></li>
<li><a href="#jms-send">7.9.3. Send JMS messages</a></li>
<li><a href="#jms-receive">7.9.4. Receive JMS messages</a></li>
</ul>
</li>
<li><a href="#steps-kafka">7.10. Kafka steps</a>
<ul class="sectlevel3">
<li><a href="#kafka-connection">7.10.1. Connection</a></li>
<li><a href="#kafka-endpoint">7.10.2. Topic and endpoint configuration</a></li>
<li><a href="#kafka-send">7.10.3. Send Kafka events</a></li>
<li><a href="#kafka-receive">7.10.4. Receive Kafka events</a></li>
<li><a href="#kafka-special-config">7.10.5. Special configuration</a></li>
</ul>
</li>
<li><a href="#steps-kubernetes">7.11. Kubernetes steps</a>
<ul class="sectlevel3">
<li><a href="#k8s-api-version">7.11.1. API version</a></li>
<li><a href="#k8s-client">7.11.2. Client configuration</a></li>
<li><a href="#k8s-namespace">7.11.3. Set namespace</a></li>
<li><a href="#k8s-pod-state">7.11.4. Verify pod state</a></li>
<li><a href="#k8s-watch-logs">7.11.5. Watch Kubernetes pod logs</a></li>
<li><a href="#k8s-service">7.11.6. Kubernetes services</a></li>
<li><a href="#k8s-secrets">7.11.7. Secrets</a></li>
<li><a href="#k8s-resources">7.11.8. Pods, deployments and other resources</a></li>
<li><a href="#k8s-crd">7.11.9. Custom resources</a></li>
<li><a href="#k8s-crd-condition">7.11.10. Verify custom resource conditions</a></li>
<li><a href="#k8s-autoremove">7.11.11. Cleanup Kubernetes resources</a></li>
</ul>
</li>
<li><a href="#steps-knative">7.12. Knative steps</a>
<ul class="sectlevel3">
<li><a href="#knative-api-version">7.12.1. API version</a></li>
<li><a href="#knative-client">7.12.2. Client configuration</a></li>
<li><a href="#knative-namespace">7.12.3. Set namespace</a></li>
<li><a href="#knative-broker">7.12.4. Knative broker</a></li>
<li><a href="#knative-service">7.12.5. Create event consumer service</a></li>
<li><a href="#knative-trigger">7.12.6. Manage triggers</a></li>
<li><a href="#knative-channels">7.12.7. Create channels</a></li>
<li><a href="#knative-send-events">7.12.8. Publish events</a></li>
<li><a href="#knative-receive-events">7.12.9. Receive events</a></li>
<li><a href="#knative-resources">7.12.10. Manage Knative resources</a></li>
</ul>
</li>
<li><a href="#steps-openapi">7.13. Open API steps</a>
<ul class="sectlevel3">
<li><a href="#openapi-load">7.13.1. Load OpenAPI specifications</a></li>
<li><a href="#openapi-invoke-operations">7.13.2. Invoke operations</a></li>
<li><a href="#openapi-verify-result">7.13.3. Verify operation result</a></li>
<li><a href="#openapi-verify-request">7.13.4. Verify operation requests</a></li>
<li><a href="#openapi-send-response">7.13.5. Send operation response</a></li>
<li><a href="#openapi-test-data">7.13.6. Generate test data</a></li>
<li><a href="#openapi-dictionaries">7.13.7. Inbound/outbound data dictionaries</a></li>
<li><a href="#openapi-fork-mode">7.13.8. Request fork mode</a></li>
</ul>
</li>
<li><a href="#steps-selenium">7.14. Selenium steps</a>
<ul class="sectlevel3">
<li><a href="#selenium-browser-type">7.14.1. Browser type</a></li>
<li><a href="#selenium-browser">7.14.2. Selenium broker</a></li>
<li><a href="#selenium-browser-remote">7.14.3. Remote web driver</a></li>
<li><a href="#selenium-start-stop">7.14.4. Start/stop browser</a></li>
<li><a href="#selenium-navigate">7.14.5. Navigate to URL</a></li>
<li><a href="#selenium-verify-elements">7.14.6. Verify elements on page</a></li>
<li><a href="#selenium-click">7.14.7. Click elements</a></li>
<li><a href="#selenium-forms">7.14.8. Form controls</a></li>
<li><a href="#selenium-alert">7.14.9. Alert dialogs</a></li>
<li><a href="#selenium-pages">7.14.10. Page objects</a></li>
<li><a href="#selenium-page-validators">7.14.11. Page validator</a></li>
</ul>
</li>
<li><a href="#steps-testcontainers">7.15. Testcontainers steps</a>
<ul class="sectlevel3">
<li><a href="#testcontainer-priviledges">7.15.1. Setup required privileges</a></li>
<li><a href="#testcontainer-database">7.15.2. Database containers</a></li>
<li><a href="#testcontainer-postgresql">7.15.3. PostgreSQL container</a></li>
<li><a href="#testcontainer-mongodb">7.15.4. MongoDB container</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#extensions">8. Extensions</a>
<ul class="sectlevel2">
<li><a href="#extensions-minio">8.1. Minio upload</a></li>
<li><a href="#extensions-jitpack">8.2. Jitpack extensions</a></li>
</ul>
</li>
<li><a href="#pre-post-scripts">9. Pre/Post scripts</a>
<ul class="sectlevel2">
<li><a href="#scripts-env">9.1. Environment variables in scripts</a></li>
<li><a href="#conditional-scripts">9.2. Conditional execution</a></li>
</ul>
</li>
<li><a href="#reports">10. Reporting</a></li>
<li><a href="#contributing">11. Contributing</a></li>
<li><a href="#uninstall">12. Uninstall</a></li>
<li><a href="#samples">13. Samples</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong>Version: 0.19.2</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/yaks-logo.png" alt="yaks-logo">
</div>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="preface"><a class="anchor" href="#preface"></a><a class="link" href="#preface">1. What is YAKS!?</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>YAKS is a framework to enable Cloud Native BDD testing on Kubernetes! Cloud Native here means that your tests execute
as Kubernetes PODs.</p>
</div>
<div class="paragraph">
<p>As a user you can run tests by creating a <code>Test</code> custom resource on your favorite Kubernetes based cloud provider.
Once the YAKS operator is installed it will listen for custom resources and automatically prepare a test runtime
that runs the test as part of the cloud infrastructure.</p>
</div>
<div class="paragraph">
<p>Tests in YAKS follow the BDD (Behavior Driven Development) concept and represent feature specifications written
in <a href="https://cucumber.io/docs/gherkin/">Gherkin</a> syntax.</p>
</div>
<div class="paragraph">
<p>As a framework YAKS provides a set of predefined <a href="https://cucumber.io/">Cucumber</a> steps which help you to connect with different
messaging transports (Http REST, JMS, Kafka, Knative eventing) and verify message data with assertions on the header and body content.</p>
</div>
<div class="paragraph">
<p>YAKS adds its functionality on top of on <a href="https://citrusframework.org">Citrus</a> for connecting to different endpoints as a client
and/or server.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quickstart"><a class="anchor" href="#quickstart"></a><a class="link" href="#quickstart">2. Getting started</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Assuming you have a Kubernetes playground and that you are connected to a namespace on that cluster
just write a <code>helloworld.feature</code> BDD file with the following content:</p>
</div>
<div class="listingblock">
<div class="title">helloworld.feature</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Feature: Hello

  Scenario: Print hello message
    Given print 'Hello from YAKS!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then execute the following command using the <a href="https://github.com/citrusframework/yaks/releases/">YAKS CLI tool</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks run helloworld.feature</code></pre>
</div>
</div>
<div class="paragraph">
<p>This runs the test immediately on the current namespace in your connected Kubernetes cluster.
Nothing else is needed.</p>
</div>
<div class="paragraph">
<p>Continue reading the documentation and learn how to install and get started working with YAKS.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation"><a class="anchor" href="#installation"></a><a class="link" href="#installation">3. Installation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>YAKS directly runs the test as part of a cloud infrastructure by leveraging the <a href="https://sdk.operatorframework.io/">Operator SDK</a>
and the concept of custom resources in Kubernetes.</p>
</div>
<div class="paragraph">
<p>As a user you need to enable YAKS on your infrastructure by installing the operator and creating the required custom resources and roles.</p>
</div>
<div class="sect2">
<h3 id="installation-requirements"><a class="anchor" href="#installation-requirements"></a><a class="link" href="#installation-requirements">3.1. Requirements</a></h3>
<div class="paragraph">
<p>You need access to a Kubernetes or Openshift cluster in order to use YAKS. You have different options
to setup/use a Kubernetes or OpenShift cluster.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://minikube.sigs.k8s.io/docs/start/">Minikube</a></p>
</li>
<li>
<p><a href="https://docs.okd.io/3.11/minishift/getting-started/index.html">Minishift</a></p>
</li>
<li>
<p><a href="https://code-ready.github.io/crc/">Red Hat CodeReady Containers (CRC)</a></p>
</li>
<li>
<p><a href="https://console.cloud.google.com/">Google Kubernetes Engine (GKE)</a></p>
</li>
<li>
<p><a href="https://cloud.redhat.com/">OpenShift</a></p>
</li>
<li>
<p><a href="https://cloud.ibm.com/">IBM Kubernetes Service (IKS)</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Obviously the cluster will be the place where the tests will be executed and probably also the place where to run the SUT (System Under Test).</p>
</div>
<div class="paragraph">
<p>For setting up roles and custom resources you may need to have administrative rights on that cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="installation-windows"><a class="anchor" href="#installation-windows"></a><a class="link" href="#installation-windows">3.2. Windows prerequisite</a></h3>
<div class="paragraph">
<p>For full support of Yaks on Windows please enable "Windows Subsystem for Linux". You can do it manually by heading to Control Panel &gt; Programs &gt; Turn
Windows Features On or Off and checking "Windows Subsystem for Linux". Or you can simply execute this command in powershell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux</code></pre>
</div>
</div>
<div class="paragraph">
<p>This action requires a full reboot of the system.</p>
</div>
</div>
<div class="sect2">
<h3 id="installation-operator"><a class="anchor" href="#installation-operator"></a><a class="link" href="#installation-operator">3.3. Operator install</a></h3>
<div class="paragraph">
<p>The YAKS operator will listen for new test resources in order to run those on the cloud infrastructure.
The operators is in charge of preparing a proper runtime for each test and it will reconcile the status of a test.</p>
</div>
<div class="paragraph">
<p>The easiest way to getting started with the YAKS operator installation is to use the <strong>YAKS CLI</strong>.
You can download the CLI from the <a href="https://github.com/citrusframework/yaks/releases/">release page</a> where you will find installation
archives for different operating systems.</p>
</div>
<div class="paragraph">
<p>Download and decompress the archive. The archive holds a binary that will help you to install YAKS and run the tests.
To install the <code>yaks</code> binary, just make it runnable and move it to a location in your <code>$PATH</code>, e.g. on linux:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script"># Make executable and move to usr/local/bin
$ chmod a+x yaks-${project.version}-linux-64bit
$ mv yaks-${project.version}-linux-64bit /usr/local/bin/yaks

# Alternatively, set a symbolic link to "yaks"
$ mv yaks-${project.version}-linux-64bit yaks
$ ln -s $(pwd)/yaks /usr/local/bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have the <code>yaks</code> CLI available, log into your cluster using the
standard <code>oc</code> (OpenShift) or <code>kubectl</code> (Kubernetes) client tool.</p>
</div>
<div class="paragraph">
<p>Once you are properly connected to your cluster execute the following command to install YAKS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will install and run the YAKS operator in the current namespace.</p>
</div>
<div class="paragraph">
<p>You can specify the target namespace where to run the operator with a <code>--namespace</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks install -n kube-operators</code></pre>
</div>
</div>
<div class="paragraph">
<p>The namespace must available on the cluster before running the install command. If the namespace has not
been created, yet you can create it with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">kubectl create namespace kube-operators</code></pre>
</div>
</div>
<div class="paragraph">
<p>If not already configured, the command will also setup the YAKS custom resource definitions and roles
on the cluster (in this case, the user needs cluster-admin permissions).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Custom Resource Definitions (CRD) are cluster-wide objects and you need admin rights to install them. Fortunately, this
operation can be done <strong>once per cluster</strong>. So, if the <code>yaks install</code> operation fails, you&#8217;ll be asked to repeat it when logged as admin.
For Minishift, this means executing <code>oc login -u system:admin</code> then <code>yaks install --cluster-setup</code> only for the first-time installation.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="installation-global-mode"><a class="anchor" href="#installation-global-mode"></a><a class="link" href="#installation-global-mode">3.3.1. Global mode</a></h4>
<div class="paragraph">
<p>By default, the installation is using a <code>global</code> operator mode. This means that the operator
only lives once in your cluster watching for tests in all namespaces. A global operator uses cluster-roles
in order to manage tests in all namespaces.</p>
</div>
<div class="paragraph">
<p>When running on OpenShift the default namespace for global operators is <code>openshift-operators</code> (it is available by default). Be sure to
select this namespace when installing YAKS in the global mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks install -n openshift-operators</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="installation-namespaced-mode"><a class="anchor" href="#installation-namespaced-mode"></a><a class="link" href="#installation-namespaced-mode">3.3.2. Namespaced mode</a></h4>
<div class="paragraph">
<p>You can disable the <code>global</code> mode with a CLI setting when running the <code>install</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks install --global=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the non global <code>namespaced</code> mode the YAKS operator will only have the rights to create new tests in the same namespace as it is
running on. The operator will only watch for tests created in that the very same namespace.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Which mode to choose depends on your very specific needs. When you expect to have many tests in different namespaces that will
be recreated on a regular basis you may choose the global operator mode because you will not have to reinstall the operator many times.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you expect to have all tests in a single namespace or if you do not want to use cluster-wide operator permissions
for some reason you may want to switch the namespaced mode.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please also have a look at the <a href="#temporary-namespaces">temporary namespaces</a> section in this guide to make a decision on operator modes.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="installation-verify"><a class="anchor" href="#installation-verify"></a><a class="link" href="#installation-verify">3.4. Verify installation</a></h3>
<div class="paragraph">
<p>You can verify the installation by retrieving the custom resource definition provided in YAKS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">kubectl get customresourcedefinitions -l app=yaks</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">NAME                             CREATED AT
tests.yaks.citrusframework.org   2020-11-01T00:00:00Z</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following command will list all tests in your namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">kubectl get tests</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">NAME         PHASE    TOTAL   PASSED   FAILED   SKIPPED   ERRORS
helloworld   Passed   1       1        0        0</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running"><a class="anchor" href="#running"></a><a class="link" href="#running">4. Running</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>After completing and verifying the <a href="installation" class="bare">installation</a> you can start running some tests.</p>
</div>
<div class="paragraph">
<p>You should be connected to your Kubernetes cluster and you should have the YAKS CLI tool available on your machine.</p>
</div>
<div class="paragraph">
<p>You can verify the proper YAKS CLI setup with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks version</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will print the YAKS version to the output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">YAKS ${project.version}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You are now ready to run a first BDD test on the cluster. As a sample create a new feature file that prints some message
to the test output.</p>
</div>
<div class="listingblock">
<div class="title">helloworld.feature</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Feature: Hello

  Scenario: Print hello message
    Given print 'Hello from YAKS!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You just need this single file to run the test on the cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks run helloworld.feature</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will be provided with the log output of the test and see the results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>test "helloworld" created
+ test-helloworld  test
test-helloworld test INFO	|
test-helloworld test INFO	| ------------------------------------------------------------------------
test-helloworld test INFO	|        .__  __
test-helloworld test INFO	|   ____ |__|/  |________ __ __  ______
test-helloworld test INFO	| _/ ___\|  \   __\_  __ \  |  \/  ___/
test-helloworld test INFO	| \  \___|  ||  |  |  | \/  |  /\___ \
test-helloworld test INFO	|  \___  &gt;__||__|  |__|  |____//____  &gt;
test-helloworld test INFO	|      \/                           \/
test-helloworld test INFO	|
test-helloworld test INFO	| C I T R U S  T E S T S  3.0.0-M2
test-helloworld test INFO	|
test-helloworld test INFO	| ------------------------------------------------------------------------
test-helloworld test INFO	|
test-helloworld test
test-helloworld test Scenario: Print hello message    # org/citrusframework/yaks/helloworld.feature:3
test-helloworld test   Given print 'Hello from YAKS!' # org.citrusframework.yaks.standard.StandardSteps.print(java.lang.String)
test-helloworld test INFO	| ------------------------------------------------------------------------
test-helloworld test INFO	|
test-helloworld test INFO	| CITRUS TEST RESULTS
test-helloworld test INFO	|
test-helloworld test INFO	|  Print hello message ............................................ SUCCESS
test-helloworld test INFO	|
test-helloworld test INFO	| TOTAL:	1
test-helloworld test INFO	| FAILED:	0 (0.0%)
test-helloworld test INFO	| SUCCESS:	1 (100.0%)
test-helloworld test INFO	|
test-helloworld test INFO	| ------------------------------------------------------------------------
test-helloworld test
test-helloworld test 1 Scenarios (1 passed)
test-helloworld test 1 Steps (1 passed)
test-helloworld test 0m1.631s
test-helloworld test
test-helloworld test
Test Passed
Test results: Total: 1, Passed: 1, Failed: 0, Skipped: 0
	Print hello message (helloworld.feature:3): Passed</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, log levels are set to a minimum so you are not bothered with too much boilerplate output. You can increase log levels
with the command line option <code>--logger</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks run helloworld.feature --logger root=INFO</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="#logging">logging configuration</a> section in thi guide gives you some more details on this topic.</p>
</div>
<div class="paragraph">
<p>You are now ready to explore the different <a href="steps" class="bare">steps</a> that you can use in a feature file in order to connect with
various messaging transports as part of your test.</p>
</div>
<div class="sect2">
<h3 id="running-monitoring"><a class="anchor" href="#running-monitoring"></a><a class="link" href="#running-monitoring">4.1. Status monitoring</a></h3>
<div class="paragraph">
<p>As you run tests with YAKS you add tests to the current namespace. You can review the test status and monitor the
test results with the default Kubernetes CLI tool.</p>
</div>
<div class="paragraph">
<p>The following command will list all tests in your namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">kubectl get tests</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">NAME         PHASE    TOTAL   PASSED   FAILED   SKIPPED   ERRORS
helloworld   Passed   1       1        0        0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The overview includes the test outcome and outline the number of total scenarios that have been executed and the
test results for these scenarios (skipped, passed or failed). When a scenario has been failing the error message is also
displayed in this overview.</p>
</div>
<div class="paragraph">
<p>You can get more details of a single test with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">kubectl get test helloworld -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>This gets you the complete test details as a YAML file. You can then review status and detailed error messages.</p>
</div>
<div class="paragraph">
<p>Find out more about the individual test results and how to get reports (e.g. JUnit) from a test run in the
section about <a href="reporting" class="bare">reporting</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cli"><a class="anchor" href="#cli"></a><a class="link" href="#cli">5. Command line interface (yaks)</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The YAKS command line interface (yaks) is the main entry point for
installing the operator and for running tests on a Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>Releases of the CLI are available on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GitHub Releases: <a href="https://github.com/citrusframework/yaks/releases" class="bare">https://github.com/citrusframework/yaks/releases</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="cli-commands"><a class="anchor" href="#cli-commands"></a><a class="link" href="#cli-commands">5.1. Available Commands</a></h3>
<div class="paragraph">
<p>Some of the most used commands are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Useful Commands</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtain the full list of available commands</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yaks help</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">completion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates completion scripts (bash, zsh)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yaks completion</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">install</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install YAKS operator and setup cluster (roles, CRDs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yaks install</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add roles and role bindings to the YAKS operator in order to manage additional custom resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yaks role --add role-foo.yaml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List the results of all tests on given namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yaks list</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">run</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deploys and executes a test on given namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yaks run helloworld.feature</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete tests by name from given namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yaks delete helloworld.feature</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">report</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fetch and generate reports from test results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yaks report --fetch -o junit</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dump</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dump all YAKS resources in current namespace (operator, tests, jobs, pods, configmaps, &#8230;&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yaks dump</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">upload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upload custom artifacts (steps, extensions) to Minio storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yaks upload ./steps/my-custom-steps</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uninstall</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove YAKS (operator, roles, CRDs, &#8230;&#8203;) from the cluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yaks uninstall</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print current YAKS version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yaks version</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The list above is not the full list of available commands. You can run <code>yaks help</code> to obtain the full list.
Each sub-command also takes <code>--help</code> as parameter to output more information on that specific command usage:</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-help"><a class="anchor" href="#cli-help"></a><a class="link" href="#cli-help">5.2. help</a></h3>
<div class="listingblock">
<div class="title">Overall help page</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks help</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Display help page</div>
<div class="content">
<pre class="prettyprint highlight"><code>YAKS is a platform to enable Cloud Native BDD testing on Kubernetes.

Usage:
  yaks [command]

Available Commands:
  completion  Generates completion scripts
  delete      Delete tests
  dump        Dump the state of YAKS resources for a test
  help        Help about any command
  install     Installs YAKS on a Kubernetes cluster
  list        List tests
  log         Print the logs of given test
  report      Generate test report from last test run
  role        Manage YAKS operator roles and role bindings
  run         Run tests
  uninstall   Uninstall YAKS from a Kubernetes cluster
  upload      Upload a local test artifact to the cluster
  version     Display version information

Flags:
      --config string      Path to the config file to use for CLI requests
  -h, --help               help for yaks
  -n, --namespace string   Namespace to use for all operations

Use "yaks [command] --help" for more information about a command.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Command specific help</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks [command] --help</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks upload --help

Upload a local test artifact to the cluster so that it can be used when running a test.

Usage:
  yaks upload artifact [flags]

Flags:
  -h, --help   help for upload

Global Flags:
      --config string      Path to the config file to use for CLI requests (default "/Users/cdeppisc/Projects/IBMcloud/auth/kubeconfig")
  -n, --namespace string   Namespace to use for all operations
  -v, --verbose            Print details while performing an operation</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cli-install"><a class="anchor" href="#cli-install"></a><a class="link" href="#cli-install">5.3. install</a></h3>
<div class="paragraph">
<p>The command <code>install</code> performs the YAKS installation on a target cluster. The command has two separate install steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Setup cluster resources (CRDs, roles, rolebindings)</p>
</li>
<li>
<p>Install YAKS operator to current namespace (or to the provided namespace in settings)</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="cli-role"><a class="anchor" href="#cli-role"></a><a class="link" href="#cli-role">5.4. role</a></h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-list"><a class="anchor" href="#cli-list"></a><a class="link" href="#cli-list">5.5. list</a></h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-run"><a class="anchor" href="#cli-run"></a><a class="link" href="#cli-run">5.6. run</a></h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-delete"><a class="anchor" href="#cli-delete"></a><a class="link" href="#cli-delete">5.7. delete</a></h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-logs"><a class="anchor" href="#cli-logs"></a><a class="link" href="#cli-logs">5.8. log</a></h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-report"><a class="anchor" href="#cli-report"></a><a class="link" href="#cli-report">5.9. report</a></h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-dump"><a class="anchor" href="#cli-dump"></a><a class="link" href="#cli-dump">5.10. dump</a></h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-upload"><a class="anchor" href="#cli-upload"></a><a class="link" href="#cli-upload">5.11. upload</a></h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-uninstall"><a class="anchor" href="#cli-uninstall"></a><a class="link" href="#cli-uninstall">5.12. uninstall</a></h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-version"><a class="anchor" href="#cli-version"></a><a class="link" href="#cli-version">5.13. version</a></h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a><a class="link" href="#configuration">6. Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several runtime options that you can set in order to configure which tests to run for instance. Each test directory
can have its own <code>yaks-config.yaml</code> configuration file that holds the runtime options for this specific test suite.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">config:
  runtime:
    cucumber:
      tags:
      - "not @ignored"
      glue:
      - "org.citrusframework.yaks"
      - "com.company.steps.custom"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above uses different runtime options for Cucumber to specify a tag filter and some custom glue packages that
should be loaded. The given runtime options will be set as environment variables in the YAKS runtime pod.</p>
</div>
<div class="paragraph">
<p>You can also specify the Cucumber options that get passed to the Cucumber runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">config:
  runtime:
    cucumber:
      options: "--strict --monochrome --glue org.citrusframework.yaks"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also we can make use of command line options when using the <code>yaks</code> binary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks run hello-world.feature --tag @regression --glue org.citrusframework.yaks</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="configuration-dependencies"><a class="anchor" href="#configuration-dependencies"></a><a class="link" href="#configuration-dependencies">6.1. Runtime dependencies</a></h3>
<div class="paragraph">
<p>The YAKS testing framework provides a base runtime image that holds all required libraries and artifacts to execute tests. You may need to add
additional runtime dependencies though in order to extend the framework capabilities.</p>
</div>
<div class="paragraph">
<p>For instance when using a Camel route in your test you may need to add additional Camel components that are not part in the
basic YAKS runtime (e.g. camel-groovy). You can add the runtime dependency to the YAKS runtime image in multiple ways:</p>
</div>
<div class="sect3">
<h4 id="configuration-tags"><a class="anchor" href="#configuration-tags"></a><a class="link" href="#configuration-tags">6.1.1. Cucumber tags</a></h4>
<div class="paragraph">
<p>You can simply add a tag to your BDD feature specification in order to declare a runtime dependency for your test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">@require('org.apache.camel:camel-groovy:@camel.version@')
Feature: Camel route testing

  Background:
    Given Camel route hello.xml
    """
    &lt;route&gt;
      &lt;from uri="direct:hello"/&gt;
      &lt;filter&gt;
        &lt;groovy&gt;request.body.startsWith('Hello')&lt;/groovy&gt;
        &lt;to uri="log:org.citrusframework.yaks.camel?level=INFO"/&gt;
      &lt;/filter&gt;
      &lt;split&gt;
        &lt;tokenize token=" "/&gt;
        &lt;to uri="seda:tokens"/&gt;
      &lt;/split&gt;
    &lt;/route&gt;
    """

  Scenario: Hello route
    When send to route direct:hello body: Hello Camel!
    And receive from route seda:tokens body: Hello
    And receive from route seda:tokens body: Camel!</code></pre>
</div>
</div>
<div class="paragraph">
<p>The given Camel route uses the groovy language support and this is not part in the basic YAKS runtime image. So we add
the tag <code>@require('org.apache.camel:camel-groovy:@camel.version@')</code>. This tag will load the Maven dependency at runtime
before the test is executed in the YAKS runtime image.</p>
</div>
<div class="paragraph">
<p>Note that you have to provide proper Maven artifact coordinates with proper <code>groupId</code>, <code>artifactId</code> and <code>version</code>. You can make
use of version properties for these versions available in the YAKS base image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>citrus.version</p>
</li>
<li>
<p>camel.version</p>
</li>
<li>
<p>spring.version</p>
</li>
<li>
<p>cucumber.version</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuration-properties"><a class="anchor" href="#configuration-properties"></a><a class="link" href="#configuration-properties">6.1.2. System property or environment setting</a></h4>
<div class="paragraph">
<p>You can add dependencies also by specifying the dependencies as command line parameter when running the test via <code>yaks</code> CLI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks run --dependency org.apache.camel:camel-groovy:@camel.version@ camel-route.feature</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will add a environment setting in the YAKS runtime container and the dependency will be loaded automatically
at runtime.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration-properties-file"><a class="anchor" href="#configuration-properties-file"></a><a class="link" href="#configuration-properties-file">6.1.3. Property file</a></h4>
<div class="paragraph">
<p>YAKS supports adding runtime dependency information to a property file called <code>yaks.properties</code>. The dependency is added through
Maven coordinates in the property file using a common property key prefix <code>yaks.dependency.</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties"># include these dependencies
yaks.dependency.foo=org.foo:foo-artifact:1.0.0
yaks.dependency.bar=org.bar:bar-artifact:1.5.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add the property file when running the test via <code>yaks</code> CLI like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks run --settings yaks.properties camel-route.feature</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuration-file"><a class="anchor" href="#configuration-file"></a><a class="link" href="#configuration-file">6.1.4. YAKS configuration file</a></h4>
<div class="paragraph">
<p>When more dependencies are required to run a test you may consider to add a configuration file as <code>.yaml</code> or <code>.json</code>.</p>
</div>
<div class="paragraph">
<p>The configuration file is able to declare multiple dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">dependencies:
  - groupId: org.foo
    artifactId: foo-artifact
    version: 1.0.0
  - groupId: org.bar
    artifactId: bar-artifact
    version: 1.5.0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="json">{
  "dependencies": [
    {
      "groupId": "org.foo",
      "artifactId": "foo-artifact",
      "version": "1.0.0"
    },
    {
      "groupId": "org.bar",
      "artifactId": "bar-artifact",
      "version": "1.5.0"
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add the configuration file when running the test via <code>yaks</code> CLI like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks run --settings yaks.settings.yaml camel-route.feature</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-repositories"><a class="anchor" href="#configuration-repositories"></a><a class="link" href="#configuration-repositories">6.2. Maven repositories and pluginRepositories</a></h3>
<div class="paragraph">
<p>When adding custom runtime dependencies those artifacts might not be available on the public central Maven repository.
Instead you may need to add a custom Maven repository that holds your artifacts.</p>
</div>
<div class="paragraph">
<p>You can do this with several configuration options:</p>
</div>
<div class="sect3">
<h4 id="configuration-repository-properties"><a class="anchor" href="#configuration-repository-properties"></a><a class="link" href="#configuration-repository-properties">6.2.1. System property or environment setting</a></h4>
<div class="paragraph">
<p>You can add repositories also by specifying the repositories as command line parameter when running the test via <code>yaks</code> CLI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks run --maven-repository jboss-ea=https://repository.jboss.org/nexus/content/groups/ea/ my.feature</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks run --maven-plugin-repository jboss-ea=https://repository.jboss.org/nexus/content/groups/ea/ my.feature</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will add a environment setting in the YAKS runtime container and the repository will be added to the Maven runtime project model.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration-repository-file"><a class="anchor" href="#configuration-repository-file"></a><a class="link" href="#configuration-repository-file">6.2.2. Property file</a></h4>
<div class="paragraph">
<p>YAKS supports adding Maven repository information to a property file called <code>yaks.properties</code>. The dependency is added through
Maven repository id and url in the property file using a common property key prefix <code>yaks.repository.</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties"># Maven repositories
yaks.repository.central=https://repo.maven.apache.org/maven2/
yaks.repository.jboss-ea=https://repository.jboss.org/nexus/content/groups/ea/

# Maven plugin repositories
yaks.pluginRepository.central=https://repo.maven.apache.org/maven2/
yaks.pluginRepository.jboss-ea=https://repository.jboss.org/nexus/content/groups/ea/</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add the property file when running the test via <code>yaks</code> CLI like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks run --settings yaks.properties my.feature</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuration-repository-config"><a class="anchor" href="#configuration-repository-config"></a><a class="link" href="#configuration-repository-config">6.2.3. YAKS configuration file</a></h4>
<div class="paragraph">
<p>More complex repository configuration might require to add a configuration file as <code>.yaml</code> or <code>.json</code>.</p>
</div>
<div class="paragraph">
<p>The configuration file is able to declare multiple repositories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">repositories:
  - id: "central"
    name: "Maven Central"
    url: "https://repo.maven.apache.org/maven2/"
    releases:
      enabled: "true"
      updatePolicy: "daily"
    snapshots:
      enabled: "false"
  - id: "jboss-ea"
    name: "JBoss Community Early Access Release Repository"
    url: "https://repository.jboss.org/nexus/content/groups/ea/"
    layout: "default"

pluginRepositories:
  - id: "central"
    name: "Maven Central"
    url: "https://repo.maven.apache.org/maven2/"
    releases:
      enabled: "true"
      updatePolicy: "daily"
    snapshots:
      enabled: "false"
  - id: "jboss-ea"
    name: "JBoss Community Early Access Release Repository"
    url: "https://repository.jboss.org/nexus/content/groups/ea/"
    layout: "default"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="json">{
  "repositories": [
      {
        "id": "central",
        "name": "Maven Central",
        "url": "https://repo.maven.apache.org/maven2/",
        "releases": {
          "enabled": "true",
          "updatePolicy": "daily"
        },
        "snapshots": {
          "enabled": "false"
        }
      },
      {
        "id": "jboss-ea",
        "name": "JBoss Community Early Access Release Repository",
        "url": "https://repository.jboss.org/nexus/content/groups/ea/",
        "layout": "default"
      }
    ],
    "pluginRepositories": [
      {
        "id": "central",
        "name": "Maven Central",
        "url": "https://repo.maven.apache.org/maven2/",
        "releases": {
          "enabled": "true",
          "updatePolicy": "daily"
        },
        "snapshots": {
          "enabled": "false"
        }
      },
      {
        "id": "jboss-ea",
        "name": "JBoss Community Early Access Release Repository",
        "url": "https://repository.jboss.org/nexus/content/groups/ea/",
        "layout": "default"
      }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add the configuration file when running the test via <code>yaks</code> CLI like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks run --settings yaks.settings.yaml my.feature</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-secrets"><a class="anchor" href="#configuration-secrets"></a><a class="link" href="#configuration-secrets">6.3. Using secrets</a></h3>
<div class="paragraph">
<p>Tests usually need to use credentials and connection URLs in order to connect to infrastructure components and services.
This might be sensitive data that should not go into the test configuration directly as hardcoded value. You should rather load the
credentials from a secret volume source.</p>
</div>
<div class="paragraph">
<p>To use the implicit configuration via secrets, we first need to create a configuration file holding the properties of a named configuration.</p>
</div>
<div class="listingblock">
<div class="title">mysecret.properties</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties"># Only configuration related to the "mysecret" named config
database.url=jdbc:postgresql://syndesis-db:5432/sampledb
database.user=admin
database.password=special</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can create a secret from that file and label it so that it will be picked up automatically by the YAKS operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script"># Create the secret from the property file
kubectl create secret generic my-secret --from-file=mysecret.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the secret is created you can bind it to tests by their name. Given the test <code>my-test.feature</code> you can bind the secret to the test
by adding a label as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script"># Bind secret to the "my-test" test case
kubectl label secret my-secret yaks.citrusframework.org/test=my-test</code></pre>
</div>
</div>
<div class="paragraph">
<p>For multiple secrets and variants of secrets on different environments (e.g. dev, test, staging) you can add a secret id and label that one
explicitly in addition to the test name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script"># Bind secret to the named configuration "staging" of the "my-test" test case
kubectl label secret my-secret yaks.citrusframework.org/test=my-test yaks.citrusframework.org/test.configuration=staging</code></pre>
</div>
</div>
<div class="paragraph">
<p>With that in place you just need to set the secret id in your <code>yaks-config.yaml</code> for that test.</p>
</div>
<div class="listingblock">
<div class="title">yaks-config.yaml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">config:
  runtime:
    secret: staging</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now write a test and use the secret properties as normal test variables:</p>
</div>
<div class="listingblock">
<div class="title">my-test.feature</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Feature: JDBC API

  Background:
    Given Database connection
      | url       | ${database.url} |
      | username  | ${database.user} |
      | password  | ${database.password} |</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="steps"><a class="anchor" href="#steps"></a><a class="link" href="#steps">7. Steps</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each line in a BDD feature file is backed by a step implementation that covers the actual runtime logic executed. YAKS
provides a set of step implementations that you can just out-of-the-box use in your feature file.</p>
</div>
<div class="paragraph">
<p>See the following step implementations that enable you to cover various areas of messaging and integration testing.</p>
</div>
<div class="sect2">
<h3 id="steps-standard"><a class="anchor" href="#steps-standard"></a><a class="link" href="#steps-standard">7.1. Standard steps</a></h3>
<div class="paragraph">
<p>The standard steps in YAKS provide a lot of basic functionality that you can just use in your feature files. The functionality is shipped as
predefined steps that you add to a feature as you write your test.</p>
</div>
<div class="paragraph">
<p>Most of the standard steps do leverage capabilities of the underlying test framework Citrus such as creating test variables or printing messages
to the log output.</p>
</div>
<div class="sect3">
<h4 id="steps-variables"><a class="anchor" href="#steps-variables"></a><a class="link" href="#steps-variables">7.1.1. Create variables</a></h4>
<div class="paragraph">
<p>Test variables represent the fundamental concept to own test data throughout your test. Once a variable has been created
you can reference its value in many places in YAKS and Citrus. You can add a new identifier as a variable and reference
its value in many places such as message headers, body content, SQL statements and many more.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^variable {name} is \"{value}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given variable orderId is "1001"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create the variable <code>orderId</code> in the current test context. All subsequent steps and operations may reference the variable with the expression <code>${orderId}</code>.
Citrus makes sure to replace the variable placeholder with its actual value before sending out messages and before validating incoming messages. As already mentioned
you can use the variable placeholder expression in many places such as message headers and body content:</p>
</div>
<div class="listingblock">
<div class="title">Variable placeholder in a Json payload</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="json">{
  "id": "${orderId}",
  "name": "Watermelon",
  "amount": 10
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can create multiple variables in one single step using:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^variables$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given variables
  | orderId  | 1001      |
  | name     | Pineapple |</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also load variables from an external property file resource.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load variables {file}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load variables {file}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The given <code>{file}</code> should be a property file holding one to many test variables with key and value.</p>
</div>
<div class="listingblock">
<div class="title">variable.properties</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">greeting=Hola
name=Christoph
text=YAKS rocks!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes variables values are too big to write them directly into the feature file (e.g. large request/response body data).
In this case you may want to load the variable value from an external file.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load variable {name} from {file}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load variable {name} from {file}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step loads the file content as a String value and references it as a new test variable with the given name.</p>
</div>
<div class="listingblock">
<div class="title">Load test variable from file</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load variable body from request.json
Then log 'Sending request body: ${body}'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="steps-log"><a class="anchor" href="#steps-log"></a><a class="link" href="#steps-log">7.1.2. Log steps</a></h4>
<div class="paragraph">
<p>Logging a message to the output can be helpful in terms of debugging and/or to give information about the context of an operation.</p>
</div>
<div class="paragraph">
<p>YAKS provides following steps to add log output:</p>
</div>
<div class="listingblock">
<div class="title">@Then("^(?:log|print) '{text}'$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then print 'YAKS provides Cloud native BDD testing!'
And log 'YAKS rocks!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The steps are printing log messages to the output using INFO level. The text that is printed supports test variables
and functions. All placeholders will be replaced before logging.</p>
</div>
<div class="paragraph">
<p>You can also use multiline log messages as shown in the next example.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^(?:log|print)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given print
"""
Hello users!

YAKS provides Cloud Native BDD testing on Kubernetes!
"""</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="steps-sleep"><a class="anchor" href="#steps-sleep"></a><a class="link" href="#steps-sleep">7.1.3. Sleep</a></h4>
<div class="paragraph">
<p>The <code>sleep</code> step lets the test run wait for a given amount of time (in milliseconds). During the sleep no action will be performed and the subsequent steps are postponed respectively.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^sleep$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then sleep</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above step performs a sleep with the default time of 5000 milliseconds.</p>
</div>
<div class="paragraph">
<p>You can also provide the duration to sleep in milliseconds or ISO 8601 format.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^sleep {time} ms$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then sleep 2500 ms</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step receives a numeric parameter that represents the amount of time (in milliseconds) to wait.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^sleep {hours}h {minutes}min {seconds}sec {milliseconds}ms$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then sleep 1h 25min 15sec 500ms</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-camel"><a class="anchor" href="#steps-camel"></a><a class="link" href="#steps-camel">7.2. Apache Camel steps</a></h3>
<div class="paragraph">
<p>Apache Camel is a very popular enterprise integration library that provides a huge set of ready to use components and
endpoints for you to connect with different messaging transports. Also many data formats are supported in Camel so you will be able
to incorporate with almost any software interface exchanging data over the wire.</p>
</div>
<div class="paragraph">
<p>YAKS adds steps to use Apache Camel as part of a test. You are able to send and receive messages with Camel components and make
use of the enterprise integration patterns and data formats implemented in Apache Camel.</p>
</div>
<div class="sect3">
<h4 id="camel-context"><a class="anchor" href="#camel-context"></a><a class="link" href="#camel-context">7.2.1. Create Camel context</a></h4>
<div class="paragraph">
<p>The Camel context is a central place to add routes and manage Camel capabilities and services. You can start a new default
(empty) Camel context using the following step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Default|New) Camel context$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Default Camel context</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will setup and start a new Camel context as part og the current test scenario. You can now create and add routes to this
context. In case you have special configuration and/or some default routes that you need to initialize as part of the
context you can provide a Camel Spring bean configuration in the Camel context step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^New Spring Camel context$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given New Spring Camel context
"""
&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                          http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd"&gt;
  &lt;camelContext id="helloContext" xmlns="http://camel.apache.org/schema/spring"&gt;
    &lt;route id="helloRoute"&gt;
      &lt;from uri="direct:hello"/&gt;
      &lt;to uri="log:org.citrusframework.yaks.camel?level=INFO"/&gt;
      &lt;split&gt;
        &lt;tokenize token=" "/&gt;
        &lt;to uri="seda:tokens"/&gt;
      &lt;/split&gt;
    &lt;/route&gt;
  &lt;/camelContext&gt;
&lt;/beans&gt;
"""</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="camel-routes-create"><a class="anchor" href="#camel-routes-create"></a><a class="link" href="#camel-routes-create">7.2.2. Create Camel routes</a></h4>
<div class="paragraph">
<p>In Apache Camel you need to create routes in order to start producing/consuming data from endpoints. The routes can be defined
in XML or Groovy.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Camel route {name}.xml")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Camel route hello.xml
"""
&lt;route&gt;
  &lt;from uri="direct:hello"/&gt;
  &lt;to uri="log:org.citrusframework.yaks.camel?level=INFO"/&gt;
  &lt;split&gt;
    &lt;tokenize token=" "/&gt;
    &lt;to uri="seda:tokens"/&gt;
  &lt;/split&gt;
&lt;/route&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to XML route definitions YAKS also supports the Groovy DSL.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Camel route {name}.groovy")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Camel route hello.groovy
"""
from("direct:hello")
 .to("log:org.citrusframework.yaks.camel?level=${logLevel}")
 .split(body().tokenize(" "))
   .to("seda:tokens")
 .end()
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above steps create the Camel routes and automatically starts them in the current context. The given routes start
to consume messages from the endpoint <code>direct:hello</code>.</p>
</div>
<div class="paragraph">
<p>You can also load the Camel route from a file resource.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load Camel route path/to/{name}.{language}")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load Camel route hello.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently, the languages <code>xml</code> and <code>groovy</code> are supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="camel-routes-manage"><a class="anchor" href="#camel-routes-manage"></a><a class="link" href="#camel-routes-manage">7.2.3. Start/stop Camel routes</a></h4>
<div class="paragraph">
<p>We are able to explicitly start and stop routes in the current context.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^start Camel route {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then start Camel route {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The given name references a route in the current Camel context. This starts the route and
consumes messages from the enpoint URI.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^stop Camel route {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then stop Camel route {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After stopping a route the route will not consume any messages on the given endpoint URI.</p>
</div>
<div class="paragraph">
<p>In case a Camel route is not needed anymore you can also remove it from the current Camel context.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^remove Camel route {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then remove Camel route {name}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="camel-send"><a class="anchor" href="#camel-send"></a><a class="link" href="#camel-send">7.2.4. Send messages via Camel</a></h4>
<div class="paragraph">
<p>We can send exchanges using any Camel endpoint URI. The endpoint URI can point to an external
component or to a route in the current Camel context and trigger its processing logic. The exchange body
is given as single or multiline body content.</p>
</div>
<div class="listingblock">
<div class="title">@When("^send Camel exchange to\\(\"{endpoint_uri}\"\\) with body: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send Camel exchange to("direct:hello") with body: Hello Camel!</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step sends an exchange with the body <code>Hello Camel!</code>. You can also use
multiline body content with the following step:</p>
</div>
<div class="listingblock">
<div class="title">@When("^send Camel exchange to\\(\"{endpoint_uri}\"\\) with body$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send Camel exchange to("direct:hello") with body
"""
Hello Camel!

This is a multiline content!
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to a body content the Camel exchange also defines a set of message headers. You can use a data table to specify message headers
when sending a message.</p>
</div>
<div class="listingblock">
<div class="title">@When("^send Camel exchange to\\(\"{endpoint_uri}\"\\) with body and headers: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send Camel exchange to("direct:hello") with body and headers Hello Camel!
    | id        | 1234     |
    | operation | sayHello |</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="camel-receive"><a class="anchor" href="#camel-receive"></a><a class="link" href="#camel-receive">7.2.5. Receive messages via Camel</a></h4>
<div class="paragraph">
<p>The YAKS test is able to receive messages from a Camel endpoint URI in order to verify
the message content (header and body) with an expected control message.</p>
</div>
<div class="paragraph">
<p>Once the message
is received YAKS makes use of the powerful message validation capabilities of Citrus to make sure
that the content is as expected.</p>
</div>
<div class="listingblock">
<div class="title">@When("^receive Camel exchange from\\(\"{endpoint_uri}\"\\) with body: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When receive Camel exchange from("seda:tokens") with body: Hello</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step receives an exchange from the endpoint URI <code>seda:tokens</code> and
verifies the body to be equal to <code>Hello</code>. See the next example on how
to validate a multiline message body content.</p>
</div>
<div class="listingblock">
<div class="title">@When("^receive Camel exchange from\\(\"{endpoint_uri}\"\\) with body$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When receive Camel exchange from("seda:tokens") with body
"""
{
  "message": "Hello Camel!"
}
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also verify a set of message headers that must be present on the received exchange.
Once again we use a data table to define the message headers. This time we provide expected message
header values.</p>
</div>
<div class="listingblock">
<div class="title">@When("^receive Camel exchange from\\(\"{endpoint_uri}\"\\) with body and headers: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When receive Camel exchange from("seda:tokens") with body and headers: Hello
    | id        | 1234     |
    | operation | sayHello |</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="camel-exchange"><a class="anchor" href="#camel-exchange"></a><a class="link" href="#camel-exchange">7.2.6. Define Camel exchanges</a></h4>
<div class="paragraph">
<p>In the previous steps we have seen how to send and receive messages to anf from
Camel endpoint URIs. We have used the exchange body and header in a single step so far.</p>
</div>
<div class="paragraph">
<p>In some cases it might be a better option to use multiple steps for defining the complete exchange
data upfront. The actual send/receive operation then takes place in a separate step.</p>
</div>
<div class="paragraph">
<p>The following examples should clarify the usage.</p>
</div>
<div class="paragraph">
<p>@Given("^Camel exchange message header {name}=\"{value}\"$")</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Camel exchange message header {name}="{value}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets a message header on the exchange. We can also use a data table to set multiple headers
in one single step:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Camel exchange message headers$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Camel exchange message headers
    | id        | 1234     |
    | operation | sayHello |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we can also set the body in another step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Camel exchange body$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Camel exchange body: Hello Camel!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiline body content is also supported.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Camel exchange body$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Camel exchange body
"""
{
  "message": "Hello Camel!"
}
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the body is getting too big it may be a better idea to load the content from an external file resource:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load Camel exchange body {file}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load Camel exchange body {file}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step loads the body content from the given file resource.</p>
</div>
<div class="paragraph">
<p>Now that we have specified the exchange headers and body content we can send or receive that specific
echange in a separate step.</p>
</div>
<div class="listingblock">
<div class="title">@When("^send Camel exchange to\\(\"{endpoint_uri}\"\\)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">send Camel exchange to("{endpoint_uri}")</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">@When("^receive Camel exchange from\\(\"{endpoint_uri}\"\\)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">receive Camel exchange from("{endpoint_uri}")</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous section we have covered a 2nd approach to send and receive messages
with Apache Camel. You specify the exchange in multiple steps first and then send/receive
the exchange to/from and endpoint URI in a separate step.</p>
</div>
</div>
<div class="sect3">
<h4 id="camel-settings"><a class="anchor" href="#camel-settings"></a><a class="link" href="#camel-settings">7.2.7. Basic Camel settings</a></h4>
<div class="listingblock">
<div class="title">@Given("^Camel consumer timeout is {time}(?: ms| milliseconds)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Camel consumer timeout is {time} milliseconds</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sets the default timeout for all Camel components that consume data from messaging transports. After that time the test
will fail with a timeout exception when no message has been received.</p>
</div>
</div>
<div class="sect3">
<h4 id="camel-resources"><a class="anchor" href="#camel-resources"></a><a class="link" href="#camel-resources">7.2.8. Manage Camel resources</a></h4>
<div class="paragraph">
<p>The Apache Camel steps are able to create resources such as routes. By default these resources get removed automatically after the test scenario.</p>
</div>
<div class="paragraph">
<p>The auto removal of Camel resources can be turned off with the following step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Disable auto removal of Camel resources$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Disable auto removal of Camel resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually this step is a <code>Background</code> step for all scenarios in a feature file. This way multiple scenarios can work on the very same Camel resources and share
integrations.</p>
</div>
<div class="paragraph">
<p>There is also a separate step to explicitly enable the auto removal.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Enable auto removal of Camel resources$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Enable auto removal of Camel resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, all Camel resources are automatically removed after each scenario.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-camel-k"><a class="anchor" href="#steps-camel-k"></a><a class="link" href="#steps-camel-k">7.3. Apache Camel K steps</a></h3>
<div class="paragraph">
<p>Apache Camel K is a lightweight integration framework built from Apache Camel that runs natively on Kubernetes and is specifically designed for serverless and microservice architectures.</p>
</div>
<div class="paragraph">
<p>Users of Camel K can instantly run integration code written in Camel DSL on their preferred cloud (Kubernetes or OpenShift).</p>
</div>
<div class="paragraph">
<p>If the subject under test is a Camel K integration, you can leverage the YAKS Camel K bindings
that provide useful steps for managing Camel K integrations.</p>
</div>
<div class="listingblock">
<div class="title">Working with Camel K integrations</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Camel K integration helloworld.groovy
"""
from('timer:tick?period=1000')
  .setBody().constant('Hello world from Camel K!')
  .to('log:info')
"""
Given Camel K integration helloworld is running
Then Camel K integration helloworld should print Hello world from Camel K!</code></pre>
</div>
</div>
<div class="paragraph">
<p>The YAKS framework provides the Camel K extension library by default. You can create a new Camel K integration and check the status of
the integration (e.g. running).</p>
</div>
<div class="paragraph">
<p>The following sections describe the available Camel K steps in detail.</p>
</div>
<div class="sect3">
<h4 id="camel-k-api-version"><a class="anchor" href="#camel-k-api-version"></a><a class="link" href="#camel-k-api-version">7.3.1. API version</a></h4>
<div class="paragraph">
<p>The default Camel K API version used to create and manage resources is <code>v1</code>. You can overwrite this
version with a environment variable set on the YAKS configuration.</p>
</div>
<div class="listingblock">
<div class="title">Overwrite Camel K API version</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">YAKS_CAMELK_API_VERSION=v1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the Camel K API version for all operations.</p>
</div>
</div>
<div class="sect3">
<h4 id="camel-k-create"><a class="anchor" href="#camel-k-create"></a><a class="link" href="#camel-k-create">7.3.2. Create Camel K integrations</a></h4>
<div class="listingblock">
<div class="title">@Given("^(?:create|new) Camel K integration {name}.{type}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Camel K integration {name}.groovy
"""
&lt;&lt;Camel DSL&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>Creates a new Camel K integration with specified route DSL. The integration is automatically started and can be referenced with its
<code>{name}</code> in other steps.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:create|new) Camel K integration {name}.{type} with configuration:$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Camel K integration {name}.groovy with configuration:
  | dependencies | mvn:org.foo:foo:1.0,mvn:org.bar:bar:0.9 |
  | traits       | quarkus.native=true,quarkus.enabled=true,route.enabled=true |
  | properties   | foo.key=value,bar.key=value |
  | source       | &lt;&lt;Camel DSL&gt;&gt; |</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add optional configurations to the Camel K integration such as dependencies, traits and properties.</p>
</div>
<div class="paragraph">
<div class="title">Source</div>
<p>The route DSL as source for the Camel K integration.</p>
</div>
<div class="paragraph">
<div class="title">Dependencies</div>
<p>List of Maven coordinates that will be added to the integration runtime as a library.</p>
</div>
<div class="paragraph">
<div class="title">Traits</div>
<p>List of trait configuration that will be added to the integration spec. Each trait configuration value must be in the format <code>traitname.key=value</code>.</p>
</div>
<div class="paragraph">
<div class="title">Properties</div>
<p>List of property bindings added to the integration. Each value must be in the format <code>key=value</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="camel-k-load"><a class="anchor" href="#camel-k-load"></a><a class="link" href="#camel-k-load">7.3.3. Load Camel K integrations</a></h4>
<div class="listingblock">
<div class="title">@Given("^load Camel K integration {name}.{type}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load Camel K integration {name}.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Loads the file <code>{name}.groovy</code> as a Camel K integration.</p>
</div>
</div>
<div class="sect3">
<h4 id="camel-k-delete"><a class="anchor" href="#camel-k-delete"></a><a class="link" href="#camel-k-delete">7.3.4. Delete Camel K integrations</a></h4>
<div class="listingblock">
<div class="title">@Given("^delete Camel K integration {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given delete Camel K integration {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deletes the Camel K integration with given <code>{name}</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="camel-k-integration-state"><a class="anchor" href="#camel-k-integration-state"></a><a class="link" href="#camel-k-integration-state">7.3.5. Verify integration state</a></h4>
<div class="paragraph">
<p>A Camel K integration is run in a normal Kubernetes pod. The pod has a state and is in a phase (e.g. running, stopped).
You can verify the state with an expectation.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Camel K integration {name} is running/stopped$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Camel K integration {name} is running</code></pre>
</div>
</div>
<div class="paragraph">
<p>Checks that the Camel K integration with given <code>{name}</code> is in state running and that the number of replicas is &gt; 0. The step polls
the state of the integration for a given amount of attempts with a given delay between attempts. You can adjust the polling settings with:</p>
</div>
<div class="listingblock">
<div class="title">@Given Camel K resource polling configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Camel K resource polling configuration
    | maxAttempts          | 10   |
    | delayBetweenAttempts | 1000 |</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="camel-k-watch-logs"><a class="anchor" href="#camel-k-watch-logs"></a><a class="link" href="#camel-k-watch-logs">7.3.6. Watch Camel K integration logs</a></h4>
<div class="listingblock">
<div class="title">@Given("^Camel K integration {name} should print (.*)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Camel K integration {name} should print {log-message}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Watches the log output of a Camel K integration and waits for given <code>{log-message}</code> to be present in the logs. The step polls the
logs for a given amount of time. You can adjust the polling configuration with:</p>
</div>
<div class="listingblock">
<div class="title">@Given Camel K resource polling configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Camel K resource polling configuration
    | maxAttempts          | 10   |
    | delayBetweenAttempts | 1000 |</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also wait for a log message to <strong>not</strong> be present in the output. Just use this step:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Camel K integration {name} should not print (.*)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Camel K integration {name} should not print {log-message}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="camel-k-resources"><a class="anchor" href="#camel-k-resources"></a><a class="link" href="#camel-k-resources">7.3.7. Manage Camel K resources</a></h4>
<div class="paragraph">
<p>The Camel K steps are able to create resources such as integrations. By default these resources get removed automatically after the test scenario.</p>
</div>
<div class="paragraph">
<p>The auto removal of Camel K resources can be turned off with the following step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Disable auto removal of Camel K resources$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Disable auto removal of Camel K resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually this step is a <code>Background</code> step for all scenarios in a feature file. This way multiple scenarios can work on the very same Camel K resources and share
integrations.</p>
</div>
<div class="paragraph">
<p>There is also a separate step to explicitly enable the auto removal.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Enable auto removal of Camel K resources$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Enable auto removal of Camel K resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, all Camel K resources are automatically removed after each scenario.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-kamelet"><a class="anchor" href="#steps-kamelet"></a><a class="link" href="#steps-kamelet">7.4. Kamelet steps</a></h3>
<div class="paragraph">
<p>Kamelets are a form of predefined Camel route templates implemented in Camel K. Usually
a Kamelet encapsulates a certain functionality (e.g. send messages to an endpoint). Additionaly
Kamelets define a set of properties that the user needs to provide when using the Kamelet.</p>
</div>
<div class="paragraph">
<p>YAKS provides steps to manage Kamelets.</p>
</div>
<div class="sect3">
<h4 id="kamelet-api-version"><a class="anchor" href="#kamelet-api-version"></a><a class="link" href="#kamelet-api-version">7.4.1. API version</a></h4>
<div class="paragraph">
<p>The default Kamelet API version used to create and manage resources is <code>v1alpha1</code>. You can overwrite this
version with a environment variable set on the YAKS configuration.</p>
</div>
<div class="listingblock">
<div class="title">Overwrite Kamelet API version</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">YAKS_KAMELET_API_VERSION=v1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the Kamelet API version for all operations.</p>
</div>
</div>
<div class="sect3">
<h4 id="kamelet-create"><a class="anchor" href="#kamelet-create"></a><a class="link" href="#kamelet-create">7.4.2. Create Kamelets</a></h4>
<div class="paragraph">
<p>A Kamelets defines a set of properties and specifications that you can set with separate steps in your
feature. Each of the following steps set a specific property on the Kamelet. Once you are done with the Kamelet
specification you are able to create the Kamelet in the current namespace.</p>
</div>
<div class="paragraph">
<p>First of all you can specify the media type of the available slots (in, out and error) in the Kamelet.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Kamelet dataType (in|out|error)(?:=| is )\"{mediaType}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kamelet dataType in="{mediaType}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Kamelet can use a title that you set with the following step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Kamelet title \"{title}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kamelet title "{title}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each template uses an endpoint uri and defines a set of steps that get called when the Kamelet processing takes place.
The following step defines a template on the current Kamelet.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Kamelet template$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kamelet template
"""
from:
  uri: timer:tick
  parameters:
    period: "#property:period"
  steps:
  - set-body:
      constant: "{{message}}"
  - to: "kamelet:sink"
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>The template uses two properties <code>{{message}}</code> and <code>{{period}}</code>. These placeholders need to be provided by the Kamelet user.
The next step defines the property <code>message</code> in detail:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Kamelet property definition {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kamelet property definition message
  | type     | string        |
  | required | true          |
  | example  | "hello world" |
  | default  | "hello"       |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The property receives specification such as type, required and an example. In addition to the example you can
set a <code>default</code> value for the property.</p>
</div>
<div class="paragraph">
<p>In addition to using a template on the Kamelet you can add multiple sources to the Kamelet.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Kamelet source {name}.{language}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kamelet source timer.yaml
"""
&lt;&lt;YAML&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous steps defined all properties and Kamelet specifications so now you are ready
to create the Kamelet in the current namespace.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:create|new) Kamelet {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Kamelet {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Kamelet requires a unique <code>name</code>. Creating a Kamelet means that a new custom resource of type Kamelet is created. As a variation
you can also set the template when creating the Kamelet.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:create|new) Kamelet {name} with template")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Kamelet {name} with template
"""
&lt;&lt;YAML&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates the Kamelet in the current namespace.</p>
</div>
</div>
<div class="sect3">
<h4 id="kamelet-load"><a class="anchor" href="#kamelet-load"></a><a class="link" href="#kamelet-load">7.4.3. Load Kamelets</a></h4>
<div class="paragraph">
<p>You can create new Kamelets by giving the complete specification in an external YAML file. The step loads the file content
and creates the Kamelet in the current namespace.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load Kamelet {name}.kamelet.yaml$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load Kamelet {name}.kamelet.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Loads the file <code>{name}.kamelet.yaml</code> as a Kamelet. At the moment only <code>kamelet.yaml</code> source file extension is supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="kamelet-delete"><a class="anchor" href="#kamelet-delete"></a><a class="link" href="#kamelet-delete">7.4.4. Delete Kamelets</a></h4>
<div class="listingblock">
<div class="title">@Given("^delete Kamelet {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given delete Kamelet {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deletes the Kamelet with given <code>{name}</code> from the current namespace.</p>
</div>
</div>
<div class="sect3">
<h4 id="kamelets-state"><a class="anchor" href="#kamelets-state"></a><a class="link" href="#kamelets-state">7.4.5. Verify Kamelet is available</a></h4>
<div class="listingblock">
<div class="title">@Given("^Kamelet {name} is available$$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kamelet {name} is available$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verifies that the Kamelet custom resource is available in the current namespace.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-pipe"><a class="anchor" href="#steps-pipe"></a><a class="link" href="#steps-pipe">7.5. Pipe steps</a></h3>
<div class="paragraph">
<p>You can bind a Kamelet as a source to a sink. This concept is described with Pipes. YAKS as a framework
is able to create and verify Pipes in combination with Kamelets.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Pipes are available since API version <code>v1</code> in Camel K. YAKS also supports KameletBinding resources that represent
the <code>v1alpha1</code> equivalent to Pipes. So in case you need to work with KameletBindings you need to explicitly set the Kamelet API version to <code>v1alpha1</code> (e.g. via environment variable settings <code>YAKS_KAMELET_API_VERSION</code>).
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="pipe-create"><a class="anchor" href="#pipe-create"></a><a class="link" href="#pipe-create">7.5.1. Create Pipes</a></h4>
<div class="paragraph">
<p>YAKS provides multiple steps that bind a Kamelet source to a sink. The pipe is going to forward all messages
processed by the source to the sink.</p>
</div>
<div class="sect4">
<h5 id="bind-to-http-uri"><a class="anchor" href="#bind-to-http-uri"></a><a class="link" href="#bind-to-http-uri">7.5.1.1. Bind to Http URI</a></h5>
<div class="listingblock">
<div class="title">@Given("^bind Kamelet {kamelet} to uri {uri}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given bind Kamelet {name} to uri {uri}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This defines the Pipe with the given Kamelet name as source to the given
Http URI as a sink.</p>
</div>
</div>
<div class="sect4">
<h5 id="bind-to-kafka-topic"><a class="anchor" href="#bind-to-kafka-topic"></a><a class="link" href="#bind-to-kafka-topic">7.5.1.2. Bind to Kafka topic</a></h5>
<div class="paragraph">
<p>You can bind a Kamelet source to a Kafka topic sink. All messages will be forwarded to the topic.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^bind Kamelet {kamelet} to Kafka topic {topic}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given bind Kamelet {kamelet} to Kafka topic {topic}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bind-to-knative-channel"><a class="anchor" href="#bind-to-knative-channel"></a><a class="link" href="#bind-to-knative-channel">7.5.1.3. Bind to Knative channel</a></h5>
<div class="paragraph">
<p>Channels are part of the eventing in Knative. Similar to topics in Kafka the
channels hold messages for subscribers.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^bind Kamelet {kamelet} to Knative channel {channel}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given bind Kamelet {kamelet} to Knative channel {channel}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Channels can be backed with different implementations. You can explicitly set the channel type to use
in the pipe.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^bind Kamelet {kamelet} to Knative channel {channel} of kind {kind}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given bind Kamelet {kamelet} to Knative channel {channel} of kind {kind}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="specify-sourcesink-properties"><a class="anchor" href="#specify-sourcesink-properties"></a><a class="link" href="#specify-sourcesink-properties">7.5.1.4. Specify source/sink properties</a></h5>
<div class="paragraph">
<p>The Pipe may need to specify properties for source and sink. These properties
are defined in the Kamelet source specifications for instance.</p>
</div>
<div class="paragraph">
<p>You can set properties with values in the following step:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Pipe source properties$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Pipe source properties
  | {property}  | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Kamelet source that we have used in the examples above has defined a property
<code>message</code>. So you can set the property on the pipe as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Pipe source properties
  | message  | "Hello world" |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same approach applies to sink properties.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Pipe sink properties$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Pipe sink properties
  | {property}  | {value} |</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="create-the-pipe"><a class="anchor" href="#create-the-pipe"></a><a class="link" href="#create-the-pipe">7.5.1.5. Create the pipe</a></h5>
<div class="paragraph">
<p>The previous steps have defined source and sink of the Pipe specification. Now you are ready
to create the Pipe in the current namespace.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:create|new) Pipe {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Pipe {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Pipe receives a unique <code>name</code> and uses the previously specified source and sink. Creating a Pipe means
that a new custom resource of type Pipe is created in the current namespace.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pipe-load"><a class="anchor" href="#pipe-load"></a><a class="link" href="#pipe-load">7.5.2. Load Pipes</a></h4>
<div class="paragraph">
<p>You can create new Pipes by giving the complete specification in an external YAML file. The step loads the file content
and creates the Pipe in the current namespace.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load Pipe {name}.yaml$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load Pipe {name}.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Loads the file <code>{name}.yaml</code> as a Pipe. At the moment YAKS only supports <code>.yaml</code> source files.</p>
</div>
</div>
<div class="sect3">
<h4 id="pipe-delete"><a class="anchor" href="#pipe-delete"></a><a class="link" href="#pipe-delete">7.5.3. Delete Pipes</a></h4>
<div class="listingblock">
<div class="title">@Given("^delete Pipe {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given delete Pipe {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deletes the Pipe with given <code>{name}</code> from the current namespace.</p>
</div>
</div>
<div class="sect3">
<h4 id="pipes-state"><a class="anchor" href="#pipes-state"></a><a class="link" href="#pipes-state">7.5.4. Verify Pipe is available</a></h4>
<div class="listingblock">
<div class="title">@Given("^Pipe {name} is available$$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Pipe {name} is available$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verifies that the Pipe custom resource is available in the current namespace.</p>
</div>
</div>
<div class="sect3">
<h4 id="kamelets-resources"><a class="anchor" href="#kamelets-resources"></a><a class="link" href="#kamelets-resources">7.5.5. Manage Kamelet and Pipe resources</a></h4>
<div class="paragraph">
<p>The described steps are able to create Kamelet resources on the current Kubernetes namespace.
By default these resources get removed automatically after the test scenario.</p>
</div>
<div class="paragraph">
<p>The auto removal of Kamelet resources can be turned off with the following step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Disable auto removal of Kamelet resources$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Disable auto removal of Kamelet resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually this step is a <code>Background</code> step for all scenarios in a feature file. This way multiple scenarios can work on
the very same Kamelet resources and share integrations.</p>
</div>
<div class="paragraph">
<p>There is also a separate step to explicitly enable the auto removal.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Enable auto removal of Kamelet resources$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Enable auto removal of Kamelet resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, all Kamelet resources are automatically removed after each scenario.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-groovy"><a class="anchor" href="#steps-groovy"></a><a class="link" href="#steps-groovy">7.6. Groovy steps</a></h3>
<div class="paragraph">
<p>The Groovy support in YAKS adds ways to configure the framework with bean configurations and test actions via
Groovy script snippets. In particular, you can add customized endpoints that send/receive data over various
messaging transports.</p>
</div>
<div class="paragraph">
<p>The Groovy script support is there to cover specific use cases where you hit limitations with the predefined
conventional BDD steps. Of course the syntax and handling of the Groovy scripts are less human readable and more
developer coherent.</p>
</div>
<div class="sect3">
<h4 id="groovy-configuration-script"><a class="anchor" href="#groovy-configuration-script"></a><a class="link" href="#groovy-configuration-script">7.6.1. Framework configuration</a></h4>
<div class="paragraph">
<p>YAKS uses Citrus components behind the scenes. The Citrus components are configurable through a Groovy domain specific language.
You can add endpoints and other components as Citrus framework configuration like follows:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:create|new) configuration$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create configuration
"""
&lt;&lt;Groovy DSL&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the next example the step uses a Groovy domain specific language to define a new Http server endpoint.</p>
</div>
<div class="listingblock">
<div class="title">Http server endpoint configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Scenario: Endpoint script config
  Given URL: http://localhost:18080
  Given create configuration
  """
  citrus {
      endpoints {
          http {
              server('helloServer') {
                  port = 18080
                  autoStart = true
              }
          }
      }
  }
  """
  When send GET /hello
  Then receive HTTP 200 OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration step creates a new Citrus endpoint named <code>helloServer</code> with given properties (<code>port</code>, <code>autoStart</code>) in form of a Groovy configuration script.
The endpoint is a Http server Citrus component that is automatically started listening on the given port. In the following the scenario can send messages to that server endpoint.</p>
</div>
<div class="paragraph">
<p>The Groovy configuration script adds Citrus components to the test context and supports following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>endpoints</code>: Configure Citrus endpoint components that can be used to exchange data over various messaging transports</p>
</li>
<li>
<p><code>queues</code>: In memory queues to handle message forwarding for incoming messages</p>
</li>
<li>
<p><code>beans</code>: Custom beans configuration (e.g. data source, SSL context, request factory) that can be used in Citrus endpoint components</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s quickly have a look at a bean configuration where a new JDBC data source is added to the test suite.</p>
</div>
<div class="listingblock">
<div class="title">JDBC data source configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Scenario: Bean configuration
  Given create configuration
  """
  citrus {
      beans {
          dataSource(org.apache.commons.dbcp2.BasicDataSource) {
              driverClassName = "org.h2.Driver"
              url = "jdbc:h2:mem:camel"
              username = "sa"
              password = ""
          }
      }
  }
  """</code></pre>
</div>
</div>
<div class="paragraph">
<p>The data source will be added as a bean named <code>dataSource</code> and can be referenced in all Citrus SQL test actions.</p>
</div>
<div class="paragraph">
<p>All Groovy configuration scripts that we have seen so far can also be loaded from external file resources, too.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load configuration {file_path}\\.groovy$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load configuration {file_path}.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file content is loaded as a Groovy configuration DSL. The next code sample shows such a configuration script.</p>
</div>
<div class="listingblock">
<div class="title">citrus.configuration.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code>citrus {
    queues {
        queue('say-hello')
    }

    endpoints {
        direct {
            asynchronous {
                name = 'hello'
                queue = 'say-hello'
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="groovy-endpoint-script"><a class="anchor" href="#groovy-endpoint-script"></a><a class="link" href="#groovy-endpoint-script">7.6.2. Endpoint configuration</a></h4>
<div class="paragraph">
<p>Endpoints describe an essential part in terms of messaging integration during a test. There are multiple ways to add custom endpoints
to a test. Endpoint Groovy scripts is one comfortable way to add custom endpoint configurations
in a test scenario. You can do so with the following step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:create|new) endpoint {name}\\.groovy$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given("^(?:create|new) endpoint {name}.groovy
"""
&lt;&lt;Groovy DSL&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step receives a unique name for the endpoint and a Groovy DSL that sepcifies the endpoint component with all its properties.
In the following sample a new Http server endpoint component will be created.</p>
</div>
<div class="listingblock">
<div class="title">Create new Http server endpoint</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Scenario: Create Http endpoint
  Given URL: http://localhost:18081
  Given create endpoint helloServer.groovy
  """
  http()
    .server()
    .port(18081)
    .autoStart(true)
  """
  When send GET /hello
  Then receive HTTP 200 OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>The scenario creates a new Http server endpoint named <code>helloServer</code>. This server component can be used directly in the
scenario to receive and verify messages sent to that endpoint.</p>
</div>
<div class="paragraph">
<p>You can also load the endpoint configuration from an external file resources.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load endpoint {file_path}\\.groovy$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given("^load endpoint {file_path}.groovy$")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The referenced file should contain the endpoint Groovy DSL.</p>
</div>
<div class="listingblock">
<div class="title">Create endpoint from file resource</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Scenario: Load endpoint
  Given URL: http://localhost:18088
  Given load endpoint fooServer.groovy
  When send GET /hello
  Then receive HTTP 200 OK</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fooServer.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code>http()
    .server()
    .port(18088)
    .autoStart(true)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="groovy-action-script"><a class="anchor" href="#groovy-action-script"></a><a class="link" href="#groovy-action-script">7.6.3. Test actions</a></h4>
<div class="paragraph">
<p>YAKS provides a huge set of predefined test actions that users can add to the Gherkin feature files out of the box.
However, there might be situations where you want to run a customized test action code as a step in your feature scenario.</p>
</div>
<div class="paragraph">
<p>With the Groovy script support in YAKS you can add such customized test actions via script snippets:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:create|new) actions {name}\\.groovy$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create actions {name}.groovy$")
"""
&lt;&lt;Groovy DSL&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Groovy test action DSL script receives a unique <code>{name}</code>. You can reference this name later in the test in order to
apply the defined actions. When applied to the test the defined actions are executed. A sample will show how it is done.</p>
</div>
<div class="listingblock">
<div class="title">Create test actions with a script</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Scenario: Custom test actions
  Given create actions basic.groovy
  """
  $actions {
    $(echo('Hello from Groovy script'))
    $(delay().seconds(1))

    $(createVariables()
        .variable('foo', 'bar'))

    $(echo('Variable foo=${foo}'))
  }
  """
  Then apply basic.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above defines the test actions with the Groovy DSL under the name <code>basic.groovy</code>. Later in the test the actions are executed with the
<code>apply</code> step.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^(?:apply|verify) actions {name}\\.groovy$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then apply actions {name}.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Users familiar with Citrus will notice immediately that the action script is using the Citrus actions DSL to describe
what should be done when running the Groovy script as part of the test.</p>
</div>
<div class="paragraph">
<p>The Citrus action DSL is quite powerful and allows you to perform complex actions such as iterations, conditionals and
send/receive operations as shown in the next sample.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Scenario: Messaging actions
  Given create actions messaging.groovy
  """
  $actions {
    $(send('direct:myQueue')
      .payload('Hello from Groovy script!'))

    $(receive('direct:myQueue')
      .payload('Hello from Groovy script!'))
  }
  """
  Then apply actions messaging.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative to write the Groovy DSL directly into the test feature file you can also laod the test action script
from external file resources.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load actions {file_name}\\.groovy$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load actions {file_name}.groovy$")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file name is the name of the action script. So you can use the file name to apply the script in the test for execution.</p>
</div>
<div class="listingblock">
<div class="title">Apply Groovy script</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then apply actions {file_name}.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use a shortcut syntax to directly call a test action.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^${{action_code})$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then $(echo('Hello from Groovy script!'))</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will add a new <code>echo</code> test action and run the action. The action code uses a Groovy script that defines the test action
by using the common Citrus test action domain specific language.</p>
</div>
<div class="paragraph">
<p>You can apply multiline scripts directly, too.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^apply script$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given apply script
    """
    $actions {
        $(delay().seconds(1))

        $(echo('Hello from Groovy script!'))
    }
    """</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="groovy-finally-actions"><a class="anchor" href="#groovy-finally-actions"></a><a class="link" href="#groovy-finally-actions">7.6.4. Finally actions</a></h4>
<div class="paragraph">
<p>Sometimes it is mandatory to cleanup test data after a scenario. It would be good to have a set of test actions that
get executed in a guaranteed way - even in case the test scenario failed with errors before.</p>
</div>
<div class="paragraph">
<p>The Citrus framework provides a concept of <code>finally block</code> actions. These actions will be run after the test in all
circumstances (success and failure).</p>
</div>
<div class="listingblock">
<div class="title">Finally block actions</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given apply script
    """
    $finally {
        echo('${greeting} in finally!')
    }
    """</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative syntax you can add a 'doFinally()' test action to your script.</p>
</div>
<div class="listingblock">
<div class="title">Finally test action</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given apply script
    """
    $actions {
        $(doFinally().actions(
            echo('${greeting} in finally!')
        ))
    }
    """</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is how you can define test actions in Groovy that get executed after the test.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-http"><a class="anchor" href="#steps-http"></a><a class="link" href="#steps-http">7.7. Http steps</a></h3>
<div class="paragraph">
<p>The Http protocol is a widely used communication protocol when it comes to exchanging data between systems. REST Http services
are very prominent and producing/consuming those services is a common task in software development these days. YAKS provides
ready to use steps that are able to exchange request/response messages via Http as a client and server during the test.</p>
</div>
<div class="paragraph">
<p>The sample below shows how to use Http communication in a test:</p>
</div>
<div class="listingblock">
<div class="title">Http communication sample</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Feature: Http client

  Background:
    Given URL: https://hello-service

  Scenario: Health check
    Given path /health is healthy

  Scenario: GET request
    When send GET /todo
    Then verify HTTP response body: {"id": "@ignore@", "task": "Sample task", "completed": 0}
    And receive HTTP 200 OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above sets a base request URL to <code><a href="https://hello-service" class="bare">https://hello-service</a></code> and performs a health check on path <code>/health</code>. After that we can
send a Http <code>GET</code> request to the endpoint and verify the response status code.</p>
</div>
<div class="paragraph">
<p>All steps shown are part of the YAKS framework so you can use them out of the box. The next sections explore the Http
capabilities in more detail.</p>
</div>
<div class="sect3">
<h4 id="http-client"><a class="anchor" href="#http-client"></a><a class="link" href="#http-client">7.7.1. Http client steps</a></h4>
<div class="paragraph">
<p>As a client you can specify the server URL and send requests to it.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:URL|url): {url}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given URL: {url}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The given URL points to a server endpoint. All further client Http steps send the requests to that endpoint.</p>
</div>
<div class="paragraph">
<p>As an alternative you can reference a Http client component that previously has been added to the framework configuration.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP client \"{name}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP client "{name}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step loads a Http client component by its name and uses that for further requests.</p>
</div>
<div class="paragraph">
<p>Once you have configured the Http endpoint URL or the Http client you can start sending request messages.</p>
</div>
</div>
<div class="sect3">
<h4 id="http-client-request"><a class="anchor" href="#http-client-request"></a><a class="link" href="#http-client-request">7.7.2. Send Http requests</a></h4>
<div class="paragraph">
<p>Sending requests via Http is as easy as choosing the Http method (GET, POST, PUT, DELETE, &#8230;&#8203;) to use.</p>
</div>
<div class="listingblock">
<div class="title">@When("^send (GET|HEAD|POST|PUT|PATCH|DELETE|OPTIONS|TRACE) {path}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send {method} {path}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The given path resides to a valid resource on the server endpoint. The resource path is added to the base URL and identifies the resource
on the server.</p>
</div>
<div class="listingblock">
<div class="title">Send Http GET request</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send GET /todo</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can choose the Http method that should be used to send the request (e.g. <code>GET</code>). Of course the request can have headers and a message body.
You need to set these before sending the request in separate steps.</p>
</div>
<div class="sect4">
<h5 id="request-headers"><a class="anchor" href="#request-headers"></a><a class="link" href="#request-headers">7.7.2.1. Request headers</a></h5>
<div class="listingblock">
<div class="title">@Given("^HTTP request header {name}=\"{value}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP request header {name}="{value}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step above adds a Http header to the request. The header is defined with a name and receives a value. You can set
multiple headers in a single step, too:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP request headers$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP request headers
  | {name} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step uses a data table to define multiple message headers with name and value.</p>
</div>
<div class="listingblock">
<div class="title">Set request headers</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP request headers
  | Accept          | application/json |
  | Accept-Encoding | gzip |</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="request-body"><a class="anchor" href="#request-body"></a><a class="link" href="#request-body">7.7.2.2. Request body</a></h5>
<div class="paragraph">
<p>The Http request can have a body content which is sent as part of the request.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP request body: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP request body: {body}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step above specifies the Http request body in a single line. When you need to use multiline body content please use the next step:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP request body$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP request body
"""
&lt;&lt;content&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the request body is getting too big it may be a better idea to load the content from an external file resource:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load HTTP request body {file}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load HTTP request body {file}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step loads the body content from the given file resource.</p>
</div>
</div>
<div class="sect4">
<h5 id="request-parameters"><a class="anchor" href="#request-parameters"></a><a class="link" href="#request-parameters">7.7.2.3. Request parameters</a></h5>
<div class="paragraph">
<p>The Http request is able to use parameters that get added to the request URL. You can set those parameters in a separate step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP request query parameter {name}=\"{value}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP request query parameter {name}="{value}"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="request-timeouts"><a class="anchor" href="#request-timeouts"></a><a class="link" href="#request-timeouts">7.7.2.4. Request timeouts</a></h5>
<div class="paragraph">
<p>In some cases the client waits a long time for the server to respond. As Http is a synchronous communication protocol by its nature
the client will synchronously wait for the response before doing any other step. You can specify the time to wait for the server to respond.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP request timeout is {time} milliseconds$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP request timeout is {time} milliseconds</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the client timeout to thee given time in milliseconds.</p>
</div>
</div>
<div class="sect4">
<h5 id="request-fork-mode"><a class="anchor" href="#request-fork-mode"></a><a class="link" href="#request-fork-mode">7.7.2.5. Request fork mode</a></h5>
<div class="paragraph">
<p>As seen in the previous section Http is synchronous by default. This can be a problem when the test needs to do multiple things in parallel. By default the Http
client step will always block any other step until the server response has been received. You can change this behavior to an asynchronous behavior so the
next steps will not be blocked by the Http client step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP request fork mode is (enabled|disabled)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP request fork mode is enabled</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will enable the fork mode so all client request will be non-blocking. By default the fork mode is disabled.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-client-request-raw"><a class="anchor" href="#http-client-request-raw"></a><a class="link" href="#http-client-request-raw">7.7.3. Send raw Http request data</a></h4>
<div class="paragraph">
<p>In the previous section several steps have defined the Http request (header, parameter, body) before sending the message
in a separate step. As an alternative to this approach you can also specify the complete Http request data in a single step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^send HTTP request$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given send HTTP request
"""
&lt;&lt;request_data&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example shows the complete Http request data step:</p>
</div>
<div class="listingblock">
<div class="title">Send raw Http request data</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given send HTTP request
"""
GET https://hello-service
Accept-Charset:utf-8
Accept:application/json, application/*+json, */*
Host:localhost:8080
Content-Type:text/plain;charset=UTF-8
"""</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-client-response"><a class="anchor" href="#http-client-response"></a><a class="link" href="#http-client-response">7.7.4. Verify Http responses</a></h4>
<div class="paragraph">
<p>The time you send out a Http request you will be provided with a response from the server. YAKS is able to verify the
Http response content in order to make sure that the server has processed the request as expected.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^receive HTTP {status_code}(?: {reason_phrase})?$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive HTTP {status_code} {reason_phrase}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most critical part of the Http response is thee status code (e.g. 200, 404, 500). The status code should refer to the success
or error of the request. The server can use a wide range of Http status codes that are categorized as follows,
also see <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec6.html">W3C</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>1xx</em> informational response  the request was received, continuing process</p>
</li>
<li>
<p><em>2xx</em> successful  the request was successfully received, understood, and accepted</p>
</li>
<li>
<p><em>3xx</em> redirection  further action needs to be taken in order to complete the request</p>
</li>
<li>
<p><em>4xx</em> client error  the request contains bad syntax or cannot be fulfilled</p>
</li>
<li>
<p><em>5xx</em> server error  the server failed to fulfil an apparently valid request</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Verify Http status code</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive HTTP 200 OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reason phrase <code>OK</code> is optional and is also not part of the verification mechanism for the response. It just gives human readers
a better understanding of the status code.</p>
</div>
<div class="paragraph">
<p>Of course the Http response can also have headers and a message body. YAKS is able to verify those response data, too. Please
define the expected headers and body content before verifying the status code.</p>
</div>
<div class="sect4">
<h5 id="response-headers"><a class="anchor" href="#response-headers"></a><a class="link" href="#response-headers">7.7.4.1. Response headers</a></h5>
<div class="listingblock">
<div class="title">@Then("^expect HTTP response header {name}=\"{value}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then expect HTTP response header {name}="{value}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step above adds a Http header to the response. The header is defined with a name and receives a value. You can set
multiple headers in a single step, too:</p>
</div>
<div class="listingblock">
<div class="title">@Then("^expect HTTP response headers$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then expect HTTP response headers
  | {name} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step uses a data table to define multiple message headers with name and value.</p>
</div>
<div class="listingblock">
<div class="title">Verify response headers</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then expect HTTP response headers
  | Encoding     | gzip |
  | Content-Type | application/json |</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="header-name-ignore-case"><a class="anchor" href="#header-name-ignore-case"></a><a class="link" href="#header-name-ignore-case">7.7.4.2. Header name ignore case</a></h5>
<div class="paragraph">
<p>Header names are not case-sensitive per Http specification. This means servers and clients may choose the header name case individually. In order to avoid verification errors when expecting headers in Http the header validation mechanism in Citrus is able to ignore the header name case.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP header name ignore case is (enabled|disabled)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP header name ignore case is enabled</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will enable the mode where header name verification is case-insensitive.</p>
</div>
<div class="paragraph">
<p>You may also use a environment setting <code>YAKS_HTTP_HEADER_NAME_IGNORE_CASE=true/false</code> in <code>yaks-config</code> to enable/disable the setting for the whole test suite. By default, the setting is disabled so header names are verified with case-sensitive mode.</p>
</div>
</div>
<div class="sect4">
<h5 id="response-body"><a class="anchor" href="#response-body"></a><a class="link" href="#response-body">7.7.4.3. Response body</a></h5>
<div class="listingblock">
<div class="title">@Then("^expect HTTP response body: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then expect HTTP response body: {body}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step above specifies the Http response body in a single line. When you need to use multiline body content please use the next step:</p>
</div>
<div class="listingblock">
<div class="title">@Then("^expect HTTP response body$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then expect HTTP response body
"""
&lt;&lt;content&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the response body is getting too big it may be a better idea to load the content from an external file resource:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^expect HTTP response body loaded from {file}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given expect HTTP response body loaded from {file}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step loads the body content from the given file resource.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-client-response-raw"><a class="anchor" href="#http-client-response-raw"></a><a class="link" href="#http-client-response-raw">7.7.5. Verify raw Http response data</a></h4>
<div class="paragraph">
<p>In the previous section several steps have defined the Http response (header, parameter, body) before verifying the message
received. As an alternative to this approach you can also specify the complete expected Http response data in a single step.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^receive HTTP response$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive HTTP response
"""
&lt;&lt;response_data&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example shows the complete Http response data step:</p>
</div>
<div class="listingblock">
<div class="title">Verify raw Http response data</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive HTTP response
"""
HTTP/1.1 200 OK
Content-Type:application/json
X-TodoId:@isNumber()@
Date: @ignore@

{"id": "@ignore@", "task": "Sample task", "completed": 0}
"""</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-response-jsonpath"><a class="anchor" href="#http-response-jsonpath"></a><a class="link" href="#http-response-jsonpath">7.7.6. Verify response using JsonPath</a></h4>
<div class="paragraph">
<p>When verifying Http client responses sent by the server you can use JsonPath expressions to validate
the response message body content.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^(?:expect|verify) HTTP response expression: {expression}=\"{value}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then expect HTTP response expression: {expression}="{value}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step defines a JsonPath expression (e.g. <code>$.person.age</code>) and an expected value. The expression is evaluated against
the received response message body and the value is compared to the expected value. This way you can explicitly verify elements
in the Json body.</p>
</div>
<div class="paragraph">
<p>The very same mechanism also applies to XML message body content. Just use a XPath expression instead of JsonPath.</p>
</div>
</div>
<div class="sect3">
<h4 id="http-server"><a class="anchor" href="#http-server"></a><a class="link" href="#http-server">7.7.7. Http server steps</a></h4>
<div class="paragraph">
<p>On the server side YAKS needs to start a Http server instance on a given port and listen for incoming requests.
The test is able to verify incoming requests and then provide a simulated response message with response headers and body content.</p>
</div>
<div class="listingblock">
<div class="title">Http communication sample</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Feature: Http server

  Background:
    Given HTTP server listening on port 8080
    And start HTTP server

  Scenario: Expect GET request
    When receive GET /todo
    Then HTTP response body:  {"id": 1000, "task": "Sample task", "completed": 0}
    And send HTTP 200 OK

  Scenario: Expect POST request
    Given expect HTTP request body: {"id": "@isNumber()@", "task": "New task", "completed": "@matches(0|1)@"}
    When receive POST /todo
    Then send HTTP 201 CREATED</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the HTTP server sample above we create a new server instance listening on port <code>8080</code>. Then we expect a <code>GET</code> request on path <code>/todo</code>. The server responds with
a Http <code>200 OK</code> response message and given Json body as payload.</p>
</div>
<div class="paragraph">
<p>The second scenario expects a POST request with a given body as Json payload. The expected request payload is verified with the powerful Citrus JSON
message validator being able to compare JSON tree structures in combination with validation matchers such as <code>isNumber()</code> or <code>matches(0|1)</code>.</p>
</div>
<div class="paragraph">
<p>After the request verification has passed the server responds with a simple Http <code>201 CREATED</code>.</p>
</div>
<div class="paragraph">
<p>The next sections guide you through the Http server capabilities in YAKS.</p>
</div>
</div>
<div class="sect3">
<h4 id="http-server-config"><a class="anchor" href="#http-server-config"></a><a class="link" href="#http-server-config">7.7.8. Http server configuration</a></h4>
<div class="paragraph">
<p>When the test run starts YAKS will initialize the Http server instance and listen on a port for incoming requests.</p>
</div>
<div class="sect4">
<h5 id="http-server-port"><a class="anchor" href="#http-server-port"></a><a class="link" href="#http-server-port">7.7.8.1. Http server port</a></h5>
<div class="paragraph">
<p>By default this server uses the port <code>8080</code>, but you can adjust the port with following step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP server listening on port {port}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP server listening on port {port}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="http-server-timeout"><a class="anchor" href="#http-server-timeout"></a><a class="link" href="#http-server-timeout">7.7.8.2. Http server timeout</a></h5>
<div class="paragraph">
<p>The test waits for incoming requests but the test may hit request timeouts when no request has been received. By default
the server waits for five seconds each time a request is expected. You can adjust the server timeout.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP server timeout is {time} milliseconds$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP server timeout is {time} milliseconds</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the server timeout to the given time in milliseconds.</p>
</div>
</div>
<div class="sect4">
<h5 id="http-server-component"><a class="anchor" href="#http-server-component"></a><a class="link" href="#http-server-component">7.7.8.3. Http server component</a></h5>
<div class="paragraph">
<p>You can use the default Http server instance that is automatically created
or reference server component in the project configuration (e.g. Spring bean, component configuration).</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP server \"{name}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP server "{name}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step loads a Http server component by its name and uses that for server side testing.</p>
</div>
</div>
<div class="sect4">
<h5 id="create-http-server"><a class="anchor" href="#create-http-server"></a><a class="link" href="#create-http-server">7.7.8.4. Create Http server</a></h5>
<div class="paragraph">
<p>When dealing with multiple server components at the same time or when a fresh server instance is required you
can create a new Http server with:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:create|new) HTTP server \"{name}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given new HTTP server "{name}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a fresh Http server instance. Please mind that a port can only be bound once so you may need to stop
other server instances or choose another server port.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:create|new) HTTP server \"{name}\" with configuration$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given new HTTP server "{name}" with configuration
| port    | 8081 |
| timeout | 1000 |</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-server-request"><a class="anchor" href="#http-server-request"></a><a class="link" href="#http-server-request">7.7.9. Receive Http requests</a></h4>
<div class="paragraph">
<p>You can define expected incoming Http requests as part of the test.</p>
</div>
<div class="listingblock">
<div class="title">@When("^receive (GET|HEAD|POST|PUT|PATCH|DELETE|OPTIONS|TRACE) {path}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When receive {method} {path}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The incoming request must match the given '{method}` and <code>{path}</code>.</p>
</div>
<div class="listingblock">
<div class="title">Receive Http GET request</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When receive GET /todo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, you can also verify headers and the request message body.
You need to specify the expected request before receiving the request with the <code>receive</code> steps.</p>
</div>
<div class="sect4">
<h5 id="request-headers-2"><a class="anchor" href="#request-headers-2"></a><a class="link" href="#request-headers-2">7.7.9.1. Request headers</a></h5>
<div class="listingblock">
<div class="title">@Given("^(?:expect|verify) HTTP request header {name}=\"{value}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given expect HTTP request header {name}="{value}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step above adds the Http header to the request validation. The header must be present in the incoming request and
must match the expected value. You can verify multiple headers in a single step, too:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:expect|verify) HTTP request headers$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given expect HTTP request headers
  | {name} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step uses a data table to define the message headers with name and value.</p>
</div>
<div class="listingblock">
<div class="title">Expect request headers</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given expect HTTP request headers
  | Accept          | application/json |
  | Accept-Encoding | gzip |</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="request-body-2"><a class="anchor" href="#request-body-2"></a><a class="link" href="#request-body-2">7.7.9.2. Request body</a></h5>
<div class="paragraph">
<p>Each incoming Http request can have a body and you are able to verify the body content in multiple ways.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:expect|verify) HTTP request body: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given expect HTTP request body: {body}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step above specifies the expected Http request body in a single line. Multiline body content must use the next step:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:expect|verify) HTTP request body$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given expect HTTP request body
"""
&lt;&lt;content&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the request body is getting too big it may be a better idea to load the content from an external file resource:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^expect HTTP request body loaded from {file}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given expect HTTP request body loaded from {file}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step loads the body content from the given file resource.</p>
</div>
</div>
<div class="sect4">
<h5 id="request-parameters-2"><a class="anchor" href="#request-parameters-2"></a><a class="link" href="#request-parameters-2">7.7.9.3. Request parameters</a></h5>
<div class="paragraph">
<p>The Http request can have parameters on the request URL. You can verify those parameters in a separate step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:expect|verify) HTTP request query parameter {name}=\"{value}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given expect HTTP request query parameter {name}="{value}"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-server-request-raw"><a class="anchor" href="#http-server-request-raw"></a><a class="link" href="#http-server-request-raw">7.7.10. Receive raw Http request data</a></h4>
<div class="paragraph">
<p>In the previous section several steps have defined the expected Http request (header, parameter, body).
As an alternative to this approach you can also specify the complete Http request data in a single step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^receive HTTP request$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given receive HTTP request
"""
&lt;&lt;request_data&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example shows the complete Http request data step:</p>
</div>
<div class="listingblock">
<div class="title">Receive raw Http request data</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given receive HTTP request
"""
GET https://hello-service
Accept-Charset:utf-8
Accept:application/json, application/*+json, */*
Host:localhost:8080
Content-Type:text/plain;charset=UTF-8
"""</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-request-jsonpath"><a class="anchor" href="#http-request-jsonpath"></a><a class="link" href="#http-request-jsonpath">7.7.11. Verify requests using JsonPath</a></h4>
<div class="paragraph">
<p>When verifying Http client requests you can use JsonPath expressions to validate
the request message body content.</p>
</div>
<div class="listingblock">
<div class="title">@When("^(?:expect|verify) HTTP request expression: {expression}=\"{value}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When expect HTTP request expression: {expression}="{value}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step defines a JsonPath expression (e.g. <code>$.person.age</code>) and an expected value. The expression is evaluated against
the received request message body and the value is compared to the expected value. This way you can explicitly verify elements
in the Json body.</p>
</div>
<div class="paragraph">
<p>The very same mechanism also applies to XML message body content. Just use a XPath expression instead of JsonPath.</p>
</div>
</div>
<div class="sect3">
<h4 id="http-server-response"><a class="anchor" href="#http-server-response"></a><a class="link" href="#http-server-response">7.7.12. Send Http responses</a></h4>
<div class="paragraph">
<p>The time you have verified a Http request as a server you need to provided a proper response to the calling client.
YAKS is able to simulate the Http response content.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^send HTTP {status_code}(?: {reason_phrase})?$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then send HTTP {status_code} {reason_phrase}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step defines the Http response status code (e.g. 200, 404, 500) to return.</p>
</div>
<div class="listingblock">
<div class="title">Return Http status code</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then send HTTP 200 OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reason phrase <code>OK</code> is optional. It just gives human readers a
better understanding of the status code returned.</p>
</div>
<div class="paragraph">
<p>Of course the Http response can also have headers and a message body. YAKS is able to simulate this response data, too.</p>
</div>
<div class="sect4">
<h5 id="response-headers-2"><a class="anchor" href="#response-headers-2"></a><a class="link" href="#response-headers-2">7.7.12.1. Response headers</a></h5>
<div class="listingblock">
<div class="title">@Given("^HTTP response header {name}=\"{value}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP response header {name}="{value}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step above adds a Http header to the response. The header is defined with a name and value. You can set
multiple headers in a single step, too:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP response headers$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP response headers
  | {name} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step uses a data table to define multiple message headers with name and value.</p>
</div>
<div class="listingblock">
<div class="title">Return response headers</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP response headers
  | Encoding     | gzip |
  | Content-Type | application/json |</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="response-body-2"><a class="anchor" href="#response-body-2"></a><a class="link" href="#response-body-2">7.7.12.2. Response body</a></h5>
<div class="listingblock">
<div class="title">@Given("^HTTP response body: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP response body: {body}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step above specifies the Http response body in a single line. When you need to use multiline body content please use the next step:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP response body$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP response body
"""
&lt;&lt;content&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the response body is getting too big it may be a better idea to load the content from an external file resource:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load HTTP response body {file}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load HTTP response body {file}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step loads the body content from the given file resource.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-server-response-raw"><a class="anchor" href="#http-server-response-raw"></a><a class="link" href="#http-server-response-raw">7.7.13. Send raw Http response data</a></h4>
<div class="paragraph">
<p>In the previous section several steps have defined the Http response (header, parameter, body).
As an alternative to this approach you can also specify the complete Http response data in a single step.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^send HTTP response$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then send HTTP response
"""
&lt;&lt;response_data&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example shows the complete Http response data step:</p>
</div>
<div class="listingblock">
<div class="title">Return raw Http response data</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then send HTTP response
"""
HTTP/1.1 200 OK
Content-Type:application/json
X-TodoId:@isNumber()@
Date: @ignore@

{"id": "@ignore@", "task": "Sample task", "completed": 0}
"""</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-health-checks"><a class="anchor" href="#http-health-checks"></a><a class="link" href="#http-health-checks">7.7.14. Http health checks</a></h4>
<div class="paragraph">
<p>Often Http server provide a health endpoint so clients can check the status of the server to be up and running. The health check is supported with the following steps.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^{URL} is healthy$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given {URL} is healthy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step performs a health check on the given <code>{URL}</code> by sending a request to the endpoint and checking for a response status code marking success (200 OK).</p>
</div>
<div class="listingblock">
<div class="title">Health check</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given https://some-service-url/health is healthy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of specifying the complete health check URL you can make use of the base URL given in the central Http step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^URL {path} is healthy$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given path {path} is healthy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The given path is added to the base URL and should resolve to the health check resource on the server (e.g. <code>/health</code>).</p>
</div>
<div class="listingblock">
<div class="title">Health path check</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given URL: https://hello-service
Given path /health is healthy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The steps above perform the health check only a single time. Based on the provided Http server response status the step passes or fails.
In some cases can not make sure that the server has been started yet and the health check might fail occasionally. In these cases
it is a good iodea to use the wait health check step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^wait for URL {url}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given wait for URL {url}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step will wait for given URL to return a <code>200 OK</code> response. The step is actively waiting while polling the URL multiple times when the response is
not positive. By default this step uses a <code>HEAD</code> request. You can explicitly choose another Http method, too.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^wait for (GET|HEAD|POST|PUT|PATCH|DELETE|OPTIONS|TRACE) on URL {url}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given wait for GET on URL {url}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above uses a <code>GET</code> request for the health checks.</p>
</div>
<div class="paragraph">
<p>Also you can explicitly specify the expected return code that must match in order to pass the wait health check.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^wait for URL {url} to return {status_code}(?: {reason_phrase}?$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given wait for URL {url} to return {status_code} {reason_phrase}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once again the <code>{reason_phrase}</code> is optional and only for better readability reasons.</p>
</div>
<div class="listingblock">
<div class="title">Wait for specific status code</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given wait for URL https://hello-service/health to return 200 OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>Last not least you can specify the request method on the wait operation, too.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^wait for (GET|HEAD|POST|PUT|PATCH|DELETE|OPTIONS|TRACE) on URL {url} to return {status_code}(?: {reason_phrase}?$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given wait for {method} on URL {url} to return {status_code} {reason_phrase}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This completes the health check capabilities in the Http steps.</p>
</div>
</div>
<div class="sect3">
<h4 id="http-secure"><a class="anchor" href="#http-secure"></a><a class="link" href="#http-secure">7.7.15. Https support</a></h4>
<div class="paragraph">
<p>YAKS steps support secure Http connections on both client and server.</p>
</div>
<div class="paragraph">
<p>On the client side enabling secure Http connection is as simple as defining a request URL
with <code>https</code> scheme.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:URL|url): {url}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given URL: https://some.endpoint/path</code></pre>
</div>
</div>
<div class="paragraph">
<p>YAKS is going to initialize the client with a SSL request factory and use secure Http connections.</p>
</div>
<div class="paragraph">
<p>On the server side you have to enable secure Http with the following step:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^enable secure HTTP server$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given enable secure HTTP server</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please use this step before starting the server with:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^start HTTP server$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given start HTTP server</code></pre>
</div>
</div>
<div class="paragraph">
<p>The secure SSL connector uses the port <code>8443</code> by default. You can adjust this secure port
with:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP server secure port {port}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP server secure port {port}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Http server uses a default SSL keystore with a self signed certificate. Users are able
to customize the server certificate with a custom SSL keystore.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP server SSL keystore path {file}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP server SSL keystore path {file}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">@Given("^HTTP server SSL keystore password {password}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given HTTP server SSL keystore password {password}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The steps set a custom keystore (e.g. server.jks) file and a custom keystore password.</p>
</div>
<div class="paragraph">
<p>The keystore settings are also accessible via environment variables.</p>
</div>
<div class="listingblock">
<div class="title">SSL keystore environment variables</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">YAKS_HTTP_SECURE_KEYSTORE_PATH={file}
YAKS_HTTP_SECURE_KEYSTORE_PASSWIRD={password}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Http server components also provide a convenient way to add server properties when creating
new instances:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:create|new) HTTP server \"{name}\" with configuration$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given new HTTP server "{name}" with configuration
| secure              | true       |
| securePort          | 8443       |
| timeout             | 1000       |
| sslKeystorePath     | server.jks |
| sslKeystorePassword | secret     |</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-jdbc"><a class="anchor" href="#steps-jdbc"></a><a class="link" href="#steps-jdbc">7.8. JDBC steps</a></h3>
<div class="paragraph">
<p>YAKS provides steps that allow executing SQL actions on relational databases. This includes updates and queries.
In case of a database query you are able to verify the result set with expected values.</p>
</div>
<div class="paragraph">
<p>You can find examples of JDBC steps in <a href="../../examples/jdbc/jdbc.feature">examples/jdbc</a>.</p>
</div>
<div class="sect3">
<h4 id="jdbc-datasource"><a class="anchor" href="#jdbc-datasource"></a><a class="link" href="#jdbc-datasource">7.8.1. Connection configuration</a></h4>
<div class="paragraph">
<p>Before running any SQL statement you need to configure a datasource that allows connecting to the
database.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:D|d)atabase connection$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Database connection
| {property} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step configures a new database connection and uses a data table to define connection properties such as connection
URL, username and password.</p>
</div>
<div class="listingblock">
<div class="title">Specify connection properties</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Database connection
| driver    | org.postgresql.Driver |
| url       | jdbc:postgresql://localhost:5432/testdb |
| username  | test |
| password  | secret |</code></pre>
</div>
</div>
<div class="paragraph">
<p>This defines the connection parameters so the test is able to connect to the database.</p>
</div>
<div class="paragraph">
<p>In addition to that you can also reference an existing datasource that has been added to the
framework configuration.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:D|d)ata source: {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Data source: {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name of the datasource should reference a configured component in the test project. You can add components as Spring beans
for instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="jdbc-update"><a class="anchor" href="#jdbc-update"></a><a class="link" href="#jdbc-update">7.8.2. SQL update</a></h4>
<div class="paragraph">
<p>The test is able to run SQL updates (UPDATE, INSERT, DELETE) on the database.</p>
</div>
<div class="listingblock">
<div class="title">@When("^(?:execute |perform )?SQL update: {statement}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When execute SQL update: {statement}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step executes the given SQL statement using the configured database connection. For multiline statements please use:</p>
</div>
<div class="listingblock">
<div class="title">@When("^(?:execute |perform )?SQL update$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When execute SQL update
"""
{statement}
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also run multiple statements in a single step by using a data table.</p>
</div>
<div class="listingblock">
<div class="title">@When("^(?:execute |perform )?SQL updates$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When execute SQL updates
| {statement_1} |
| {statement_2} |
...
| {statement_x} |</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jdbc-query"><a class="anchor" href="#jdbc-query"></a><a class="link" href="#jdbc-query">7.8.3. SQL query</a></h4>
<div class="paragraph">
<p>The SQL query obtains data from the database in form of result sets. The YAKS test is able to verify the result sets with an expected
set of rows and column values returned.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^SQL query: {statement}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given SQL query: {statement}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step defines the query to execute. Multiline SQL query statements are supported, too.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^SQL query$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given SQL query
"""
{statement}
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also run multiple queries in one step. As usual the step uses a data table.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^SQL query statements$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When SQL query statements
| {statement_1} |
| {statement_2} |
...
| {statement_x} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a next step you can provide the expected outcome in form of column name and value.</p>
</div>
<div class="sect4">
<h5 id="verify-sql-result-set"><a class="anchor" href="#verify-sql-result-set"></a><a class="link" href="#verify-sql-result-set">7.8.3.1. Verify SQL result set</a></h5>
<div class="listingblock">
<div class="title">@Then("^verify column {name}={value}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then verify column {name}={value}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step executes the query and verifies the column with given name to match the expected value.</p>
</div>
<div class="paragraph">
<p>You can use multiple verifications on several columns with a data table.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^verify columns$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then verify columns
| {column_1} | {value_1_1} | {value_1_2} |
| {column_2} | {value_2_1} | {value_2_2} |
...
| {column_x} | {value_x_x} | {value_x_x} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The data table is able to verify a matrix of rows and columns. Each column can have multiple row values.</p>
</div>
<div class="listingblock">
<div class="title">Validate multi row result sets</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given SQL query: SELECT ID, TASK, COMPLETED FROM todo ORDER BY id
Then verify columns
| ID        | 1                  | 2             | 3          | 4            | @ignore@               |
| TASK      | Learn some Camel K! | Get some milk | Do laundry | Wash the dog | Test CamelK with YAKS! |
| COMPLETED | 0                  | 0             | 0          |            0 | 0                      |</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="result-set-verification-script"><a class="anchor" href="#result-set-verification-script"></a><a class="link" href="#result-set-verification-script">7.8.4. Result set verification script</a></h4>
<div class="paragraph">
<p>For more complex result set validation you can use a Groovy result set verification script.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^verify result set$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then verify result set
"""
&lt;&lt;Groovy&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Groovy script can work with the complete result set and is quite powerful.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given SQL query: SELECT TASK FROM todo
Then verify result set
"""
assert rows.size == 1
assert rows[0].TASK == 'Learn some Camel K!'
"""</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-jms"><a class="anchor" href="#steps-jms"></a><a class="link" href="#steps-jms">7.9. JMS steps</a></h3>
<div class="paragraph">
<p>JMS is well-known as transport for point-to-point and publish/subscribe messaging. Users can produce and consume messages on
queues and topics on a message broker.</p>
</div>
<div class="paragraph">
<p>YAKS has support for JMS related messaging on both producer and consumer.</p>
</div>
<div class="sect3">
<h4 id="jms-connection-factory"><a class="anchor" href="#jms-connection-factory"></a><a class="link" href="#jms-connection-factory">7.9.1. Connection factory</a></h4>
<div class="paragraph">
<p>The JMS standard requires clients to open connections over a connection factory. The connection factory is a vendor specific
implementation and receives a set of properties such as connection URL, username and password.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:JMS|jms) connection factory$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS connection factory
| {property} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration step receives a data table that defines the connection settings.</p>
</div>
<div class="listingblock">
<div class="title">Connection factory settings</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS connection factory
| type       | org.apache.activemq.artemis.jms.client.ActiveMQConnectionFactory |
| brokerUrl  | tcp://localhost:61616 |
| username   | ${activemq.user}      |
| password  | ${activemq.password}  |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The connection factory type is vendor specific and depends on what kind of message broker you are using in your environment. Please
make sure to add the respective client library as a project dependency in the YAKS configuration.</p>
</div>
<div class="paragraph">
<p>Sensitive values such as <code>username</code> and <code>password</code> can be set with a test variable placeholder. The variable value can
be set by a secret in Kubernetes/Openshift. This ensures to not share sensitive data in the public.</p>
</div>
<div class="paragraph">
<p>As an alternative to defining the connection factory as part of the test steps you can load a predefined connection factory
component from the configuration.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:JMS|jms) connection factory {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS connection factory {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step references a connection factory component that has been added to the framework configuration (e.g. as Spring bean).
This way you can share the connection factory in multiple tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="jms-endpoint"><a class="anchor" href="#jms-endpoint"></a><a class="link" href="#jms-endpoint">7.9.2. Destination and endpoint configuration</a></h4>
<div class="paragraph">
<p>In addition to the connection factory the test needs to specify the JMS destination (queue or topic) to use.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:JMS|jms) destination: {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS destination: {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the destination name for the next steps. As an alternative to that you can also reference a predefined endpoint
component from the configuration.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:JMS|jms) endpoint \"{name}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS endpoint {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step tries to resolve the JMS endpoint with given <code>{name}</code> in the available configuration. The endpoint has a destination set
and references a connection factory on its own.</p>
</div>
<div class="paragraph">
<p>So now the test is ready to produce and consume messages from JMS destinations.</p>
</div>
</div>
<div class="sect3">
<h4 id="jms-send"><a class="anchor" href="#jms-send"></a><a class="link" href="#jms-send">7.9.3. Send JMS messages</a></h4>
<div class="paragraph">
<p>A test can publish messages on a JMS destination. The message consists of message headers and a body content. Before sending a message
the tests needs to specify the message content.</p>
</div>
<div class="sect4">
<h5 id="message-headers"><a class="anchor" href="#message-headers"></a><a class="link" href="#message-headers">7.9.3.1. Message headers</a></h5>
<div class="paragraph">
<p>The message headers are key value pairs that are sent as part of the message. You can add a new header with the following step:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:JMS|jms) message header {name}(?:=| is )\"{value}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS message header {name}="{value}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using a data table you can set multiple headers in one step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:JMS|jms) message headers$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS message headers
| {header_1} | {value_1} |
| {header_2} | {value_2} |
...
| {header_x} | {value_x} |</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="message-body"><a class="anchor" href="#message-body"></a><a class="link" href="#message-body">7.9.3.2. Message body</a></h5>
<div class="listingblock">
<div class="title">@Given("^(?:JMS|jms) message body: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS message body: {body}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step can set a single line body content. Of course you can also work with multiline body content.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:JMS|jms) message body$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS message body
"""
{body}
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the body is getting too big it may be a better idea to load the content from an external file resource:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load (?:JMS|jms) message body {file}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load JMS message body {file}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step loads the body content from the given file resource.</p>
</div>
<div class="paragraph">
<p>Now another step can send the message as it has been specified in the previous steps.</p>
</div>
<div class="listingblock">
<div class="title">@When("^send (?:JMS|jms) message$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send JMS message</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sends the message to the previously configured JMS destination. You can overwrite this destination in the send step.</p>
</div>
<div class="listingblock">
<div class="title">@When("^send (?:JMS|jms) message to destination {destination}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send JMS message to destination {destination}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The approach described clearly separates message specification and send operation as all of it is done in separate steps.
As an alternative you can also specify the message content in one step.</p>
</div>
<div class="listingblock">
<div class="title">@When("^send (?:JMS|jms) message with body: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send JMS message with body: {body}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also add some message headers to this step.</p>
</div>
<div class="listingblock">
<div class="title">@When("^send (?:JMS|jms) message with body and headers: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send JMS message with body and headers: {body}
| {header_1} | {value_1} |
| {header_2} | {value_2} |
...
| {header_x} | {value_x} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step combines message header and body specification with the actual send operation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jms-receive"><a class="anchor" href="#jms-receive"></a><a class="link" href="#jms-receive">7.9.4. Receive JMS messages</a></h4>
<div class="paragraph">
<p>Similar to sending messages to a JMS destination the test can also consume messages from a queue or topic. When the message
has been received a validation mechanism makes sure that the message content received matches the expectations.</p>
</div>
<div class="paragraph">
<p>Users are able to provide expected message headers and body content in order to verify the received message.</p>
</div>
<div class="sect4">
<h5 id="message-headers-2"><a class="anchor" href="#message-headers-2"></a><a class="link" href="#message-headers-2">7.9.4.1. Message headers</a></h5>
<div class="paragraph">
<p>The expected message headers need to be set before receiving the message from the destination.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:JMS|jms) message header {name}(?:=| is )\"{value}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS message header {name}="{value}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using a data table you can expect multiple headers in one step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:JMS|jms) message headers$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS message headers
| {header_1} | {value_1} |
| {header_2} | {value_2} |
...
| {header_x} | {value_x} |</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="message-body-2"><a class="anchor" href="#message-body-2"></a><a class="link" href="#message-body-2">7.9.4.2. Message body</a></h5>
<div class="paragraph">
<p>In addition to verify message headers you can also verify the body content. Once again the user specifies the expected message
body before the message is received.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:JMS|jms) message body: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS message body: {body}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step can expect a single line body content. Of course you can also work with multiline body content.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:JMS|jms) message body$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS message body
"""
{body}
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the body is getting too big it may be a better idea to load the content from an external file resource:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load (?:JMS|jms) message body {file}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load JMS message body {file}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step loads the body content from the given file resource.</p>
</div>
<div class="paragraph">
<p>With the steps above the test has specified the expected message content. With that in place another step can receive the message
and perform the validation.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^receive (?:JMS|jms) message$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive JMS message</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step uses the previously defined JMS destination to consume messages from it. You can use another destination in the step, too.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^receive (?:JMS|jms) message from destination {destination}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive JMS message from destination {destination}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this approach you have a clean separation of the expected message content specification and the actual receive operation.
Of course you can also combine everything in one single step.</p>
</div>
<div class="listingblock">
<div class="title">@Then(?:receive|expect|verify) (?:JMS|jms) message with body: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive JMS message with body: {body}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also add some message headers to this step.</p>
</div>
<div class="listingblock">
<div class="title">@Then(?:receive|expect|verify) (?:JMS|jms) message with body and headers: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive JMS message with body and headers: {body}
| {header_1} | {value_1} |
| {header_2} | {value_2} |
...
| {header_x} | {value_x} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step combines message header and body specification with the actual receive operation.</p>
</div>
</div>
<div class="sect4">
<h5 id="consumer-timeout"><a class="anchor" href="#consumer-timeout"></a><a class="link" href="#consumer-timeout">7.9.4.3. Consumer timeout</a></h5>
<div class="paragraph">
<p>The receive operation takes the first message available on the destination and performs the validation. In case there is no
message available the consumer will wait for a given amount of time before a timeout will fail the test. You can adjust the timeout on
the JMS consumer.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:JMS|jms) consumer timeout is {time}(?: ms| milliseconds)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS consumer timeout is {time} milliseconds</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="message-selectors"><a class="anchor" href="#message-selectors"></a><a class="link" href="#message-selectors">7.9.4.4. Message selectors</a></h5>
<div class="paragraph">
<p>The JMS standard provides a concept of message selectors so consumers can specify which message they want to consume from a destination.
The consumer usually evaluates the selector expression on the message headers.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:JMS|jms) selector: {expression}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS selector: {expression}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The selector expression defines a key and value that the message must match. The first message to match the selector on the destination
it received by the consumer.</p>
</div>
<div class="listingblock">
<div class="title">Use message selector</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given JMS selector: key='value'</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-kafka"><a class="anchor" href="#steps-kafka"></a><a class="link" href="#steps-kafka">7.10. Kafka steps</a></h3>
<div class="paragraph">
<p>Apache Kafka is a powerful and widely used event streaming platform. Users are able publish events and subscribe to
event streams.</p>
</div>
<div class="paragraph">
<p>The following sections describe the support for Kafka related event streaming in YAKS.</p>
</div>
<div class="sect3">
<h4 id="kafka-connection"><a class="anchor" href="#kafka-connection"></a><a class="link" href="#kafka-connection">7.10.1. Connection</a></h4>
<div class="paragraph">
<p>First of all the test needs to connect to Kafka bootstrap servers. The connection provides several parameters that you can
set with the following step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) connection")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka connection
| {property} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration step receives a data table that defines the connection settings.</p>
</div>
<div class="listingblock">
<div class="title">Connection settings</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka connection
| url           | localhost:9092 |
| consumerGroup | yaks_group     |
| topic         | yaks_test      |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most important part of the connection settings is the <code>url</code> that points to one or more Kafka bootstrap servers.</p>
</div>
<div class="paragraph">
<p>In addition to the connection settings there is a set of producer and consumer properties that you can set in order to configure
the behavior of producers and consumers connecting with Kafka.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) producer configuration$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka producer configuration
| {property} | {value} |</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) consumer configuration$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka consumer configuration
| {property} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The available properties to set here are described in the Apache Kafka documentation. See the following example how to set producer and
consumer properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka producer configuration
| client.id          | yaks_producer |
| request.timeout.ms | 5000 |

Given Kafka consumer configuration
| client.id          | yaks_consumer |
| max.poll.records   | 1 |</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kafka-endpoint"><a class="anchor" href="#kafka-endpoint"></a><a class="link" href="#kafka-endpoint">7.10.2. Topic and endpoint configuration</a></h4>
<div class="paragraph">
<p>In addition to the connection the test needs to specify the Kafka topic to use.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) topic: {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka topic: {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the topic name for the next steps. As an alternative to that you can also reference a predefined endpoint
component from the configuration.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) endpoint \"{name}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka endpoint {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step tries to resolve the Kafka endpoint with given <code>{name}</code> in the available configuration. The endpoint can reference
a topic set and connection settings on its own.</p>
</div>
<div class="paragraph">
<p>So now the test is ready to produce and consume events from Kafka topics.</p>
</div>
</div>
<div class="sect3">
<h4 id="kafka-send"><a class="anchor" href="#kafka-send"></a><a class="link" href="#kafka-send">7.10.3. Send Kafka events</a></h4>
<div class="paragraph">
<p>A test can publish events on a Kafka topic. The event consists of message headers and a body content. Before sending an event
the tests needs to specify the message content.</p>
</div>
<div class="sect4">
<h5 id="message-key"><a class="anchor" href="#message-key"></a><a class="link" href="#message-key">7.10.3.1. Message key</a></h5>
<div class="paragraph">
<p>Each event on a Kafka event stream has a message key set. You can set this key in a separate step before sending the event.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) message key: {key}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka message key: {key}$")</code></pre>
</div>
</div>
<div class="paragraph">
<p>This specifies the message key for the next event that is published.</p>
</div>
</div>
<div class="sect4">
<h5 id="message-headers-3"><a class="anchor" href="#message-headers-3"></a><a class="link" href="#message-headers-3">7.10.3.2. Message headers</a></h5>
<div class="paragraph">
<p>The message headers are key value pairs that are sent as part of the message. You can add a new header with the following step:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) message header {name}(?:=| is )\"{value}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka message header {name}="{value}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using a data table you can set multiple headers in one step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) message headers$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka message headers
| {header_1} | {value_1} |
| {header_2} | {value_2} |
...
| {header_x} | {value_x} |</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="message-body-3"><a class="anchor" href="#message-body-3"></a><a class="link" href="#message-body-3">7.10.3.3. Message body</a></h5>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) message body: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka message body: {body}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step can set a single line body content. Of course you can also work with multiline body content.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) message body$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka message body
"""
{body}
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the body is getting too big it may be a better idea to load the content from an external file resource:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load (?:Kafka|kafka) message body {file}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load Kafka message body {file}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step loads the body content from the given file resource.</p>
</div>
<div class="paragraph">
<p>Now another step can publish the message as it has been specified in the previous steps.</p>
</div>
<div class="listingblock">
<div class="title">@When("^send (?:Kafka|kafka) message$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send Kafka message</code></pre>
</div>
</div>
<div class="paragraph">
<p>This publishes the message to the previously configured Kafka topic. You can overwrite this topic in the publish step.</p>
</div>
<div class="listingblock">
<div class="title">@When("^send (?:Kafka|kafka) message to topic {topic}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send Kafka message to topic {topic}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The approach described clearly separates message specification and send operation as all of it is done in separate steps.
As an alternative you can also specify the message content in one step.</p>
</div>
<div class="listingblock">
<div class="title">@When("^send (?:Kafka|kafka) message with body: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send Kafka message with body: {body}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also add some message headers to this step.</p>
</div>
<div class="listingblock">
<div class="title">@When("^send (?:Kafka|kafka) message with body and headers: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send Kafka message with body and headers: {body}
| {header_1} | {value_1} |
| {header_2} | {value_2} |
...
| {header_x} | {value_x} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step combines message header and body specification with the actual send operation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kafka-receive"><a class="anchor" href="#kafka-receive"></a><a class="link" href="#kafka-receive">7.10.4. Receive Kafka events</a></h4>
<div class="paragraph">
<p>Similar to publishing events to a Kafka topic the test can also consume events from an event stream. When the event
has been received a validation mechanism makes sure that the message content received matches the expectations.</p>
</div>
<div class="paragraph">
<p>Users are able to provide expected message headers and body content in order to verify the received event.</p>
</div>
<div class="sect4">
<h5 id="message-headers-4"><a class="anchor" href="#message-headers-4"></a><a class="link" href="#message-headers-4">7.10.4.1. Message headers</a></h5>
<div class="paragraph">
<p>The expected message headers need to be set before receiving the event from the topic.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) message header {name}(?:=| is )\"{value}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka message header {name}="{value}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using a data table you can expect multiple headers in one step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) message headers$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka message headers
| {header_1} | {value_1} |
| {header_2} | {value_2} |
...
| {header_x} | {value_x} |</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="message-body-4"><a class="anchor" href="#message-body-4"></a><a class="link" href="#message-body-4">7.10.4.2. Message body</a></h5>
<div class="paragraph">
<p>In addition to verify message headers you can also verify the body content. Once again the user specifies the expected message
body before the message is received.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) message body: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka message body: {body}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step can expect a single line body content. Of course, you can also work with multiline body content.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) message body$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka message body
"""
{body}
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the body is getting too big it may be a better idea to load the content from an external file resource:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load (?:Kafka|kafka) message body {file}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load Kafka message body {file}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step loads the body content from the given file resource.</p>
</div>
<div class="paragraph">
<p>With the steps above the test has specified the expected message content. With that in place another step can receive the message
and perform the validation.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^receive (?:Kafka|kafka) message$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive Kafka message</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step uses the previously defined Kafka topic to consume events from it. You can use another topic in the step, too.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^receive (?:Kafka|kafka) message from topic {topic}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive Kafka message from topic {topic}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this approach you have a clean separation of the expected message content specification and the actual receive operation.
Of course you can also combine everything in one single step.</p>
</div>
<div class="listingblock">
<div class="title">@Then(?:receive|expect|verify) (?:Kafka|kafka) message with body: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive Kafka message with body: {body}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also add some message headers to this step.</p>
</div>
<div class="listingblock">
<div class="title">@Then(?:receive|expect|verify) (?:Kafka|kafka) message with body and headers: {body}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive Kafka message with body and headers: {body}
| {header_1} | {value_1} |
| {header_2} | {value_2} |
...
| {header_x} | {value_x} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step combines message header and body specification with the actual receive operation.</p>
</div>
</div>
<div class="sect4">
<h5 id="consumer-timeout-2"><a class="anchor" href="#consumer-timeout-2"></a><a class="link" href="#consumer-timeout-2">7.10.4.3. Consumer timeout</a></h5>
<div class="paragraph">
<p>The receive operation takes the first event available on the topic and performs the validation. In case there is no
event available the consumer will wait for a given amount of time before a timeout will fail the test. You can adjust the timeout on
the Kafka consumer.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) consumer timeout is {time}(?: ms| milliseconds)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka consumer timeout is {time} milliseconds</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kafka-special-config"><a class="anchor" href="#kafka-special-config"></a><a class="link" href="#kafka-special-config">7.10.5. Special configuration</a></h4>
<div class="paragraph">
<p>The Kafka standard provides a set of special configuration that you can set as part of the test.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Kafka|kafka) topic partition: {partition}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kafka topic partition: {partition}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This set the topic partition for all further steps publishing or consuming events from that topic.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-kubernetes"><a class="anchor" href="#steps-kubernetes"></a><a class="link" href="#steps-kubernetes">7.11. Kubernetes steps</a></h3>
<div class="paragraph">
<p>Kubernetes is a famous container management platform that allows automation
of deployment, scaling and management of containerized applications.</p>
</div>
<div class="paragraph">
<p>YAKS uses the Kubernetes client API and is able to create Kubernetes resources
(e.g. secrets, services, deployments and so on) as part of the test.</p>
</div>
<div class="sect3">
<h4 id="k8s-api-version"><a class="anchor" href="#k8s-api-version"></a><a class="link" href="#k8s-api-version">7.11.1. API version</a></h4>
<div class="paragraph">
<p>The default Kubernetes API version used to create and manage resources is <code>v1</code>. You can overwrite this
version with an environment variable set on the YAKS configuration.</p>
</div>
<div class="listingblock">
<div class="title">Overwrite Kubernetes API version</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">YAKS_KUBERNETES_API_VERSION=v1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the Kubernetes API version for all operations.</p>
</div>
</div>
<div class="sect3">
<h4 id="k8s-client"><a class="anchor" href="#k8s-client"></a><a class="link" href="#k8s-client">7.11.2. Client configuration</a></h4>
<div class="listingblock">
<div class="title">@Given("^Kubernetes timeout is {time}(?: ms| milliseconds)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given("^Kubernetes timeout is {time} milliseconds</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the timeout for all Kubernetes client operations.</p>
</div>
</div>
<div class="sect3">
<h4 id="k8s-namespace"><a class="anchor" href="#k8s-namespace"></a><a class="link" href="#k8s-namespace">7.11.3. Set namespace</a></h4>
<div class="paragraph">
<p>Kubernetes uses the concept of namespaces to separate workloads on the cluster. You
can connect to a specific namespace with the follwing step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Kubernetes namespace {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kubernetes namespace {name}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="k8s-pod-state"><a class="anchor" href="#k8s-pod-state"></a><a class="link" href="#k8s-pod-state">7.11.4. Verify pod state</a></h4>
<div class="paragraph">
<p>A Kubernetes pod has a state and is in a phase (e.g. running, stopped). You can verify the state with an expectation.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Kubernetes pod {name} is running/stopped$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kubernetes pod {name} is running</code></pre>
</div>
</div>
<div class="paragraph">
<p>Checks that the Kubernetes pod with given <code>{name}</code> is in state running and that the number of replicas is &gt; 0. The step polls
the state of the pod for a given amount of attempts with a given delay between attempts. You can adjust the polling settings with:</p>
</div>
<div class="listingblock">
<div class="title">@Given Kubernetes resource polling configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kubernetes resource polling configuration
    | maxAttempts          | 10   |
    | delayBetweenAttempts | 1000 |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of identifying the pod by its name you can also filter the pod with a label expression. The expression
is a label key and value that identifies the pod in the current namespace.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Kubernetes pod labeled with {label}={value} is running/stopped$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kubernetes pod labeled with {label}={value} is running</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="k8s-watch-logs"><a class="anchor" href="#k8s-watch-logs"></a><a class="link" href="#k8s-watch-logs">7.11.5. Watch Kubernetes pod logs</a></h4>
<div class="listingblock">
<div class="title">@Given("^Kubernetes pod {name} should print (.*)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kubernetes pod {name} should print {log-message}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Watches the log output of a Kubernetes pod and waits for given <code>{log-message}</code> to be present in the logs. The step polls the
logs for a given amount of time. You can adjust the polling configuration with:</p>
</div>
<div class="listingblock">
<div class="title">@Given Kubernetes resource polling configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kubernetes resource polling configuration
    | maxAttempts          | 10   |
    | delayBetweenAttempts | 1000 |</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also wait for a log message to <strong>not</strong> be present in the output. Just use this step:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Kubernetes pod {name} should not print (.*)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kubernetes pod {name} should not print {log-message}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="k8s-service"><a class="anchor" href="#k8s-service"></a><a class="link" href="#k8s-service">7.11.6. Kubernetes services</a></h4>
<div class="paragraph">
<p>One of the most important features in the YAKS Kubernetes support is the management of
services and in particular the automatic deployment of simulated services in Kubernetes.</p>
</div>
<div class="paragraph">
<p>The user is able to start a local Http server instance and create a service in Kubernetes out of it.
This way the test is able to simulate services in Kubernetes and receive and verify incoming requests
as part of the test.</p>
</div>
<div class="paragraph">
<p>First of all we define a new service within the test.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Kubernetes service \"{name}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kubernetes service "{name}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This initializes a new Http server that will be used as Kubernetes service. The server is listening on
a default port <code>8080</code>. You can use another port.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Kubernetes service port {port}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kubernetes service port {port}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following the test is able to create a new Kubernetes service with that Http server.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^create Kubernetes service {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Kubernetes service {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step creates the service in the Kubernetes namespace and exposes the given service port as target port.
Clients are now able to connect to that new service. Each requests on the service will reside in a request
in the test pod. The test is able to receive the request and verify its content as usual.</p>
</div>
<div class="paragraph">
<p>This way we can easily simulate Kubernetes services in the current namespace.</p>
</div>
<div class="paragraph">
<p>In case you need to use another target port you can adjust the port as follows.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^create Kubernetes service {name} with target port {port}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Kubernetes service {name} with target port {port}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This exposes the service with the given target port.</p>
</div>
<div class="paragraph">
<p>In case you do not need the service anymore you can delete it with this step:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^delete Kubernetes service {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given delete Kubernetes service {name}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="k8s-secrets"><a class="anchor" href="#k8s-secrets"></a><a class="link" href="#k8s-secrets">7.11.7. Secrets</a></h4>
<div class="paragraph">
<p>Secrets are resources that hold sensitive data. Other resources on the cluster can mount
the secret content and access it.</p>
</div>
<div class="paragraph">
<p>You can create secrets in the current namespace in multiple ways.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^create Kubernetes secret {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Kubernetes secret {name}
| {property} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step receives a secret name and a data table holding the property keys and values. These properties
build the content of the secret.</p>
</div>
<div class="paragraph">
<p>Instead of listing all properties in the test itself you can load the secret from an external property file.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load Kubernetes secret from file {file}.properties$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load Kubernetes secret from file {file}.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step loads the property file and creates the secret from the file content. The file name is used
as the name fo the secret.</p>
</div>
<div class="paragraph">
<p>In case you want to clean up the secret you can delete it with:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^delete Kubernetes secret {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given delete Kubernetes secret {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes secrets need to have labels and/or annotations that mark the secret with important metadata.
You can add labels/annotations on the Kubernetes resource with these steps:</p>
</div>
<div class="listingblock">
<div class="title">@Then("^create label {label}={value} on Kubernetes secret {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then create label app=yaks on Kubernetes secret my-secret</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">@Then("^create annotation {annotation}={value} on Kubernetes secret {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then create annotation app=yaks on Kubernetes secret my-secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or use multiple labels/annotations in one single step:</p>
</div>
<div class="listingblock">
<div class="title">@Then("^create labels on Kubernetes secret {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then create labels on Kubernetes secret my-secret
    | app      | yaks |
    | owned-by | odo  |</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">@Then("^create annotations on Kubernetes secret {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then create annotations on Kubernetes secret my-secret
    | app      | yaks |
    | owned-by | odo  |</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="k8s-resources"><a class="anchor" href="#k8s-resources"></a><a class="link" href="#k8s-resources">7.11.8. Pods, deployments and other resources</a></h4>
<div class="paragraph">
<p>In the previous sections the test has creates services and secrets as Kubernetes resources. In addition to
that the test is able to apply any resource as a YAML file on the Kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^create Kubernetes resource$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Kubernetes resource
"""
&lt;&lt;YAML&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this step you can apply any Kubernetes resource as a YAML file.</p>
</div>
<div class="listingblock">
<div class="title">Apply Kubernetes resource</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Kubernetes resource
"""
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
  labels:
    name: my-pod
spec:
  containers:
  - name: nginx
    image: nginx
    ports:
    - containerPort: 80
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step above creates a new pod resource with the given specification. Instead of
adding the resource specification in the test itself you can also load an external YAML file.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load Kubernetes resource {file_path}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load Kubernetes resource {file_path}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Load pod.yaml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load Kubernetes resource pod.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">pod.yaml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">apiVersion: v1
kind: Pod
metadata:
  name: my-pod
  labels:
    name: my-pod
spec:
  containers:
  - name: nginx
    image: nginx
    ports:
    - containerPort: 80</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case you need to delete a resource you can do so by specifying the minimal resource
as a YAML specification.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^delete Kubernetes resource$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given delete Kubernetes resource
"""
&lt;&lt;YAML&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Delete resource</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given delete Kubernetes resource
"""
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also provide the external YAML file when deleting a resource. The step will
automatically extract the resource kind and name from the file content.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^delete Kubernetes resource {file_path}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given delete Kubernetes resource {file_path}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Delete resource from file</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given delete Kubernetes resource pod.yaml</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="k8s-crd"><a class="anchor" href="#k8s-crd"></a><a class="link" href="#k8s-crd">7.11.9. Custom resources</a></h4>
<div class="paragraph">
<p>In the previous sections the test has created Kubernetes resources (pods, services, secrets, deployments, &#8230;&#8203;). The user can
also define custom resources in order to extend Kubernetes. YAKS is also able to manage these custom resources.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^create Kubernetes custom resource in {crd}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Kubernetes custom resource in {crd}
"""
&lt;&lt;YAML&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>The user has to provide a YAML specification of the custom resource.</p>
</div>
<div class="listingblock">
<div class="title">Create custom resource</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Kubernetes custom resource in brokers.eventing.knative.dev
"""
apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
  name: my-broker
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step needs to know the <code>{crd}</code> (Custom Resource Definition) of the custom resource. In the example above the test
creates a new resource of kind <code>Broker</code> in the custom resource definition <code>brokers.eventing.knative.dev</code>.</p>
</div>
<div class="paragraph">
<p>Of course, you can also load the custom resource from external file resource.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load Kubernetes custom resource {file_path} in {crd}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load Kubernetes custom resource {file_path} in {crd}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Load custom resource from file</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load Kubernetes custom resource broker.yaml in brokers.eventing.knative.dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once again the step needs to have the CRD type and the YAML specification as a file resource.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You need to make sure that the YAKS runtime has proper permissions to manage the custom resource.
The proper roles and role bindings need to apply to the YAKS operator service account <code>yaks-operator</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Prior to using the custom resource in a YAKS test you need to grant role permissions to the YAKS runtime.
Otherwise, the test is not allowed to create the custom resource due to security constraints on the cluster.</p>
</div>
<div class="paragraph">
<p>The YAKS runtime uses a service account <code>yaks-viewer</code> to run the test.
The service account needs to have proper roles and permissions for managing the custom resource.</p>
</div>
<div class="paragraph">
<p>The YAKS operator uses another service account <code>yaks-operator</code>.
This service account needs to have the same permissions on the custom resource, too.
This is because the operator manages the <code>yaks-viewer</code> service account in a specific namespace.
When using temporary namespaces as a test runtime the YAKS operator will create the <code>yaks-viewer</code> service account and
its roles and permissions on the fly.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You should always grant roles and permissions to the <code>yaks-operator</code> service account.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Assume that there is a CRD <code>foos.yaks.dev</code> and you want to manage the resources in your test:</p>
</div>
<div class="listingblock">
<div class="title">crd-foo.yaml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  labels:
    app: "yaks"
  creationTimestamp: null
  name: foos.yaks.dev
spec:
  group: yaks.dev
  names:
    kind: Foo
    listKind: FooList
    plural: foos
    singular: foo
  scope: Namespaced
  versions:
  - name: v1alpha1
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        description: Foo resource schema
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: Spec defines the desired state of Test
            properties:
              message:
                type: string
            required:
              - message
            type: object
          status:
            description: Status defines the observed state of Foo
            properties:
              conditions:
                items:
                  description: Condition describes the state of a resource at a certain point.
                  properties:
                    message:
                      description: A human readable message indicating details about the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type of condition.
                      type: string
                  required:
                    - status
                    - type
                  type: object
                type: array
              version:
                type: string
            type: object
        type: object
    subresources:
      status: {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The role to manage the new CRD <code>foos.yaks.dev</code> would be:</p>
</div>
<div class="listingblock">
<div class="title">role-foo.yaml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: yaks-operator-foo
  labels:
    app: "yaks"
    yaks.citrusframework.org/append-to-viewer: "true"
rules:
- apiGroups:
    - yaks.dev
  resources:
    - foos
  verbs:
    - create
    - delete
    - get
    - list
    - update</code></pre>
</div>
</div>
<div class="paragraph">
<p>The role <code>yaks-operator-foo</code> is granted to create/delete/get/list/update custom resources of type <code>foos.yaks.dev</code>.</p>
</div>
<div class="paragraph">
<p>You also need a role pipe to the <code>yaks-operator</code> service account:</p>
</div>
<div class="listingblock">
<div class="title">role-pipe-foo.yaml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: yaks-operator-foo
  labels:
    app: "yaks"
    yaks.citrusframework.org/append-to-viewer: "true"
subjects:
- kind: ServiceAccount
  name: yaks-operator
roleRef:
  kind: Role
  name: yaks-operator-foo
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use the usual Kubernetes tools to create the role and role bindings.
Please make sure to add the role to each operator instance in all namespaces, when using multiple YAKS operators on the cluster.
Also, you may need to use cluster roles when using a global YAKS operator.
All of this is already covered when using the <code>yaks role</code> command.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use the YAKS command line tool to properly add the role and role pipe on the YAKS operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">yaks role add role-foo.yaml
yaks role add role-pipe-foo.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The commands above create the role and role bindings on the <code>yaks-operator</code> service account.
The command automatically covers all available operator instances on the cluster.
Also, the command will automatically convert the role to a cluster role when there is a global operator on the cluster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This role setup must be done by a cluster administrator.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Both role resources use a specific label <code>yaks.citrusframework.org/append-to-viewer: "true"</code>.
This makes sure that the YAKS operator adds the permissions also to the <code>yaks-viewer</code> account.
This is done automatically when the operator starts a new test.</p>
</div>
<div class="paragraph">
<p>As a naming convention the roles and role bindings targeting on the YAKS operator use the <code>yaks-operator-</code> name prefix.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When using temporary namespaces in combination with a non-global YAKS operator, you need to add the roles explicitly
in the runtime configuration in <code>yaks-config.yaml</code>. This is not required when using a global YAKS operator.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In case you want to make use of temporary namespaces you need to add the roles to the runtime configuration of the test.
This is because the operator for the temporary namespace will not be able to automatically apply the additional operator
roles.</p>
</div>
<div class="paragraph">
<p>Please add the roles to the <code>yaks-config.yaml</code> as follows.</p>
</div>
<div class="listingblock">
<div class="title">yaks-config.yaml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">config:
  operator:
    roles:
      - role-foo.yaml
      - role-pipe-foo.yaml
  namespace:
    temporary: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>This makes sure that the yaks command line tool installs the roles on the temporary namespace before the test is run.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The approach requires the YAKS command line tool user to have sufficient permissions to manage roles on the cluster.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In case you need to delete a custom resource from Kubernetes the user has to provide a minimal
YAML specification that identifies the resource.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^delete Kubernetes custom resource in {crd}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then delete Kubernetes custom resource in {crd}
"""
&lt;&lt;YAML&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Delete custom resource</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then delete Kubernetes custom resource in {crd}
"""
apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
  name: my-broker
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative to that you can use an external file resource that holds
the minimal YAML specification.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^delete Kubernetes custom resource {file_path} in {crd}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then delete Kubernetes custom resource {file_path} in {crd}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Delete custom resource from file</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then delete Kubernetes custom resource broker.yaml in brokers.eventing.knative.dev</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="k8s-crd-condition"><a class="anchor" href="#k8s-crd-condition"></a><a class="link" href="#k8s-crd-condition">7.11.10. Verify custom resource conditions</a></h4>
<div class="paragraph">
<p>Custom resources often define a status and describe multiple conditions (e.g. ready, available, completed).
You can verify the condition on a custom resource.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^wait for condition={condition} on Kubernetes custom resource {name} in {type}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given wait for condition={condition} on Kubernetes custom resource {name} in {type}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step verifies that the given Kubernetes resource with name <code>{name}</code> describes a status condition <code>{condition}</code>. The step polls
the state of the resource for a given amount of attempts with a given delay between attempts. You can adjust the polling settings with:</p>
</div>
<div class="listingblock">
<div class="title">@Given Kubernetes resource polling configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Kubernetes resource polling configuration
    | maxAttempts          | 10   |
    | delayBetweenAttempts | 1000 |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assume you have a custom resource like this:</p>
</div>
<div class="listingblock">
<div class="title">foo-crd.yaml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">apiVersion: yaks.dev/v1
kind: Foo
metadata:
  name: my-foo-resource
spec:
  message: Hello
status:
  conditions:
  - type: Initialized
    status: true
  - type: Ready
    status: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom resource defines a status with multiple conditions. You can wait for a condition in the test.</p>
</div>
<div class="listingblock">
<div class="title">Wait for condition=Ready</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given wait for condition=Ready on Kubernetes custom resource foo/my-foo-resource in foos.yaks.dev/v1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The expected condition is <code>Ready</code> for the resource named <code>my-foo-resource</code>. The resource name can use a prefix that represents
the kind information <code>foo/</code>. The kind helps to identify the custom resource. Also the step defines the resource type <code>foos.yaks.dev</code> and
version <code>v1</code>. This is required to identify the custom resource on the cluster.</p>
</div>
<div class="paragraph">
<p>Instead of identifying the resource by its name you can also filter the resources with a label expression. The expression
is a label key and value that identifies the resource in the current namespace.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^wait for condition={condition} on Kubernetes custom resource in {type} labeled with {key}={value}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given wait for condition={condition} on Kubernetes custom resource in {type} labeled with {key}={value}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will get all resources of type <code>{type}</code> and filter by given label <code>{key}={value}</code>. Then the given condition is verified
on the resource.</p>
</div>
</div>
<div class="sect3">
<h4 id="k8s-autoremove"><a class="anchor" href="#k8s-autoremove"></a><a class="link" href="#k8s-autoremove">7.11.11. Cleanup Kubernetes resources</a></h4>
<div class="paragraph">
<p>The described steps are able to create Kubernetes resources on the current Kubernetes namespace.
By default these resources get removed automatically after the test scenario.</p>
</div>
<div class="paragraph">
<p>The auto removal of Kubernetes resources can be turned off with the following step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Disable auto removal of Kubernetes resources$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Disable auto removal of Kubernetes resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually this step is a <code>Background</code> step for all scenarios in a feature file. This way multiple scenarios can work on
the very same Kubernetes resources.</p>
</div>
<div class="paragraph">
<p>There is also a separate step to explicitly enable the auto removal.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Enable auto removal of Kubernetes resources$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Enable auto removal of Kubernetes resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, all Kubernetes resources are automatically removed after each scenario.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-knative"><a class="anchor" href="#steps-knative"></a><a class="link" href="#steps-knative">7.12. Knative steps</a></h3>
<div class="paragraph">
<p>Knative represents the Kubernetes-based platform to manage serverless workloads.
In YAKS you are able to leverage Knative eventing features such as producing and consuming
events.</p>
</div>
<div class="paragraph">
<p>Have a look at the complete example in <a href="../../examples/knative/knative-eventing.feature">examples/knative-eventing.feature</a>.</p>
</div>
<div class="paragraph">
<p>The following sections guide you through the Knative eventing capabilities in YAKS.</p>
</div>
<div class="sect3">
<h4 id="knative-api-version"><a class="anchor" href="#knative-api-version"></a><a class="link" href="#knative-api-version">7.12.1. API version</a></h4>
<div class="paragraph">
<p>The default Knative API version used to create and manage resources is <code>v1beta1</code>. You can overwrite this
version with a environment variable set on the YAKS configuration.</p>
</div>
<div class="listingblock">
<div class="title">Overwrite Knative API version</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">YAKS_KNATIVE_API_VERSION=v1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the Knative API version for all operations.</p>
</div>
</div>
<div class="sect3">
<h4 id="knative-client"><a class="anchor" href="#knative-client"></a><a class="link" href="#knative-client">7.12.2. Client configuration</a></h4>
<div class="listingblock">
<div class="title">@Given("^Knative timeout is {time}(?: ms| milliseconds)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given("^Knative timeout is {time} milliseconds</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the timeout for all Knative client operations.</p>
</div>
</div>
<div class="sect3">
<h4 id="knative-namespace"><a class="anchor" href="#knative-namespace"></a><a class="link" href="#knative-namespace">7.12.3. Set namespace</a></h4>
<div class="paragraph">
<p>Knative uses the concept of namespaces to separate workloads on the cluster. You
can connect to a specific namespace with the follwing step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Knative namespace {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Knative namespace {name}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="knative-broker"><a class="anchor" href="#knative-broker"></a><a class="link" href="#knative-broker">7.12.4. Knative broker</a></h4>
<div class="paragraph">
<p>Eventing deals with publish/subscribe delivery of events in Knative.
Knative eventing uses a broker that manages channels, subscriptions and events.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Knative broker {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Knative broker {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the broker name to use in all further steps that publish and consume events. The broker
should already be present on the Kubernetes namespace. In case there is no broker yet you can create one.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^create Knative broker {name}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Knative broker {name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step creates a new broker with the given <code>{name}</code>. The broker uses the default settings given
in the Knative platform.</p>
</div>
<div class="paragraph">
<p>You can verify that the broker is up and running with the following step:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Knative broker {name} is running$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Knative broker {name} is running</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="knative-service"><a class="anchor" href="#knative-service"></a><a class="link" href="#knative-service">7.12.5. Create event consumer service</a></h4>
<div class="paragraph">
<p>The Knative broker delivers events to sinks. In order to start consuming events in a test you should
create a event consumer service which acts as a sink.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^create Knative event consumer service {service}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Knative event consumer service {service}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step creates a new event consumer service. In particular this step creates a new <a href="#k8s-service">Kubernetes service</a>.
The service instantiates a new local Http server and creates a new Kubernetes service from it. The service exposes a
port which is <code>8080</code> by default.</p>
</div>
<div class="paragraph">
<p>You can adjust the service port as follows:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Knative service port {port}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Knative service port {port}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the Kubernetes service uses the service port as a target port when exposing the service.
You can choose another target port, too.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^create Knative event consumer service {service} with target port {port}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Knative event consumer service {service} with target port {port}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="knative-trigger"><a class="anchor" href="#knative-trigger"></a><a class="link" href="#knative-trigger">7.12.6. Manage triggers</a></h4>
<div class="paragraph">
<p>Triggers are used to deliver events to services and channels. In YAKS users can create
a trigger as part of the test in order to start consuming events.</p>
</div>
<div class="sect4">
<h5 id="triggers-on-services"><a class="anchor" href="#triggers-on-services"></a><a class="link" href="#triggers-on-services">7.12.6.1. Triggers on services</a></h5>
<div class="listingblock">
<div class="title">@Given("^create Knative trigger {trigger} on service {service}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Knative trigger {trigger} on service {service}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step creates a new trigger on the given Knative broker. The trigger watches for events
on the broker and forwards these events to the given service.</p>
</div>
<div class="paragraph">
<p>The service name either references an existing Kubernetes service or a
new service that is created as part of the test as described in this guide.</p>
</div>
<div class="paragraph">
<p>Triggers can use filters on event attributes. This narrows the amount of events handled by the trigger.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^create Knative trigger {trigger} on service {service} with filter on attributes$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Knative trigger {trigger} on service {service} with filter on attributes
| {attribute} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to add one or many attributes with respective value that should be added to the filter. As a result
the trigger will only handle events matching the given filters.</p>
</div>
</div>
<div class="sect4">
<h5 id="triggers-on-channels"><a class="anchor" href="#triggers-on-channels"></a><a class="link" href="#triggers-on-channels">7.12.6.2. Triggers on channels</a></h5>
<div class="paragraph">
<p>Triggers can also forward events to channels. Subscribers are able to start subscriptions
on these channels in order to receive the events.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^create Knative trigger {trigger} on channel {channel}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Knative trigger {trigger} on channel {channel}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, you can also add filters on attributes that narrow the amount of events
handled by the trigger.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^create Knative trigger {trigger} on channel {channel} with filter on attributes$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Knative trigger {trigger} on channel {channel} with filter on attributes
| {attribute} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step uses a data table with attributes and values that should be added to the filter. As a result
the trigger will only handle events matching the given filters.</p>
</div>
</div>
<div class="sect4">
<h5 id="delete-knative-trigger"><a class="anchor" href="#delete-knative-trigger"></a><a class="link" href="#delete-knative-trigger">7.12.6.3. Delete Knative trigger</a></h5>
<div class="paragraph">
<p>You can delete a trigger by giving its name in the current namespace.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^delete Knative trigger {trigger}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given delete Knative trigger {trigger}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This removes the Knative trigger from the current namespace.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="knative-channels"><a class="anchor" href="#knative-channels"></a><a class="link" href="#knative-channels">7.12.7. Create channels</a></h4>
<div class="paragraph">
<p>Channels represent a central concept of Knative eventing. Channels are able to deliver events
to multiple subscribers. A test in YAKS is able to create new channels.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^create Knative channel {channel}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given create Knative channel {channel}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the channel is available you can subscribe a service to the channel.</p>
</div>
<div class="listingblock">
<div class="title">@Given subscribe service {service} to Knative channel {channel}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given subscribe service {service} to Knative channel {channel}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="knative-send-events"><a class="anchor" href="#knative-send-events"></a><a class="link" href="#knative-send-events">7.12.8. Publish events</a></h4>
<div class="paragraph">
<p>The test is able to publish events on the Knative broker. YAKS uses the Knative Http client API
to publish events on the broker.</p>
</div>
<div class="paragraph">
<p>Because of that the test needs to specify a proper broker URL before publishing any events.</p>
</div>
<div class="sect4">
<h5 id="knative-broker-url"><a class="anchor" href="#knative-broker-url"></a><a class="link" href="#knative-broker-url">7.12.8.1. Knative broker URL</a></h5>
<div class="listingblock">
<div class="title">@Given("^Knative broker (?:URL|url): {url}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Knative broker URL: {url}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The URL points to a Knative broker and uses Http as transport. The test is able to publish events
using this broker endpoint.</p>
</div>
</div>
<div class="sect4">
<h5 id="knative-client-2"><a class="anchor" href="#knative-client-2"></a><a class="link" href="#knative-client-2">7.12.8.2. Knative client</a></h5>
<div class="paragraph">
<p>As an alternative to that you can also specify a Http client component which connects to the broker.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Knative client \"{name}\"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Knative client "{name}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client references a component in the configuration (e.g. Spring bean).</p>
</div>
<div class="paragraph">
<p>Now the test is ready to publish the event.</p>
</div>
</div>
<div class="sect4">
<h5 id="create-cloud-events"><a class="anchor" href="#create-cloud-events"></a><a class="link" href="#create-cloud-events">7.12.8.3. Create cloud events</a></h5>
<div class="listingblock">
<div class="title">@When("^(?:create|send) Knative event$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send Knative event
| {property} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step uses a data table in order to specify the cloud event properties that should be published.
The cloud event data structure defines following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>specversion</p>
</li>
<li>
<p>type</p>
</li>
<li>
<p>source</p>
</li>
<li>
<p>subject</p>
</li>
<li>
<p>id</p>
</li>
<li>
<p>datacontenttype</p>
</li>
<li>
<p>data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following these properties you can specify the cloud event in the send operation.</p>
</div>
<div class="listingblock">
<div class="title">Send cloud event</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send Knative event
| specversion     | 1.0 |
| type            | greeting |
| source          | https://github.com/citrusframework/yaks |
| subject         | hello |
| id              | say-hello |
| datacontenttype | application/json |
| data            | {"msg": "Hello Knative!"} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>data</code> property defines the cloud event payload which is a Json payload in the example above. This can be
any payload and depends on what you want to send as part of the event.</p>
</div>
<div class="paragraph">
<p>As we are using the Http cloud event model we can also use Http property equivalents as property keys.</p>
</div>
<div class="listingblock">
<div class="title">Send cloud event via Http properties</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send Knative event
| ce-specversion     | 1.0 |
| ce-type            | greeting |
| ce-source          | https://github.com/citrusframework/yaks |
| ce-subject         | hello |
| ce-id              | say-hello-${id} |
| Content-Type       | application/json;charset=UTF-8 |
| data               | {"msg": "Hello Knative!"} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of using a <code>data</code> property in the data table you can also specify the event payload in a separate step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Knative event data: {data}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Knative event data: {data}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step sets a single line event data that is going to represent the payload of the cloud event.</p>
</div>
<div class="paragraph">
<p>The following step supports multiline event data.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Knative event data$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Knative event data
"""
&lt;&lt;data&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>With these steps the cloud event data table must not specify the <code>data</code> property anymore.</p>
</div>
<div class="listingblock">
<div class="title">Send cloud event</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Knative event data
"""
{
  "msg": "Hello Knative!"
}
"""
Then send Knative event
| specversion     | 1.0 |
| type            | greeting |
| source          | https://github.com/citrusframework/yaks |
| subject         | hello |
| id              | say-hello |
| datacontenttype | application/json |</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="create-cloud-events-via-json"><a class="anchor" href="#create-cloud-events-via-json"></a><a class="link" href="#create-cloud-events-via-json">7.12.8.4. Create cloud events via Json</a></h5>
<div class="paragraph">
<p>The cloud events model supports Json so you can also specify the event with a single step in Json.</p>
</div>
<div class="listingblock">
<div class="title">@When("^(?:create|send) Knative event as json$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send Knative event as json
"""
&lt;&lt;json&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Send cloud event via Json</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When send Knative event as json
"""
{
  "specversion" : "1.0",
  "type" : "greeting",
  "source" : "https://github.com/citrusframework/yaks",
  "subject" : "hello",
  "id" : "say-hello",
  "datacontenttype" : "application/json",
  "data" : "{\"msg\": \"Hello Knative!\"}"
}
"""</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="producer-timeouts"><a class="anchor" href="#producer-timeouts"></a><a class="link" href="#producer-timeouts">7.12.8.5. Producer timeouts</a></h5>
<div class="paragraph">
<p>The producer connects to the Knative broker in order to publish events.
In case the broker is not available a timeout will fail the test. You can adjust the
producer timeout.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Knative event producer timeout is {time}(?: ms| milliseconds)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Knative event producer timeout is {time} milliseconds</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="knative-receive-events"><a class="anchor" href="#knative-receive-events"></a><a class="link" href="#knative-receive-events">7.12.9. Receive events</a></h4>
<div class="paragraph">
<p>In order to receive events from Knative you should setup a <a href="#knative-service">service</a> or <a href="#knative-channels">channel</a>
in combination with a <a href="#knative-trigger">trigger</a>. The trigger watches for events on the broker and forwards
these to the service or channel.</p>
</div>
<div class="paragraph">
<p>The test is able to receive events and verify its content.</p>
</div>
<div class="sect4">
<h5 id="receive-cloud-events"><a class="anchor" href="#receive-cloud-events"></a><a class="link" href="#receive-cloud-events">7.12.9.1. Receive cloud events</a></h5>
<div class="listingblock">
<div class="title">@Then("^(?:receive|verify) Knative event$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive Knative event
| {property} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step uses a data table in order to specify the cloud event properties as expected content.
The cloud event data structure defines following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>specversion</p>
</li>
<li>
<p>type</p>
</li>
<li>
<p>source</p>
</li>
<li>
<p>subject</p>
</li>
<li>
<p>id</p>
</li>
<li>
<p>datacontenttype</p>
</li>
<li>
<p>data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following these properties you can specify the cloud event in the receive operation.</p>
</div>
<div class="listingblock">
<div class="title">Receive cloud event</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive Knative event
| specversion     | 1.0 |
| type            | greeting |
| source          | https://github.com/citrusframework/yaks |
| subject         | hello |
| id              | say-hello |
| datacontenttype | application/json |
| data            | {"msg": "Hello Knative!"} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>data</code> property defines the cloud event payload which is a Json payload in the example above. This can be
any payload and depends on what you want to receive as part of the event.</p>
</div>
<div class="paragraph">
<p>As we are using the Http cloud event model we can also use Http property equivalents as property keys.</p>
</div>
<div class="listingblock">
<div class="title">Receive cloud event via Http properties</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive Knative event
| ce-specversion     | 1.0 |
| ce-type            | greeting |
| ce-source          | https://github.com/citrusframework/yaks |
| ce-subject         | hello |
| ce-id              | say-hello-${id} |
| Content-Type       | application/json;charset=UTF-8 |
| data               | {"msg": "Hello Knative!"} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of using a <code>data</code> property in the data table you can also specify the event payload in a separate step.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^(?:expect|verify) Knative event data: {data}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then expect Knative event data: {data}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step sets a single line event data that is going to represent the payload of the cloud event.</p>
</div>
<div class="paragraph">
<p>The following step supports multiline event data.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^(?:expect|verify) Knative event data$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then expect Knative event data
"""
&lt;&lt;data&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="paragraph">
<p>With these steps the cloud event data table must not specify the <code>data</code> property anymore.</p>
</div>
<div class="listingblock">
<div class="title">Receive cloud event</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given expect Knative event data
"""
{
  "msg": "Hello Knative!"
}
"""
Then receive Knative event
| specversion     | 1.0 |
| type            | greeting |
| source          | https://github.com/citrusframework/yaks |
| subject         | hello |
| id              | say-hello |
| datacontenttype | application/json |</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="receive-cloud-events-via-json"><a class="anchor" href="#receive-cloud-events-via-json"></a><a class="link" href="#receive-cloud-events-via-json">7.12.9.2. Receive cloud events via Json</a></h5>
<div class="paragraph">
<p>The cloud events model supports Json so you can also specify the event with a single step in Json.</p>
</div>
<div class="listingblock">
<div class="title">@When("^(?:receive|verify) Knative event as json$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive Knative event as json
"""
&lt;&lt;json&gt;&gt;
"""</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Receive cloud event via Json</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then receive Knative event as json
"""
{
  "specversion" : "1.0",
  "type" : "greeting",
  "source" : "https://github.com/citrusframework/yaks",
  "subject" : "hello",
  "id" : "say-hello",
  "datacontenttype" : "application/json",
  "data" : "{\"msg\": \"Hello Knative!\"}"
}
"""</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="consumer-timeouts"><a class="anchor" href="#consumer-timeouts"></a><a class="link" href="#consumer-timeouts">7.12.9.3. Consumer timeouts</a></h5>
<div class="paragraph">
<p>The consumer connects to the Knative broker in order to consume events.
The consumer will wait for events and in case no event arrives in time a
timeout will fail the test. You can adjust this event consumer timeout.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Knative event consumer timeout is {time}(?: ms| milliseconds)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Knative event consumer timeout is {time} milliseconds</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="knative-resources"><a class="anchor" href="#knative-resources"></a><a class="link" href="#knative-resources">7.12.10. Manage Knative resources</a></h4>
<div class="paragraph">
<p>The described steps are able to create Knative resources on the current Kubernetes namespace.
By default these resources get removed automatically after the test scenario.</p>
</div>
<div class="paragraph">
<p>The auto removal of Knative resources can be turned off with the following step.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Disable auto removal of Knative resources$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Disable auto removal of Knative resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually this step is a <code>Background</code> step for all scenarios in a feature file. This way multiple scenarios can work on
the very same Knative resources and share integrations.</p>
</div>
<div class="paragraph">
<p>There is also a separate step to explicitly enable the auto removal.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Enable auto removal of Knative resources$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Enable auto removal of Knative resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, all Knative resources are automatically removed after each scenario.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-openapi"><a class="anchor" href="#steps-openapi"></a><a class="link" href="#steps-openapi">7.13. Open API steps</a></h3>
<div class="paragraph">
<p>OpenAPI documents specify RESTful Http services in a standardized, language-agnostic way. The specifications describe
resources, path items, operations, security schemes and many more components. All these components specified are part
of a REST Http service.</p>
</div>
<div class="paragraph">
<p>YAKS as a framework is able to use this information in an OpenAPI document in order to generate proper request and response
data for your test.</p>
</div>
<div class="paragraph">
<p>You can find examples of how to use OpenAPI specifications in <a href="#../../examples/openapi">examples/openapi</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Feature: Petstore API V3

  Background:
    Given OpenAPI specification: http://localhost:8080/petstore/v3/openapi.json

  Scenario: getPet
    When invoke operation: getPetById
    Then verify operation result: 200 OK

  Scenario: petNotFound
    Given variable petId is "0"
    When invoke operation: getPetById
    Then verify operation result: 404 NOT_FOUND

  Scenario: addPet
    When invoke operation: addPet
    Then verify operation result: 201 CREATED

  Scenario: updatePet
    When invoke operation: updatePet
    Then verify operation result: 200 OK

  Scenario: deletePet
    When invoke operation: deletePet
    Then verify operation result: 204 NO_CONTENT</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="openapi-load"><a class="anchor" href="#openapi-load"></a><a class="link" href="#openapi-load">7.13.1. Load OpenAPI specifications</a></h4>
<div class="paragraph">
<p>The test is able to load OpenAPI specifications via Http URL or the local file system. When loaded into the test steps can make
use of all available operations in the specification.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^OpenAPI (?:specification|resource): {url}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given OpenAPI specification {url}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The given url can point to a local file on the file system or to a Http endpoint. The step loads the OpenAPI specification so
all operations are ready to be used.</p>
</div>
</div>
<div class="sect3">
<h4 id="openapi-invoke-operations"><a class="anchor" href="#openapi-invoke-operations"></a><a class="link" href="#openapi-invoke-operations">7.13.2. Invoke operations</a></h4>
<div class="paragraph">
<p>You can invoke operations as a client by referencing the operation name given in the specification. YAKS loads the operation from
the specification and automatically generates proper request/response data for you.</p>
</div>
<div class="paragraph">
<p>The rules in the OpenAPI specification define how to generate proper test data with randomized values.</p>
</div>
<div class="listingblock">
<div class="title">@When("^(?:I|i)nvoke operation: {id}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When invoke operation: {id}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step obtains the operation with the given <code>{id}</code> and invokes it on the Http URL that is given in the specification. In case the server URL
is missing in the specification the step uses the base URL of the OpenAPI endpoint where the document has been loaded from.</p>
</div>
<div class="paragraph">
<p>The step uses the specification rules for the operation to generate a proper request for you. Request parameters, headers and body content are
automatically generated. In case the operation defines a request body the step will also generate it with randomized values.</p>
</div>
<div class="listingblock">
<div class="title">Generated body example with randomized values</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="json">{
  "id": 26866048,
  "name": "mGNTgkfxgg",
  "photoUrls": [
    "XHAGIyFcyh"
  ],
  "category": {
    "name": "konwOUYwMo",
    "id": 18676332
  },
  "tags": [
    {
      "name": "KDnoWCfUBn",
      "id": 31444049
    }
  ],
  "status": "sold"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated request should be valid according to the rules in the OpenAPI specification. You can overwrite the
randomized values with test variables and <a href="#openapi-dictionaries">inbound/outbound data dictionaries</a> in order to have
more human-readable test data.</p>
</div>
<div class="paragraph">
<p>Now that the test has sent the request you can verify the operation result in a next step.</p>
</div>
</div>
<div class="sect3">
<h4 id="openapi-verify-result"><a class="anchor" href="#openapi-verify-result"></a><a class="link" href="#openapi-verify-result">7.13.3. Verify operation result</a></h4>
<div class="paragraph">
<p>The test is able to verify the response status code returned by the server.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^(?:V|v)erify operation result: {status_code}(?: {reason_phrase})?$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then verify operation result: {status_code} {reason_phrase}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step expects a <code>{status_code}</code> (e.g. 200, 404, 500) and optionally gives the <code>{reason_phrase}</code> (e.g. OK, NOT_FOUND, INTERNAL_SERVER_ERROR).
Thee reason phrase is optional and is only for better readability reasons.</p>
</div>
<div class="paragraph">
<p>The operation defines a set of responses in the OpenAPI specification. The step tries to find the response with the given <code>{status_code}</code>
and reads the given rules such as response body, headers etc. Based on the response definition in the OpenAPI specification the
step automatically verifies the server reponse and makes sure that the response matches the given rules.</p>
</div>
<div class="paragraph">
<p>In particular the step generates an expected response body (if any is specified) and compares the actual response with the generated one.</p>
</div>
<div class="listingblock">
<div class="title">Generated response body example with validations</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="json">{
  "id": "@isNumber()@",
  "name": "@notEmpty()@",
  "photoUrls": "@ignore@",
  "category": {
    "id": "@isNumber()@",
    "name": "@notEmpty()@"
  },
  "tags": "@ignore@",
  "status": "@matches(available|pending|sold)@"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated response makes use of Citrus validation matchers based on the rules in the specification. Id values are validated with <code>@isNumber()@</code>, String values
should not be empty <code>@notEmpty()@</code> and enumeration values are checked with <code>@matches(value_1|value_2|&#8230;&#8203;|value_x)@</code>.</p>
</div>
<div class="paragraph">
<p>The received response must match all these validation matchers. In addition to that a Json schema validation is performed on the response.</p>
</div>
</div>
<div class="sect3">
<h4 id="openapi-verify-request"><a class="anchor" href="#openapi-verify-request"></a><a class="link" href="#openapi-verify-request">7.13.4. Verify operation requests</a></h4>
<div class="paragraph">
<p>On the server side your test is able to verify incoming requests based on the rules in the specification. The test references a given operation
by its name in the specification and generates proper verification steps on the request content. Based on the specification the
incoming request must follow the rules and schemas attached to the OpenAPI operation.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^(?:receive|expect|verify) operation: {id}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then expect operation {id}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step expects a request matching the operation with the given <code>{id}</code>. The step loads the operation from the specification and autoamtically
verifies that the incoming request matches the specified request.</p>
</div>
<div class="paragraph">
<p>In fact the step generates a request body (if any is specified on the operation) with validation expressions and compares the
incoming request with the generated template. In case the incoming request does not match the generated validation rules
the test will fail accordingly.</p>
</div>
<div class="listingblock">
<div class="title">Generated request body example with validations</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="json">{
  "id": "@isNumber()@",
  "name": "@notEmpty()@",
  "photoUrls": "@ignore@",
  "category": {
    "id": "@isNumber()@",
    "name": "@notEmpty()@"
  },
  "tags": "@ignore@",
  "status": "@matches(available|pending|sold)@"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated request uses Citrus validation matchers based on the rules in the OpenAPI specification. Identifiers are validated with <code>@isNumber()@</code>, String values
should not be empty <code>@notEmpty()@</code> and enumeration values are checked with <code>@matches(value_1|value_2|&#8230;&#8203;|value_x)@</code>.</p>
</div>
<div class="paragraph">
<p>This way you can make sure that the incoming request matches the rules defined in the OpenAPI specification. In addition to the
message request body verification the step will automatically verify <code>Content-Type</code> headers, path parameters, query parameters and the general
request path used.</p>
</div>
</div>
<div class="sect3">
<h4 id="openapi-send-response"><a class="anchor" href="#openapi-send-response"></a><a class="link" href="#openapi-send-response">7.13.5. Send operation response</a></h4>
<div class="paragraph">
<p>When the OpenAPI step has received and verified a request it is time to respond with proper message content. The given operation
in the OpenAPI specification is able to define multiple response messages that are valid. In the test the user picks one of
these response messages and the step generates the message content based on the specification.</p>
</div>
<div class="paragraph">
<p>The step will generate proper test data with randomized values as response body.</p>
</div>
<div class="listingblock">
<div class="title">@Then("^send operation result: {status} {reason_phrase}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Then send operation result: 201 CREATED</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step obtains the operation response with the status <code>201</code> and generates the response data. The response is able to define <code>Content-Type</code> headers
and response body content.</p>
</div>
<div class="listingblock">
<div class="title">Generated response body example with randomized values</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="json">{
  "id": 26866048,
  "name": "mGNTgkfxgg",
  "photoUrls": [
    "XHAGIyFcyh"
  ],
  "category": {
    "name": "konwOUYwMo",
    "id": 18676332
  },
  "tags": [
    {
      "name": "KDnoWCfUBn",
      "id": 31444049
    }
  ],
  "status": "sold"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated response should be valid according to the rules in the OpenAPI specification. You can overwrite the
randomized values with test variables and <a href="#openapi-dictionaries">inbound/outbound data dictionaries</a> in order to have
more human-readable test data.</p>
</div>
</div>
<div class="sect3">
<h4 id="openapi-test-data"><a class="anchor" href="#openapi-test-data"></a><a class="link" href="#openapi-test-data">7.13.6. Generate test data</a></h4>
<div class="paragraph">
<p>The YAKS OpenAPI steps use the information in the specification to generate proper message content for requests and responses. The generated test
data follows the schemas attached to the operations and response definitions. By default, the steps include optional fields when generating
and validating message contents.</p>
</div>
<div class="paragraph">
<p>You can disable the optional fields in generation and validation accordingly:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^Disable OpenAPI generate optional fields$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Disable OpenAPI generate optional fields</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">@Given("^Disable OpenAPI validate optional fields$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Disable OpenAPI validate optional fields</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this setting the OpenAPI steps will exclude optional fields from both test data generation and message content validation.</p>
</div>
</div>
<div class="sect3">
<h4 id="openapi-dictionaries"><a class="anchor" href="#openapi-dictionaries"></a><a class="link" href="#openapi-dictionaries">7.13.7. Inbound/outbound data dictionaries</a></h4>
<div class="paragraph">
<p>Data dictionaries are a good way to make generated randomized values more human readable. By default YAKS generates random values based
on the specifications in the OpenAPI document. You can overwrite the basic generation rules by specifying rules in a data dictionary.</p>
</div>
<div class="sect4">
<h5 id="outbound-dictionary"><a class="anchor" href="#outbound-dictionary"></a><a class="link" href="#outbound-dictionary">7.13.7.1. Outbound dictionary</a></h5>
<div class="paragraph">
<p>Outbound dictionaries are used to customize generated client requests.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^OpenAPI outbound dictionary$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given OpenAPI outbound dictionary
| {expression} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The outbound dictionary holds a list of expressions that overwrite values in the generated request body.</p>
</div>
<div class="paragraph">
<p>Based on the body data format (e.g. Json or XML) you can use JsonPath or XPath expressions in the dictionary.
YAKS evaluates the given expressions on the generated request body before the request is sent to the server.</p>
</div>
<div class="listingblock">
<div class="title">Outbound dictionary sample</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given OpenAPI outbound dictionary
  | $.name          | citrus:randomEnumValue('hasso','cutie','fluffy') |
  | $.category.name | citrus:randomEnumValue('dog', 'cat', 'fish') |</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also load the dictionary rules from an external file resource.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load OpenAPI outbound dictionary {file_path}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load OpenAPI outbound dictionary {file_path}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this outbound data dictionary in place a generated request can look like follows:</p>
</div>
<div class="listingblock">
<div class="title">Generated request with outbound dictionary</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="json">{
  "id": 12337393,
  "name": "hasso",
  "photoUrls": [
    "aaKoEDhLYc"
  ],
  "category": {
    "name": "cat",
    "id": 23927231
  },
  "tags": [
    {
      "name": "FQxvuCbcqT",
      "id": 58291150
    }
  ],
  "status": "pending"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You see that the request now uses more human readable values for <code>$.name</code> and <code>$.category.name</code>.</p>
</div>
<div class="paragraph">
<p>The same mechanism applies for inbound messages that are verified by YAKS. The framework will generate an expected response
data structure coming from the OpenAPI specification.</p>
</div>
</div>
<div class="sect4">
<h5 id="inbound-dictionary"><a class="anchor" href="#inbound-dictionary"></a><a class="link" href="#inbound-dictionary">7.13.7.2. Inbound dictionary</a></h5>
<div class="paragraph">
<p>Inbound dictionaries adjust the generated expected responses which verify incoming messages with expected validation statements.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^OpenAPI inbound dictionary$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given OpenAPI inbound dictionary
| {expression} | {value} |</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also load the dictionary rules from an external file resource.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^load OpenAPI inbound dictionary {file_path}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given load OpenAPI inbound dictionary {file_path}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The inbound dictionary holds a list of expressions that overwrite values in the generated response body.</p>
</div>
<div class="paragraph">
<p>Based on the body data format (e.g. Json or XML) you can use JsonPath or XPath expressions in the dictionary.
YAKS evaluates the given expressions on the generated response body. This way you can overwrite given values in the body
structure before the validation takes place.</p>
</div>
<div class="listingblock">
<div class="title">Inbound dictionary sample</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given OpenAPI inbound dictionary
  | $.name          | @assertThat(anyOf(is(hasso),is(cutie),is(fluffy)))@ |
  | $.category.name | @assertThat(anyOf(is(dog),is(cat),is(fish)))@ |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Below is a sample Json payload that has been generated with the inbound data dictionary.</p>
</div>
<div class="listingblock">
<div class="title">Generated response with inbound dictionary</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="json">{
  "id": "@isNumber()@",
  "name": "@assertThat(anyOf(is(hasso),is(cutie),is(fluffy)))@",
  "photoUrls": "@ignore@",
  "category": {
    "name": "@assertThat(anyOf(is(dog),is(cat),is(fish)))@",
    "id": "@isNumber()@"
  },
  "tags": "@ignore@",
  "status": "@matches(available|pending|sold)@"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated response ensures that the rules defined in the OpenAPI specification do match and in addition that the received data
meets our expectations in the dictionary.</p>
</div>
<div class="paragraph">
<p>In case you need to have a more specific response validation where each field gets validated with an expected value please
consider using the <a href="#steps-http">Http steps</a> in YAKS. Here you can provide a complete expected Http response with body and headers.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="openapi-fork-mode"><a class="anchor" href="#openapi-fork-mode"></a><a class="link" href="#openapi-fork-mode">7.13.8. Request fork mode</a></h4>
<div class="paragraph">
<p>When the OpenAPI steps fire requests to the server the step synchronously waits for the response. All other steps are in the feature are blocked
by the synchronous communication. In some cases this is a problem because you might want to run some steps in parallel to the synchronous communication.</p>
</div>
<div class="paragraph">
<p>In these cases you can make use of the form mode when sending Http client requests.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^OpenAPI request fork mode is (enabled|disabled)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given OpenAPI request fork mode is enabled</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this in place the step will not block other steps while waiting for the synchronous response from the server. The feature will continue with
the next steps when fork mode is enabled. At a later point in time you may verify the response as usual with the separate verification step.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-selenium"><a class="anchor" href="#steps-selenium"></a><a class="link" href="#steps-selenium">7.14. Selenium steps</a></h3>
<div class="paragraph">
<p>Selenium is a very popular UI testing tool that enables you to simulate user interactions on a web frontend. Selenium
supports a wide range of browsers and is able to run with a grid of nodes in a Kubernetes environment.</p>
</div>
<div class="paragraph">
<p>YAKS provides ready-to-use steps that leverage Selenium UI testing with Cloud-native BDD. Have a look at the complete
example in <a href="../../examples/selenium/selenium.feature">examples/selenium.feature</a>.</p>
</div>
<div class="paragraph">
<p>The following sections guide you through the Selenium capabilities in YAKS.</p>
</div>
<div class="sect3">
<h4 id="selenium-browser-type"><a class="anchor" href="#selenium-browser-type"></a><a class="link" href="#selenium-browser-type">7.14.1. Browser type</a></h4>
<div class="paragraph">
<p>Selenium supports many browsers. When running a YAKS test with Selenium you need to choose which browser type to use. By
default, YAKS uses the <code>htmlunit</code> browser type. You can overwrite this type with the system property <code>yaks.selenium.browser.type</code>
or environment variable <code>YAKS_SELENIUM_BROWSER_TYPE</code> set on the YAKS configuration.</p>
</div>
<div class="listingblock">
<div class="title">Set Selenium browser type</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">YAKS_SELENIUM_BROWSER_TYPE=chrome</code></pre>
</div>
</div>
<div class="paragraph">
<p>These are the supported browser types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>firefox</p>
</li>
<li>
<p>safari</p>
</li>
<li>
<p>MicrosoftEdge</p>
</li>
<li>
<p>safariproxy</p>
</li>
<li>
<p>chrome</p>
</li>
<li>
<p>htmlunit</p>
</li>
<li>
<p>internet explorer</p>
</li>
<li>
<p>phantomjs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This sets the Selenium browser type for all operations.</p>
</div>
</div>
<div class="sect3">
<h4 id="selenium-browser"><a class="anchor" href="#selenium-browser"></a><a class="link" href="#selenium-browser">7.14.2. Selenium broker</a></h4>
<div class="paragraph">
<p>YAKS creates a default browser component using the given <a href="#selenium-browser-type">browser type</a>. You can also create a
browser instance by yourself and reference this in your test by its name.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Browser|browser) "{name}"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given browser "{name}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This loads the browser component with given name from the configuration (e.g. Spring application context).</p>
</div>
<div class="paragraph">
<p>You can also use the system property <code>yaks.selenium.browser.name</code> environment variable <code>YAKS_SELENIUM_BROWSER_NAME</code></p>
</div>
</div>
<div class="sect3">
<h4 id="selenium-browser-remote"><a class="anchor" href="#selenium-browser-remote"></a><a class="link" href="#selenium-browser-remote">7.14.3. Remote web driver</a></h4>
<div class="paragraph">
<p>As soon as the YAKS test is run on a Kubernetes environment you must use a remote web driver. This is because the default YAKS test
runtime pod is not able to run UI tests because no web browser infrastructure is installed in the image.</p>
</div>
<div class="paragraph">
<p>You can automatically start a Selenium sidecar container as part of the test runtime pod. The <a href="https://hub.docker.com/u/selenium">Selenium images</a>
provide the required web browser infrastructure for UI testing. YAKS adds the Selenium container as a sidecar to the test
runtime. Now your test is able to connect with the remote browser using a remote web driver connection.</p>
</div>
<div class="paragraph">
<p>Add the following configuration to the <code>yaks-config.yaml</code> in your test.</p>
</div>
<div class="listingblock">
<div class="title">yaks-config.yaml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">config:
  runtime:
    selenium:
      image: selenium/standalone-chrome:latest
    env:
      - name: YAKS_SELENIUM_BROWSER_TYPE
        value: chrome
      - name: YAKS_SELENIUM_BROWSER_REMOTE_SERVER_URL
        value: http://localhost:4444/wd/hub</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the Selenium container image (<code>selenium/standalone-chrome:latest</code>), the browser type and the remote web driver URL.
YAKS automatically starts the given Selenium container image and connects the browser to the remote web driver.</p>
</div>
<div class="paragraph">
<p>This way you can run the UI tests in a Kubernetes environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="selenium-start-stop"><a class="anchor" href="#selenium-start-stop"></a><a class="link" href="#selenium-start-stop">7.14.4. Start/stop browser</a></h4>
<div class="paragraph">
<p>Before you can run some user interactions with Selenium you need to start the browser.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^start browser$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given start browser</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">@Given("^stop browser$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given stop browser</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="selenium-navigate"><a class="anchor" href="#selenium-navigate"></a><a class="link" href="#selenium-navigate">7.14.5. Navigate to URL</a></h4>
<div class="paragraph">
<p>See the following step that navigates to a given URL in the browser.</p>
</div>
<div class="listingblock">
<div class="title">@When("^(?:User|user) navigates to "{url}"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When User navigates to "{url}"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="selenium-verify-elements"><a class="anchor" href="#selenium-verify-elements"></a><a class="link" href="#selenium-verify-elements">7.14.6. Verify elements on page</a></h4>
<div class="paragraph">
<p>Selenium is able to verify web elements on the current page. You can select the element by its attributes (e.g. id, name, style)
and verify its properties (e.g. text value, styles).</p>
</div>
<div class="listingblock">
<div class="title">@When("^(?:Browser|browser) page should display {element-type} with {attribute}="{value}"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When Browser page should display {element-type} with {attribute}="{value}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step verifies that the given element of type <code>{element-type}</code> is present on the current web page. The element is selected
by the given <code>{attribute}</code> and <code>{value}</code>.</p>
</div>
<div class="listingblock">
<div class="title">Verify heading with text</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When Browser page should display heading with text="Welcome!"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Possible element types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>element</p>
</li>
<li>
<p>button</p>
</li>
<li>
<p>link</p>
</li>
<li>
<p>input</p>
</li>
<li>
<p>textfield</p>
</li>
<li>
<p>form</p>
</li>
<li>
<p>heading</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Possible attributes to select the element are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>id</p>
</li>
<li>
<p>name</p>
</li>
<li>
<p>class-name</p>
</li>
<li>
<p>link-text</p>
</li>
<li>
<p>css-selector</p>
</li>
<li>
<p>tag-name</p>
</li>
<li>
<p>xpath</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can add additional attribute validations in a data table</p>
</div>
<div class="listingblock">
<div class="title">Verify element with attributes</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When And browser page should display element with id="hello-text" having
    | text   | Hello!         |
    | styles | background-color=rgba(0, 0, 0, 0) |</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="selenium-click"><a class="anchor" href="#selenium-click"></a><a class="link" href="#selenium-click">7.14.7. Click elements</a></h4>
<div class="paragraph">
<p>You can click on elements such as buttons or links. The element must be identified by an attribute (e.g. id, name, style)
with a given value.</p>
</div>
<div class="listingblock">
<div class="title">@When("^(?:User|user) clicks (?:element|button|link) with {attribute}="{value}"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When User clicks (element|button|link) with {attribute}="{value}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Click button by id</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When User clicks button with id="submit"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="selenium-forms"><a class="anchor" href="#selenium-forms"></a><a class="link" href="#selenium-forms">7.14.8. Form controls</a></h4>
<div class="paragraph">
<p>Filling out a user form on a web page is a very common use case in UI testing. YAKS is able to enter text into input fields,
select items from a drop down list and check/uncheck checkboxes.</p>
</div>
<div class="sect4">
<h5 id="input-fields"><a class="anchor" href="#input-fields"></a><a class="link" href="#input-fields">7.14.8.1. Input fields</a></h5>
<div class="listingblock">
<div class="title">@When("^(?:User|user) enters text "{input}" to (?:element|input|textfield) with {attribute}="{value}"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When User enters text "{input}" to (element|input|textfield) with {attribute}="{value}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Enter text in input field</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When User enters text "Christoph" to input with id="name"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="checkboxes"><a class="anchor" href="#checkboxes"></a><a class="link" href="#checkboxes">7.14.8.2. Checkboxes</a></h5>
<div class="listingblock">
<div class="title">@When("^(?:User|user) (checks|unchecks) checkbox with {attribute}="{value}"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When User (checks|unchecks) checkbox with {attribute}="{value}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Check checkbox</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When User checks checkbox with id="show-details"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dropdowns"><a class="anchor" href="#dropdowns"></a><a class="link" href="#dropdowns">7.14.8.3. Dropdowns</a></h5>
<div class="listingblock">
<div class="title">@When("^(?:User|user) selects option "{option}" on (?:element|dropdown) with {attribute}="{value}"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When User selects option "{option}" with {attribute}="{value}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Check checkbox</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When User selects option "21-30" on dropdown with id="age"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="selenium-alert"><a class="anchor" href="#selenium-alert"></a><a class="link" href="#selenium-alert">7.14.9. Alert dialogs</a></h4>
<div class="paragraph">
<p>Web pages can open alert dialogs that need to be accepted or dismissed.</p>
</div>
<div class="listingblock">
<div class="title">@When("^(?:User|user) (accepts|dismisses) alert$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When User (accepts|dismisses) alert</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also verify the alert text displayed to the user.</p>
</div>
<div class="listingblock">
<div class="title">@When("^(?:Browser|browser) page should display alert with text "{text}"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When Browser page should display alert with text "{text}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Verify alert with text</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">When Browser page should display alert with text "WARNING!"</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The alert text verification implicitly accepts the alert dialog after validation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="selenium-pages"><a class="anchor" href="#selenium-pages"></a><a class="link" href="#selenium-pages">7.14.10. Page objects</a></h4>
<div class="paragraph">
<p>Selenium provides a good way to encapsulate web page capabilities in form of page objects. These object usually defines elements
on a web page and perform predefined operations on that page.</p>
</div>
<div class="listingblock">
<div class="title">Page object</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class UserFormPage implements WebPage {

    @FindBy(id = "userForm")
    private WebElement form;

    @FindBy(id = "username")
    private WebElement userName;

    /**
     * Sets the user name.
     * @param value
     */
    public void setUserName(String value) {
        userName.clear();
        userName.sendKeys(value);
    }

    /**
     * Submits the form.
     */
    public void submit() {
        form.submit();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The page object above defines a <code>form</code> element as well as a <code>username</code> input text field. The page identifies the elements
with <code>@FindBy</code> annotations. In addition, the page defines operations such as <code>setUserName</code> and <code>submit</code>.</p>
</div>
<div class="paragraph">
<p>YAKS is able to load the page objects by its name in the current configuration (e.g. Spring application context).</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Browser|browser) page "{name}"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Browser page "{name}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step loads the page object that has been added to the configuration with the given name.</p>
</div>
<div class="paragraph">
<p>You can also instantiate new page objects by its types as follows:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Browser|browser) page "{name}" of type {type}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Browser page "{name}" of type {type}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Instantiate UserForm page</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Browser page "userForm" of type org.sample.UserFormPage</code></pre>
</div>
</div>
<div class="paragraph">
<p>This loads a new page object of type <code>org.sample.UserFormPage</code>. Please make sure that the given class is available on the test
classpath and that the class provides a default constructor.</p>
</div>
<div class="paragraph">
<p>You can instantiate many web page objects in a single step.</p>
</div>
<div class="listingblock">
<div class="title">Instantiate many page objects</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Browser page types
  | indexPage | org.sample.IndexPage     |
  | userForm  | org.sample.UserFormPage  |
  | orderForm | org.sample.OrderFormPage |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the page objects are loaded you can perform operations.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Browser|browser) page {name} performs {operation}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Browser page {name} performs {operation}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Call submit operation on userForm</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Browser page userForm performs submit</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step uses the given page object <code>userForm</code> and performs the <code>submit</code> operation. This simply calls the <code>submit()</code> method
on the page object.</p>
</div>
<div class="listingblock">
<div class="title">Page object</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class UserFormPage implements WebPage {

    @FindBy(id = "userForm")
    private WebElement form;

    /**
     * Submits the form.
     */
    public void submit() {
        form.submit();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the operation requires parameters you can set those on the operation call.</p>
</div>
<div class="listingblock">
<div class="title">Call setUserName operation with arguments</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Browser page userForm performs setUserName with arguments
  | Christoph |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>setUserName</code> operation on the page object requires the username value as a parameter. This value is set as <code>Christoph</code> in
the step above.</p>
</div>
<div class="listingblock">
<div class="title">Page object</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class UserFormPage implements WebPage {

    @FindBy(id = "username")
    private WebElement userName;

    /**
     * Sets the user name.
     * @param value
     */
    public void setUserName(String value) {
        userName.clear();
        userName.sendKeys(value);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each page operation can use the current <code>TestContext</code> as argument, too. This context will be automatically injected by YAKS
when the operation is called.</p>
</div>
<div class="listingblock">
<div class="title">Use test context in page objects</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class UserFormPage implements WebPage {

    @FindBy(id = "username")
    private WebElement userName;

    /**
     * Sets the user name.
     * @param value
     * @param context
     */
    public void setUserName(String value, TestContext context) {
        userName.clear();
        userName.sendKeys(value);

        context.setVariable("username", value);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The page operation <code>setUserName</code> uses the <code>TestContext</code> as additional method argument and is able to set a new test variable.
All subsequent steps in the test are able to access this new variable with <code>${username}</code> then.</p>
</div>
</div>
<div class="sect3">
<h4 id="selenium-page-validators"><a class="anchor" href="#selenium-page-validators"></a><a class="link" href="#selenium-page-validators">7.14.11. Page validator</a></h4>
<div class="paragraph">
<p>The previous section has introduced the concept of page objects and how to perform operations on the given page. You can also
use page objects to verify the page contents.</p>
</div>
<div class="listingblock">
<div class="title">Page validator</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class UserFormPageValidator implements PageValidator&lt;UserFormPage&gt; {

    @Override
    public void validate(UserFormPage webPage, SeleniumBrowser browser, TestContext context) {
        Assert.assertNotNull(webPage.userName);
        Assert.assertTrue(StringUtils.hasText(webPage.userName.getAttribute("value")));
        Assert.assertNotNull(webPage.form);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The page validator implements the <code>PageValidator&lt;&gt;</code> interface and implements a <code>validate</code> method. The validation is provided
with the actual page object, the browser instance and the current test context.</p>
</div>
<div class="paragraph">
<p>The validator should verify that the current state on the page is as expected.</p>
</div>
<div class="paragraph">
<p>YAKS is able to load the page validator by its name in the current configuration (e.g. Spring application context).</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Browser|browser) page validator "{name}"$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Browser page validator "{name}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step loads the page validator that has been added to the configuration with the given name.</p>
</div>
<div class="paragraph">
<p>You can also instantiate new page validator objects by its types as follows:</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Browser|browser) page validator "{name}" of type {type}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Browser page validator "{name}" of type {type}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Create page validator</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Browser page validator "userFormValidator" of type org.sample.UserFormPageValidator</code></pre>
</div>
</div>
<div class="paragraph">
<p>This loads a new page validator of type <code>org.sample.UserFormPageValidator</code>. Please make sure that the given class is available on the test
classpath and that the class provides a default constructor.</p>
</div>
<div class="paragraph">
<p>You can instantiate many web page validator objects in a single step.</p>
</div>
<div class="listingblock">
<div class="title">Instantiate many page validator objects</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Browser page validator types
  | indexPageValidator | org.sample.IndexPageValidator     |
  | userFormValidator  | org.sample.UserFormPageValidator  |
  | orderFormValidator | org.sample.OrderFormPageValidator |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the page validator objects are loaded you can perform its validations.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^(?:Browser|browser) page {name} should validate with {validator}$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Browser page {name} should validate with {validator}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Validate userForm page with userFormValidator</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Browser page userForm should validate with userFormValidator</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step calls the <code>validate</code> method on the page validator <code>userFormValidator</code> and passes the <code>userForm</code> page object as
argument.</p>
</div>
<div class="listingblock">
<div class="title">Page validator</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class UserFormPageValidator implements PageValidator&lt;UserFormPage&gt; {

    @Override
    public void validate(UserFormPage webPage, SeleniumBrowser browser, TestContext context) {
        Assert.assertNotNull(webPage.userName);
        Assert.assertTrue(StringUtils.hasText(webPage.userName.getAttribute("value")));
        Assert.assertNotNull(webPage.form);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The validator accesses the elements and operations provided in the page object and makes sure the state is as expected.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The page object itself can also implement the page validator interface. This way you can combine the concept of
page objects and validator in a single class. The step to verify the page is then able to just use the page object name.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Validate userForm page with implicit validator</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given Browser page userForm should validate</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Page object implementing validator</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class UserFormPage implements WebPage, PageValidator&lt;UserFormPage&gt; {

    @FindBy(id = "userForm")
    private WebElement form;

    @FindBy(id = "username")
    private WebElement userName;

    [...]

    @Override
    public void validate(UserFormPage webPage, SeleniumBrowser browser, TestContext context) {
        Assert.assertNotNull(userName);
        Assert.assertTrue(StringUtils.hasText(userName.getAttribute("value")));
        Assert.assertNotNull(form);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-testcontainers"><a class="anchor" href="#steps-testcontainers"></a><a class="link" href="#steps-testcontainers">7.15. Testcontainers steps</a></h3>
<div class="paragraph">
<p>YAKS provides steps that allow to leverage the power of <a href="https://www.testcontainers.org/">Testcontainers</a> library as part of Cloud native tests.
You can configure and start Testcontainers modules as pod in the current namespace.
Testcontainers provides a great set of ready-to-use containers (e.g. <a href="https://www.testcontainers.org/modules/databases/">database containers</a>, <a href="https://www.testcontainers.org/modules/localstack/">AWS cloud stack</a> and many more).</p>
</div>
<div class="paragraph">
<p>You can find examples of different Testcontainers in use</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../../examples/postgresql/postgresql.feature">examples/postgresql</a>.</p>
</li>
<li>
<p><a href="../../examples/aws-kinesis/aws-kinesis.feature">examples/aws-kinesis</a>.</p>
</li>
<li>
<p><a href="../../examples/aws-s3/aws-s3.feature">examples/aws-s3</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="testcontainer-priviledges"><a class="anchor" href="#testcontainer-priviledges"></a><a class="link" href="#testcontainer-priviledges">7.15.1. Setup required privileges</a></h4>
<div class="paragraph">
<p>Running Testcontainers in Kubernetes may require privileges on the YAKS service account.
This depends on the restrictions and RBAC settings in your cluster.</p>
</div>
<div class="paragraph">
<p>Be sure to add <code>privileged</code> security context constraint to the <code>yaks-viewer</code> service account in the namespace where tests are run.</p>
</div>
<div class="listingblock">
<div class="title">Add privileged security context constraint</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">oc adm policy add-scc-to-user privileged system:serviceaccount:{namespace}:yaks-viewer</code></pre>
</div>
</div>
<div class="paragraph">
<p>This adds the <code>privileged</code> security constraint to the <code>yaks-viewer</code> service account.
This is required for the test to start and manage a Testcontainer pod as part of the test.</p>
</div>
</div>
<div class="sect3">
<h4 id="testcontainer-database"><a class="anchor" href="#testcontainer-database"></a><a class="link" href="#testcontainer-database">7.15.2. Database containers</a></h4>
<div class="paragraph">
<p>You can choose from a wide range of database modules provided in Testcontainers.
YAKS is able to run these database containers as part of the test.</p>
</div>
</div>
<div class="sect3">
<h4 id="testcontainer-postgresql"><a class="anchor" href="#testcontainer-postgresql"></a><a class="link" href="#testcontainer-postgresql">7.15.3. PostgreSQL container</a></h4>
<div class="paragraph">
<p>Configure and manage a PostgreSQL database container.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^PostgreSQL version (^\\s+)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given PostgreSQL version 9.6.12</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">@Given("^start PostgreSQL container$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given start PostgreSQL container</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="testcontainer-mongodb"><a class="anchor" href="#testcontainer-mongodb"></a><a class="link" href="#testcontainer-mongodb">7.15.4. MongoDB container</a></h4>
<div class="paragraph">
<p>Configure and manage a MongoDB database container.</p>
</div>
<div class="listingblock">
<div class="title">@Given("^MongoDB version (^\\s+)$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given MongoDB version 4.10.0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">@Given("^start MongoDB container$")</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Given start MongoDB container</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="extensions"><a class="anchor" href="#extensions"></a><a class="link" href="#extensions">8. Extensions</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="extensions-minio"><a class="anchor" href="#extensions-minio"></a><a class="link" href="#extensions-minio">8.1. Minio upload</a></h3>
<div class="paragraph">
<p>Extensions add custom steps to the test runtime so you can use custom step definitions in your feature file.</p>
</div>
<div class="listingblock">
<div class="title">extension.feature</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Scenario: print extended slogan
    Given YAKS does Cloud-Native BDD testing
    Then YAKS can be extended!</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step <code>YAKS can be extended!</code> is not available in the default step implementations provided by YAKS. The step definition
is implemented in a separate custom Maven module and gets uploaded to the Kubernetes cluster using the
<a href="https://github.com/container-tools/snap">container-tools/snap</a> library.</p>
</div>
<div class="paragraph">
<p>Snap uses a <a href="https://min.io/">Minio</a> object storage that is automatically installed in the current namespace. You can build and upload
custom Maven modules with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">$ yaks upload examples/extensions/steps</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create the Minio storage and perform the upload. After that you can use the custom steps in your feature file. Be sure to add
the dependency and the additional glue code in <code>yaks-config.yaml</code>.</p>
</div>
<div class="listingblock">
<div class="title">yaks-config.yaml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">config:
  runtime:
    cucumber:
      glue:
      - "org.citrusframework.yaks"
      - "com.company.steps.custom"
dependencies:
  - groupId: com.company
    artifactId: steps
    version: "1.0.0-SNAPSHOT"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The additional glue code should match the package name where to find the custom step definitions in your custom code.</p>
</div>
<div class="paragraph">
<p>With that you are all set and can run the test as usual:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">$ yaks run extension.feature</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the upload as part of the test command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">$ yaks run extension.feature --upload steps</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--upload</code> option builds and uploads the custom Maven module automatically before the test.</p>
</div>
</div>
<div class="sect2">
<h3 id="extensions-jitpack"><a class="anchor" href="#extensions-jitpack"></a><a class="link" href="#extensions-jitpack">8.2. Jitpack extensions</a></h3>
<div class="paragraph">
<p>Jitpack allows you to load custom steps from an external GitHub repository in order to use
custom step definitions in your feature file.</p>
</div>
<div class="listingblock">
<div class="title">jitpack.feature</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="gherkin">Scenario: Use custom steps
    Given My steps are loaded
    Then I can do whatever I want!</code></pre>
</div>
</div>
<div class="paragraph">
<p>The steps <code>My steps are loaded</code> and <code>I can do whatever I want!</code> live in a separate repository on
GitHub ([<a href="https://github.com/citrusframework/yaks-step-extension" class="bare">https://github.com/citrusframework/yaks-step-extension</a>](<a href="https://github.com/citrusframework/yaks-step-extension)" class="bare">https://github.com/citrusframework/yaks-step-extension)</a>).</p>
</div>
<div class="paragraph">
<p>We need to add the Jitpack Maven repository, the dependency and the additional glue code in the <code>yaks-config.yaml</code>.</p>
</div>
<div class="listingblock">
<div class="title">yaks-config.yaml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">config:
  runtime:
    cucumber:
      glue:
      - "org.citrusframework.yaks"
      - "dev.yaks.testing.standard"
    settings:
      repositories:
        - id: "central"
          name: "Maven Central"
          url: "https://repo.maven.apache.org/maven2/"
        - id: "jitpack.io"
          name: "JitPack Repository"
          url: "https://jitpack.io"
      dependencies:
        - groupId: com.github.citrusframework
          artifactId: yaks-step-extension
          version: "0.0.1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The additional glue code <code>dev.yaks.testing.standard</code> should match the package name where to find the custom step definitions in the library. The Jitpack
Maven repository makes sure the library gets resolved at runtime.</p>
</div>
<div class="paragraph">
<p>With that you are all set and can run the test as usual:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">$ yaks run jitpack.feature</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the logs you will see that Jitpack automatically loads the additional dependency before the test.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pre-post-scripts"><a class="anchor" href="#pre-post-scripts"></a><a class="link" href="#pre-post-scripts">9. Pre/Post scripts</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can run scripts before/after a test group. Just add your commands to the <code>yaks-config.yaml</code> configuration for the test group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">config:
  namespace:
    temporary: false
    autoRemove: true
pre:
  - script: prepare.sh
  - run: echo Start!
  - name: Optional name
    timeout: 30m
    run: |
      echo "Multiline"
      echo "Commands are also"
      echo "Supported!"
post:
  - script: finish.sh
  - run: echo Bye!</code></pre>
</div>
</div>
<div class="paragraph">
<p>The section <code>pre</code> runs before a test group and <code>post</code> is added after the test group has finished.
The post steps are run even if the tests or pre steps fail for some reason.
This ensures that cleanup tasks are performed also in case of errors.</p>
</div>
<div class="paragraph">
<p>The <code>script</code> option provides a file path to bash script to execute.
The user has to make sure that the script is executable.
If no absolute file path is given it is assumed to be a file path relative to the current test group directory.</p>
</div>
<div class="paragraph">
<p>With <code>run</code> you can add any shell command inline.
You can add multiple <code>run</code> commands in a <code>pre</code> or <code>post</code> section.</p>
</div>
<div class="paragraph">
<p>Each step can also define a human-readable <code>name</code> that will be printed before its execution.</p>
</div>
<div class="paragraph">
<p>By default, a step must complete within 30 minutes (<code>30m</code>).
The timeout can be changed using the <code>timeout</code> option in the step declaration (in Golang duration format).</p>
</div>
<div class="sect2">
<h3 id="scripts-env"><a class="anchor" href="#scripts-env"></a><a class="link" href="#scripts-env">9.1. Environment variables in scripts</a></h3>
<div class="paragraph">
<p>Scripts can leverage the following environment variables that are set automatically by the YAKS runtime:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>YAKS_NAMESPACE</strong>: always contains the namespace where the tests will be executed, no matter if the namespace is fixed or temporary</p>
</li>
<li>
<p><strong>YAKS_TEST_STATUS</strong>: indicates the test status (SUCCESS, FAILED)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="conditional-scripts"><a class="anchor" href="#conditional-scripts"></a><a class="link" href="#conditional-scripts">9.2. Conditional execution</a></h3>
<div class="paragraph">
<p>You can add conditions so scripts are run based on condition evaluation.
Just add <code>if</code> section to the 'pre/post' script configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">config:
  namespace:
    temporary: false
    autoRemove: true
pre:
  - name: Install
    if: "os=darwin"
    run: |
      echo "Runs on MacOS"
post:
  - name: CleanUp
    if: "env:foo=bar"
    script: finish.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The condition expressions support evaluation based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Test failure: <code>failure()</code></p>
</li>
<li>
<p>Operating system: <code>os={name}</code></p>
</li>
<li>
<p>Environment variables: <code>env{name}={value}</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Scripts that define an <code>if</code> statement only execute when respective expression evaluation is true.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reports"><a class="anchor" href="#reports"></a><a class="link" href="#reports">10. Reporting</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>After running some YAKS tests you may want to review the test results and generate a summary report. As we are using CRDs on the Kubernetes or OpenShift platform we
can review the status of the custom resources after the test run in order to get some test results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">oc get tests

NAME         PHASE     TOTAL     PASSED    FAILED    SKIPPED
helloworld   Passed    2         2         0         0
foo-test     Passed    1         1         0         0
bar-test     Passed    1         1         0         0</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also view error details when adding the <code>wide</code> option</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">oc get tests -o wide

NAME         PHASE     TOTAL     PASSED    FAILED    SKIPPED    ERRORS
helloworld   Passed    2         1         1         0          [ "helloworld.feature:10 Failed caused by ValidationException - Expected 'foo' but was 'bar'" ]
foo-test     Passed    1         1         0         0
bar-test     Passed    1         1         0         0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The YAKS CLI is able to fetch those results in order to generate a summary report locally:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks report --fetch

Test results: Total: 4, Passed: 4, Failed: 0, Skipped: 0
	classpath:org/citrusframework/yaks/helloworld.feature:3: Passed
	classpath:org/citrusframework/yaks/helloworld.feature:7: Passed
	classpath:org/citrusframework/yaks/foo-test.feature:3: Passed
	classpath:org/citrusframework/yaks/bar-test.feature:3: Passed</code></pre>
</div>
</div>
<div class="paragraph">
<p>The report supports different output formats (summary, json, junit). For JUnit style reports use the <code>junit</code> output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks report --fetch --output junit

&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;testsuite name="org.citrusframework.yaks.JUnitReport" errors="0" failures="0" skipped="0" tests="4" time="0"&gt;
  &lt;testcase name="helloworld.feature:3" classname="classpath:org/citrusframework/yaks/helloworld.feature:3" time="0"&gt;&lt;/testcase&gt;
  &lt;testcase name="helloworld.feature:7" classname="classpath:org/citrusframework/yaks/helloworld.feature:7" time="0"&gt;&lt;/testcase&gt;
  &lt;testcase name="foo-test.feature:3" classname="classpath:org/citrusframework/yaks/foo-test.feature:3" time="0"&gt;&lt;/testcase&gt;
  &lt;testcase name="bar-test.feature:3" classname="classpath:org/citrusframework/yaks/bar-test.feature:3" time="0"&gt;&lt;/testcase&gt;
&lt;/testsuite&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JUnit report is also saved to the local disk in the file <code>_output/junit-reports.xml</code>.</p>
</div>
<div class="paragraph">
<p>The <code>_output</code> directory is also used to store individual test results for each test executed via the YAKS CLI.
So after a test run you can also review the results in that <code>_output</code> directory. The YAKS report command can also view those results in <code>_output</code> directory
in any given output format. Simply leave out the <code>--fetch</code> option when generating the report and YAKS will use the test results stored in the
local <code>_output</code> folder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks report
Test results: Total: 5, Passed: 5, Failed: 0, Skipped: 0
	classpath:org/citrusframework/yaks/helloworld.feature:3: Passed
	classpath:org/citrusframework/yaks/helloworld.feature:7: Passed
	classpath:org/citrusframework/yaks/test1.feature:3: Passed
	classpath:org/citrusframework/yaks/test2.feature:3: Passed
	classpath:org/citrusframework/yaks/test3.feature:3: Passed</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contributing"><a class="anchor" href="#contributing"></a><a class="link" href="#contributing">11. Contributing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Go 1.16+</strong>: needed to compile and test the operator code. Refer to the <a href="https://golang.org/">Go website</a> for the installation.</p>
</li>
<li>
<p><strong>GNU Make</strong>: used to define composite build actions. This should be already installed or available as a package if you have a good OS (<a href="https://www.gnu.org/software/make/" class="bare">https://www.gnu.org/software/make/</a>).</p>
</li>
<li>
<p><strong>Operator SDK v1.22+</strong></p>
</li>
<li>
<p><strong>Maven 3.6.3+</strong>: used as a build tool</p>
</li>
<li>
<p><strong>Java 11+</strong>: needed for compile, test and build the YAKS runtime</p>
</li>
<li>
<p><strong>Git</strong>: as a client for version control</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
MacOS users will need to use <strong>gnu-sed</strong> to successfully run the Make build scripts (e.g. for generating the YAKS bundle).
Please install gnu-sed on your machine (e.g. <code>brew install gnu-sed</code>) and set your PATH accordingly to use gnu-sed with: <code>export PATH="/usr/local/opt/gnu-sed/libexec/gnubin:$PATH"</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can build the YAKS project and get the <code>yaks</code> CLI binary by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">make build</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to build the operator image locally for development on Minikube for instance, then:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">#Connect to Minikube Docker (only on non linux os)
eval $(minikube docker-env)

# Build binaries and images - skip tests
make clean images-no-test</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the operator pod is running, just delete it to let it grab the new image.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">kubectl delete pod -l app=yaks</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="uninstall"><a class="anchor" href="#uninstall"></a><a class="link" href="#uninstall">12. Uninstall</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In case you really need to remove YAKS and all related resources from Kubernetes or OpenShift you can do so with the
following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks uninstall</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will remove the YAKS operator from the current namespace along with all related custom resource definitions.</p>
</div>
<div class="paragraph">
<p>When using the global operator mode you may need to select the proper namespace here.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks uninstall -n kube-operators</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, the uninstall will <strong>not</strong> remove resources that are possibly shared between namespaces and clusters (e.g. CRDs and roles).
Please use the <code>--all</code> flag if you need to wipe out these, too.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks uninstall --all</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--all</code> option removes the operator and all related resources such as <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources">CustomResourceDefinitions (CRD)</a> and
<a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac">ClusterRole</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In case the operator has <strong>not</strong> been installed via <a href="https://docs.openshift.com/container-platform/4.1/applications/operators/olm-understanding-olm.html">Operator Lifecycle Manager(OLM)</a> you may need to
use the option <code>--olm=false</code> also when uninstalling. In particular this is the case when installing YAKS from sources on <a href="https://code-ready.github.io/crc/">CRC</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell script">yaks uninstall --olm=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use this whenever you do not want to use OLM framework for performing the uninstall.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="samples"><a class="anchor" href="#samples"></a><a class="link" href="#samples">13. Samples</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>ToDo</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.19.2<br>
Last updated 2024-05-17 14:08:53 +0200
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js"></script>
<!--
  ~ Copyright the original author or authors.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<style>
  #footer-sponsor {
    position: absolute;
    bottom: 5px;
    right: 25px;
    float: right;
  }
</style>
<div id="footer-sponsor">
</div>
</body>
</html>